<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>italkyAI ‚Ä¢ Akademi Giri≈ü</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    #pageContent { height: 100%; overflow: hidden; }
    .wrap { height: 100%; padding: 10px 16px 20px; display: flex; flex-direction: column; }
    .hero { border-radius: 32px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); padding: 24px 20px; }
    .topRow { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
    .flagBox { width: 70px; height: 70px; border-radius: 24px; display: flex; align-items: center; justify-content: center; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); }
    .flagBox span { font-size: 34px; }
    .who { display: flex; flex-direction: column; }
    .role { font-size: 13px; font-weight: 800; color: #a5b4fc; text-transform: uppercase; }
    .name { font-size: 24px; font-weight: 900; color: #fff; }
    .cost-badge { display: inline-block; padding: 6px 12px; border-radius: 10px; background: rgba(99, 102, 241, 0.2); color: #a5b4fc; font-weight: 900; margin: 15px 0; }
    .rules { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .rule { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
    .k { font-size: 11px; color: rgba(255,255,255,0.4); text-transform: uppercase; }
    .v { font-size: 20px; font-weight: 900; color: #fff; }
    .btn { height: 56px; border-radius: 18px; border: none; font-weight: 900; font-size: 16px; cursor: pointer; transition: 0.2s; margin-top: auto; }
    .btn-main { background: #fff; color: #000; }
    .btn-main:disabled { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.3); }
  </style>
</head>
<body>
  <main id="pageContent">
    <div class="wrap">
      <section class="hero">
        <div class="topRow">
          <div class="flagBox"><span id="flag">üè≥Ô∏è</span></div>
          <div class="who"><div class="role" id="role">DERS SE√áƒ∞Mƒ∞</div><div class="name" id="teacherName">...</div></div>
        </div>
        <div class="cost-badge">Sƒ±nav Giri≈ü: 200 Token</div>
        <div class="rules">
          <div class="rule"><div class="k">Soru</div><div class="v">50</div></div>
          <div class="rule"><div class="k">S√ºre</div><div class="v">40 dk</div></div>
        </div>
        <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-top:15px;">‚Ä¢ 10 Token = 4 TL | Dakika maliyeti 5 Token'dƒ±r.<br/>‚Ä¢ Sƒ±navƒ± erken bitirirseniz, kalan s√ºrenin tokenleri iade edilir.</p>
      </section>
      <button class="btn btn-main" id="btnStart" disabled>Bakiye Kontrol Ediliyor...</button>
    </div>
  </main>
  <script type="module">
    import { mountShell } from "/js/ui_shell.js";
    import { bootPage } from "/js/ui_guard.js";
    import { supabase } from "/js/supabase_client.js";

    mountShell({ scroll: "none" });
    bootPage({ protectedPage: true, header: { nameId: "userName", picId: "userPic" } });

    const TEACHERS = { jack:{flag:"üá¨üáß", role:"English", name:"Jack"}, heidi:{flag:"üá©üá™", role:"Deutsch", name:"Heidi"}, claire:{flag:"üá´üá∑", role:"Fran√ßais", name:"Claire"}, diego:{flag:"üá™üá∏", role:"Espa√±ol", name:"Diego"}, marco:{flag:"üáÆüáπ", role:"Italiano", name:"Marco"}, elena:{flag:"üá∑üá∫", role:"P—É—Å—Å–∫–∏–π", name:"Elena"}, kenji:{flag:"üáØüáµ", role:"Êó•Êú¨Ë™û", name:"Kenji"}, mei:{flag:"üá®üá≥", role:"‰∏≠Êñá", name:"Mei-Ling"} };
    const sel = localStorage.getItem("italky_teacher_pref");
    const t = TEACHERS[sel];
    if(t) { document.getElementById("flag").textContent = t.flag; document.getElementById("teacherName").textContent = t.name; }

    async function checkWallet() {
      const { data: { user } } = await supabase.auth.getUser();
      const { data: profile } = await supabase.from('profiles').select('tokens').eq('id', user.id).single();
      const btn = document.getElementById("btnStart");
      if ((profile?.tokens || 0) >= 200) { btn.disabled = false; btn.textContent = "Sƒ±navƒ± Ba≈ülat (200 Token)"; }
      else { btn.disabled = true; btn.textContent = "Yetersiz Bakiye (Min: 200 TK)"; }
    }
    document.getElementById("btnStart").onclick = () => location.href = "/pages/level_test.html";
    checkWallet();
  </script>
</body>
</html>
