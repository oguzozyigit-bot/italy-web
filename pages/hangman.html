<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyAI ‚Ä¢ HANGMAN</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #02000a;
      --neon-blue: #00f3ff;
      --neon-pink: #ff00ff;
      --neon-green: #00ff9d;
      --ai-grad: linear-gradient(135deg, #a5b4fc 0%, #6366f1 100%);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { margin: 0; background: var(--bg); color: #fff; font-family: 'Outfit', sans-serif; height: 100dvh; overflow: hidden; }

    .mobile-frame { width: 100%; max-width: 480px; height: 100%; margin: 0 auto; display: flex; flex-direction: column; background: rgba(5, 0, 20, 0.98); position: relative; }

    /* KURULUM EKRANI - Gƒ∞ZLƒ∞ SCROLL */
    .setup-overlay { 
      position: absolute; inset: 0; background: var(--bg); z-index: 2000; padding: 25px; 
      display: flex; flex-direction: column; overflow-y: scroll; 
      scrollbar-width: none; -ms-overflow-style: none;
    }
    .setup-overlay::-webkit-scrollbar { display: none; }

    .game-title { 
      font-family: 'Space Grotesk'; font-size: 42px; font-weight: 900; text-align: center; 
      color: #fff; margin: 20px 0; letter-spacing: 5px; 
      text-shadow: 0 0 15px var(--neon-blue);
    }

    .section-label { font-size: 11px; font-weight: 800; color: var(--neon-blue); margin: 15px 0 8px; text-transform: uppercase; }
    .neon-input { width: 100%; padding: 14px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: #fff; font-weight: 600; margin-bottom: 10px; }
    
    .grid-select { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .opt-card { padding: 12px 5px; border-radius: 12px; border: 1px solid #333; background: rgba(255,255,255,0.03); text-align: center; cursor: pointer; }
    .opt-card.active { border-color: var(--neon-blue); background: rgba(0, 243, 255, 0.1); }
    .opt-card span { display: block; font-size: 22px; margin-bottom: 5px; }

    .big-btn { width: 100%; padding: 18px; border-radius: 15px; background: var(--ai-grad); border: none; color: #fff; font-weight: 900; font-size: 16px; margin: 20px 0; cursor: pointer; }

    /* OYUN ƒ∞√áƒ∞ */
    .topbar { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .back-btn { background: none; border: 1px solid rgba(255,255,255,0.1); color: #fff; width: 40px; height: 40px; border-radius: 12px; cursor: pointer; }
    
    .game-info { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
    .p-name { font-size: 24px; font-weight: 900; color: var(--neon-pink); }

    .hangman-box { height: 160px; display: flex; align-items: center; justify-content: center; position: relative; }
    .stage { width: 100px; height: 120px; position: relative; border-bottom: 4px solid #fff; }
    .p { position: absolute; background: #fff; display: none; box-shadow: 0 0 10px #fff; }
    .p.show { display: block; }
    /* Par√ßa koordinatlarƒ± */
    .p1{width:4px;height:100%;left:20px}.p2{width:60px;height:4px;left:20px;top:0}.p3{width:2px;height:15px;left:80px;top:0}
    .p4{width:26px;height:26px;border-radius:50%;border:3px solid #fff;left:68px;top:15px}.p5{width:3px;height:45px;left:80px;top:41px}
    .p6{width:18px;height:3px;left:63px;top:55px;transform:rotate(-30deg)}.p7{width:18px;height:3px;left:80px;top:55px;transform:rotate(30deg)}
    .p8{width:18px;height:3px;left:63px;top:85px;transform:rotate(-45deg)}.p9{width:18px;height:3px;left:80px;top:85px;transform:rotate(45deg)}

    .joker-row { display: flex; justify-content: center; gap: 15px; margin: 10px 0; }
    .j-btn { width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--neon-blue); color: var(--neon-blue); background: none; font-size: 20px; cursor: pointer; }
    .j-btn.used { opacity: 0.2; pointer-events: none; }

    .word-area { text-align: center; padding: 10px; }
    .slot { width: 28px; height: 38px; border-bottom: 3px solid var(--neon-blue); display: inline-flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 900; margin: 0 3px; }

    .keyboard { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; padding: 15px; margin-top: auto; }
    .key { height: 40px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-weight: 800; cursor: pointer; }

    .leaderboard { width: 100%; background: rgba(255,255,255,0.03); border-radius: 15px; padding: 15px; }
    .lb-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-weight: 600; }

    .footer { height: 50px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; opacity: 0.2; border-top: 1px solid rgba(255,255,255,0.05); }

    .modal { position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
    .modal.active { display: flex; }
  </style>
</head>
<body>

  <div class="mobile-frame">
    <div class="setup-overlay" id="setup">
      <div class="game-title">HANGMAN</div>
      
      <div class="section-label">OYUNCULAR</div>
      <div id="pInputs">
        <input type="text" class="neon-input p-in" placeholder="1. Oyuncu Adƒ±">
      </div>
      <button onclick="addInput()" style="background:none; border:1px dashed #444; color:#888; padding:10px; border-radius:12px; width:100%; cursor:pointer;">+ YENƒ∞ OYUNCU EKLE</button>

      <div class="section-label">Dƒ∞L SE√áƒ∞N</div>
      <div class="grid-select" id="langGrid">
        <div class="opt-card active" data-val="en"><span>üá¨üáß</span><label>EN</label></div>
        <div class="opt-card" data-val="de"><span>üá©üá™</span><label>DE</label></div>
        <div class="opt-card" data-val="fr"><span>üá´üá∑</span><label>FR</label></div>
      </div>

      <div class="section-label">ZORLUK</div>
      <div class="grid-select" id="diffGrid">
        <div class="opt-card active" data-val="8"><span>üå±</span><label>KOLAY</label></div>
        <div class="opt-card" data-val="6"><span>üî•</span><label>ORTA</label></div>
        <div class="opt-card" data-val="4"><span>üíÄ</span><label>ZOR</label></div>
      </div>

      <button class="big-btn" onclick="initGame()">OYUNA BA≈ûLA</button>

      <div class="section-label">EFSANELER Lƒ∞STESƒ∞ (TOP 5)</div>
      <div class="leaderboard" id="lbList"></div>
    </div>

    <div class="topbar">
      <button class="back-btn" onclick="location.href='/pages/home.html'">‚Üê</button>
      <div style="flex:1; text-align:center; font-weight:900; letter-spacing:2px;">HANGMAN</div>
    </div>

    <div class="game-info">
      <div class="p-name" id="curPName">PLAYER</div>
      <div style="text-align:right; font-size:12px;">
        HAK: <b id="remR">5/5</b><br>
        PUAN: <b id="curS">0</b>
      </div>
    </div>

    <div class="hangman-box">
      <div class="stage">
        <div class="p p1"></div><div class="p p2"></div><div class="p p3"></div>
        <div class="p p4"></div><div class="p p5"></div><div class="p p6"></div>
        <div class="p p7"></div><div class="p p8"></div><div class="p p9"></div>
      </div>
    </div>

    <div class="joker-row">
      <button class="j-btn" id="j0" onclick="useJ(0)">üÉè</button>
      <button class="j-btn" id="j1" onclick="useJ(1)">üÉè</button>
      <button class="j-btn" id="j2" onclick="useJ(2)">üÉè</button>
    </div>

    <div class="word-area">
      <div id="wordGrid"></div>
      <div id="trHint" style="margin-top:10px; font-style:italic; opacity:0.4; font-size:14px;"></div>
    </div>

    <div class="keyboard" id="kb"></div>
    <div class="footer">italkyAI By Ozyigit‚Äôs 2026</div>

    <div class="modal" id="modal">
      <h1 id="mTitle">Bƒ∞LDƒ∞N!</h1>
      <h2 id="mWord" style="color:var(--neon-blue); font-size:32px;">APPLE</h2>
      <p id="mTr" style="opacity:0.6;">(Elma)</p>
      <div id="mDesc"></div>
      <button class="big-btn" onclick="modalNext()">DEVAM ET</button>
    </div>
  </div>

  <script type="module">
    import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";

    let players = [], curIdx = 0, pool, used, lang = 'en', maxM = 8;
    let target, guessed = [], mistakes = 0, keysP = 0, jokers = [false, false, false], wordsDone = 0;

    // LEADERBOARD
    function updateLB() {
      const lb = JSON.parse(localStorage.getItem('hangman_top5') || "[]");
      document.getElementById('lbList').innerHTML = lb.map((p,i)=>`
        <div class="lb-item"><span>${i+1}. ${p.n}</span><b>${p.s} Puan</b></div>
      `).join('') || '<div style="opacity:0.3; font-size:12px;">Hen√ºz skor yok.</div>';
    }
    updateLB();

    // SETUP SELECTIONS
    document.querySelectorAll('.grid-select').forEach(grid => {
      grid.onclick = (e) => {
        const c = e.target.closest('.opt-card'); if(!c) return;
        grid.querySelectorAll('.opt-card').forEach(x=>x.classList.remove('active'));
        c.classList.add('active');
        if(grid.id === 'langGrid') lang = c.dataset.val;
        if(grid.id === 'diffGrid') maxM = parseInt(c.dataset.val);
      };
    });

    window.addInput = () => {
      const i = document.createElement('input'); i.className = 'neon-input p-in'; i.placeholder = 'Oyuncu Adƒ±';
      document.getElementById('pInputs').appendChild(i);
    };

    window.initGame = async () => {
      const ins = document.querySelectorAll('.p-in');
      ins.forEach(i => { if(i.value.trim()) players.push({ n: i.value.trim(), s: 0, r: 5 }); });
      if(!players.length) return alert("ƒ∞sim gir!");
      pool = await loadLangPool(lang);
      used = createUsedSet(`used_${lang}`).used;
      document.getElementById('setup').style.display = 'none';
      startTurn();
    };

    function startTurn() {
      guessed = []; mistakes = 0; keysP = 0; jokers = [false, false, false];
      target = pick(pool, 1, used, null, (x)=>x.w.length >= 5)[0];
      for(let i=0; i<3; i++) document.getElementById(`j${i}`).classList.remove('used');
      updateUI(); renderKB();
    }

    function updateUI() {
      const p = players[curIdx];
      document.getElementById('curPName').innerText = p.n.toUpperCase();
      document.getElementById('remR').innerText = `${p.r}/5`;
      document.getElementById('curS').innerText = p.s;
      document.getElementById('trHint').innerText = target.tr;
      document.getElementById('wordGrid').innerHTML = target.w.split('').map(l => 
        `<div class="slot">${guessed.includes(l.toUpperCase())?l.toUpperCase():''}</div>`).join('');
      document.querySelectorAll('.p').forEach((p,i)=>p.classList.toggle('show', i < mistakes));
    }

    function renderKB() {
      const abc = "ABCDEFGHIJKLMNOPQRSTUVWXYZ√úƒû≈ûƒ∞√ñ√á".split('');
      const wordChars = [...new Set(target.w.toUpperCase().split(''))];
      let keys = [...wordChars];
      const others = abc.filter(l => !keys.includes(l));
      for(let i=0; i<10; i++) keys.push(others.splice(Math.floor(Math.random()*others.length), 1)[0]);
      document.getElementById('kb').innerHTML = keys.sort((a,b)=>a.localeCompare(b)).map(l => 
        `<button class="key" id="k-${l}" onclick="makeG('${l}', this)">${l}</button>`).join('');
    }

    window.makeG = (l, btn) => {
      if(guessed.includes(l) || mistakes >= maxM) return;
      keysP++;
      if(target.w.toUpperCase().includes(l)) {
        guessed.push(l); if(btn) btn.classList.add('correct');
        if(target.w.split('').every(c => guessed.includes(c.toUpperCase()))) finish(true);
      } else {
        mistakes++; if(btn) btn.classList.add('wrong');
        if(mistakes >= maxM) finish(false);
      }
      updateUI();
    };

    window.useJ = (id) => {
      const rem = target.w.toUpperCase().split('').filter(l => !guessed.includes(l));
      if(rem.length) {
        document.getElementById(`j${id}`).classList.add('used');
        makeG(rem[0], document.getElementById(`k-${rem[0]}`));
      }
    };

    function finish(win) {
      const p = players[curIdx]; let bonus = false;
      if(win) {
        p.s += Math.max(1, 10 - (keysP - target.w.length));
        if(mistakes === 0 && keysP === target.w.length) { p.r++; bonus = true; }
      }
      p.r--;
      showM(win, bonus);
      const u = new SpeechSynthesisUtterance(target.w);
      u.lang = lang === 'en' ? 'en-US' : 'de-DE'; speechSynthesis.speak(u);
    }

    function showM(win, b) {
      document.getElementById('mTitle').innerText = win ? "Bƒ∞LDƒ∞N!" : "Bƒ∞LEMEDƒ∞N!";
      document.getElementById('mWord').innerText = target.w.toUpperCase();
      document.getElementById('mTr').innerText = `(${target.tr})`;
      document.getElementById('mDesc').innerHTML = b ? '<b style="color:var(--neon-green)">0 HATA! +1 HAK!</b>' : '';
      document.getElementById('modal').classList.add('active');
    }

    window.modalNext = () => {
      document.getElementById('modal').classList.remove('active');
      wordsDone++;
      if(wordsDone >= 5) {
        if(curIdx < players.length - 1) { curIdx++; wordsDone = 0; startTurn(); }
        else endGame();
      } else startTurn();
    };

    function endGame() {
      const lb = JSON.parse(localStorage.getItem('hangman_top5') || "[]");
      players.forEach(p => lb.push({ n: p.n, s: p.s }));
      lb.sort((a,b)=>b.s-a.s);
      localStorage.setItem('hangman_top5', JSON.stringify(lb.slice(0,5)));
      alert("Oyun Bitti!"); location.reload();
    }
  </script>
</body>
</html>
