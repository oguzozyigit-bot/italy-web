<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyAI ‚Ä¢ Neon Hangman Turnuva</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #02000a;
      --burgundy: #8b2635;
      --lacivert: #6366f1;
      --ai-grad: linear-gradient(135deg, #a5b4fc 0%, #6366f1 100%);
      --neon-glow: 0 0 15px rgba(99, 102, 241, 0.4);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    html, body { margin: 0; width: 100%; height: 100dvh; overflow: hidden; position: fixed; font-family: 'Outfit', sans-serif; background: var(--bg); color: #fff; }

    .cosmos { position: absolute; inset: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 50% 50%, #1a0208 0%, #02000a 80%); z-index: 0; }
    .mobile-frame { width: 100%; max-width: 480px; height: 100%; margin: 0 auto; position: relative; z-index: 10; display: flex; flex-direction: column; background: rgba(2, 0, 10, 0.85); backdrop-filter: blur(35px); }

    .overlay { position: absolute; inset: 0; background: var(--bg); z-index: 100; display: flex; flex-direction: column; align-items: center; padding: 30px; text-align: center; overflow-y: auto; scrollbar-width: none; }
    .overlay::-webkit-scrollbar { display: none; }
    .hidden { display: none !important; }
    
    /* OYUNCU EKLEME ALANI */
    .player-row { display: flex; gap: 10px; width: 100%; margin-bottom: 10px; align-items: center; }
    .neon-input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-weight: 600; }
    .del-btn { width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--burgundy); background: rgba(139, 38, 53, 0.1); color: var(--burgundy); display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .add-player-btn { width: 100%; padding: 12px; border-radius: 12px; border: 2px dashed rgba(99, 102, 241, 0.4); color: var(--lacivert); font-weight: 800; cursor: pointer; margin-bottom: 20px; background: none; }

    .l-btn { padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-weight: 800; cursor: pointer; font-size: 12px; }
    .active-opt { border-color: var(--lacivert); background: rgba(99, 102, 241, 0.2); }
    .big-btn { margin-top: 15px; width: 100%; padding: 14px; border-radius: 15px; border: none; background: var(--ai-grad); color: #fff; font-weight: 900; cursor: pointer; }

    .topbar { height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    
    /* OYUN ALANI */
    .word-area { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 20px; }
    .word-grid { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
    .char-slot { width: 30px; height: 40px; border-bottom: 3px solid var(--burgundy); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; }
    .tr-meaning { font-size: 16px; color: var(--muted); font-weight: 600; font-style: italic; opacity: 0.7; }

    .keyboard { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; width: 100%; padding: 20px; margin-top: auto; }
    .key { height: 40px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-weight: 800; cursor: pointer; }
    .modal { position: absolute; inset: 0; background: rgba(2,0,10,0.98); z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
    .modal.active { display: flex; }
  </style>
</head>
<body>

  <div class="cosmos"></div>
  <div class="mobile-frame">
    
    <div class="overlay" id="setupOverlay">
      <h1 style="font-family:'Space Grotesk'; font-size:24px; margin-bottom:20px;">TURNUVA AYARLARI</h1>
      
      <div id="playerContainer" style="width:100%;">
          <div class="player-row">
            <input type="text" class="neon-input p-input" placeholder="1. Oyuncu Adƒ±">
            <div style="width:44px;"></div> </div>
      </div>
      <button class="add-player-btn" onclick="addPlayerField()">+ YENƒ∞ OYUNCU EKLE</button>

      <div style="width:100%; margin-bottom:20px;">
        <label style="font-size:11px; font-weight:800; opacity:0.6; display:block; text-align:left; margin-bottom:8px;">ZORLUK</label>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
            <button class="l-btn difficulty active-opt" onclick="setDiff('KOLAY', 8, this)">KOLAY (8)</button>
            <button class="l-btn difficulty" onclick="setDiff('ORTA', 6, this)">ORTA (6)</button>
            <button class="l-btn difficulty" onclick="setDiff('ZOR', 4, this)">ZOR (4)</button>
            <button class="l-btn difficulty" onclick="setDiff('EN ZOR', 2, this)">EN ZOR (2)</button>
        </div>
      </div>

      <button class="big-btn" onclick="startTournament()">TURNUVAYI BA≈ûLAT</button>
    </div>

    <div class="modal" id="gameModal">
        <h2 id="modalTitle">Bƒ∞LDƒ∞N!</h2>
        <button class="big-btn" id="modalBtn">DEVAM ET</button>
    </div>

    <div class="topbar">
      <button class="backBtn" onclick="history.back()">‚Üê</button>
      <div id="turnDisplay" style="font-weight:900; font-size:14px; color:var(--lacivert);">SIRA: --</div>
      <div id="jokerDisplay" style="font-size:12px; font-weight:800; color:var(--pink);">üÉè Joker: 3</div>
    </div>

    <div class="word-area">
        <div class="word-grid" id="wordGrid"></div>
        <div class="tr-meaning" id="trMeaning"></div>
    </div>

    <div style="padding:0 20px;">
        <button class="l-btn" id="jokerBtn" style="width:100%; border-color:var(--pink);" onclick="useJoker()">JOKER KULLAN (HARF A√á)</button>
    </div>

    <div class="keyboard" id="kb"></div>
  </div>

  <script type="module">
    import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";

    let pool, usedManager;
    let players = [];
    let currentPlayerIdx = 0;
    let currentConfig = { diff: 'KOLAY', maxMistakes: 8, lang: 'en' };
    let currentWordObj = null;
    let guessed = [];
    let mistakes = 0;
    let wordsCount = 0;
    let totalJokers = 3;

    // Dinamik Oyuncu Ekleme
    window.addPlayerField = () => {
        const div = document.createElement('div');
        div.className = 'player-row';
        div.innerHTML = `
            <input type="text" class="neon-input p-input" placeholder="Yeni Oyuncu">
            <button class="del-btn" onclick="this.parentElement.remove()">üóëÔ∏è</button>
        `;
        document.getElementById('playerContainer').appendChild(div);
    };

    window.setDiff = (label, val, btn) => {
        currentConfig.diff = label; currentConfig.maxMistakes = val;
        document.querySelectorAll('.difficulty').forEach(b => b.classList.remove('active-opt'));
        btn.classList.add('active-opt');
    };

    window.startTournament = async () => {
        const inputs = document.querySelectorAll('.p-input');
        const pNames = [];
        inputs.forEach(i => { if(i.value.trim()) pNames.push({ name: i.value.trim(), score: 0 }); });
        
        if(!pNames.length) return alert("L√ºtfen en az bir oyuncu ismi yazƒ±n!");
        
        players = pNames;
        pool = await loadLangPool('en'); // Varsayƒ±lan ƒ∞ngilizce
        usedManager = createUsedSet('tournament_hangman_used');
        
        document.getElementById('setupOverlay').classList.add('hidden');
        startPlayerTurn(0);
    };

    function startPlayerTurn(idx) {
        currentPlayerIdx = idx;
        wordsCount = 0;
        totalJokers = 3;
        document.getElementById('turnDisplay').innerText = `SIRA: ${players[idx].name.toUpperCase()}`;
        document.getElementById('jokerDisplay').innerText = `üÉè Joker: ${totalJokers}`;
        loadNewWord();
    }

    function loadNewWord() {
        // 5 harf ve √ºzeri kuralƒ± ile kelime se√ß
        const items = pick(pool, 1, usedManager.used, usedManager.save, (item) => item.w.length >= 5);
        currentWordObj = items[0];
        guessed = []; mistakes = 0;
        updateUI();
        renderKeyboard();
    }

    function updateUI() {
        document.getElementById('wordGrid').innerHTML = currentWordObj.w.split('').map(l => `
            <div class="char-slot">${guessed.includes(l.toUpperCase()) ? l.toUpperCase() : ''}</div>
        `).join('');
        // Harf √ßubuklarƒ±nƒ±n altƒ±na T√ºrk√ße anlam
        document.getElementById('trMeaning').innerText = currentWordObj.tr;
    }

    function renderKeyboard() {
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
        const wordChars = [...new Set(currentWordObj.w.toUpperCase().split(''))];
        let keys = [...wordChars];
        const others = alphabet.filter(l => !keys.includes(l));
        for(let i=0; i<10; i++) keys.push(others.splice(Math.floor(Math.random()*others.length), 1)[0]);
        
        document.getElementById('kb').innerHTML = keys.sort().map(l => `
            <button class="key" id="k-${l}" onclick="makeGuess('${l}')">${l}</button>
        `).join('');
    }

    window.makeGuess = (l) => {
        if(currentWordObj.w.toUpperCase().includes(l)) {
            guessed.push(l);
            if(currentWordObj.w.split('').every(c => guessed.includes(c.toUpperCase()))) finishWord(true);
        } else {
            mistakes++;
            if(mistakes >= currentConfig.maxMistakes) finishWord(false);
        }
        updateUI();
    };

    window.useJoker = () => {
        if(totalJokers <= 0) return;
        const unrevealed = currentWordObj.w.toUpperCase().split('').filter(l => !guessed.includes(l));
        if(unrevealed.length) {
            totalJokers--;
            document.getElementById('jokerDisplay').innerText = `üÉè Joker: ${totalJokers}`;
            makeGuess(unrevealed[0]);
        }
    };

    function finishWord(isWin) {
        speak(currentWordObj.w);
        const modal = document.getElementById('gameModal');
        document.getElementById('modalTitle').innerText = isWin ? "Bƒ∞LDƒ∞N! üéâ" : `Bƒ∞LEMEDƒ∞N! üíÄ (${currentWordObj.w})`;
        const btn = document.getElementById('modalBtn');
        
        wordsCount++;
        if(wordsCount >= 5) {
            btn.innerText = (currentPlayerIdx < players.length - 1) ? "SIRADAKƒ∞ OYUNCU" : "TURNUVA Bƒ∞TTƒ∞";
            btn.onclick = () => {
                modal.classList.remove('active');
                if(currentPlayerIdx < players.length - 1) startPlayerTurn(currentPlayerIdx + 1);
                else location.reload();
            };
        } else {
            btn.innerText = "SIRADAKƒ∞ KELƒ∞ME";
            btn.onclick = () => { modal.classList.remove('active'); loadNewWord(); };
        }
        modal.classList.add('active');
    }

    function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        window.speechSynthesis.speak(msg);
    }
  </script>
</body>
</html>
