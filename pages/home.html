<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyAI • Giriş</title>

  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #020205; --text-white: #ffffff; --text-grey: #9ca3af;
      --ai-gradient: linear-gradient(135deg, #a5b4fc 0%, #6366f1 50%, #4338ca 100%);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden;
      font-family: 'Outfit', sans-serif; background-color: var(--bg-deep);
      color: var(--text-white); display: flex; align-items: center; justify-content: center;
    }
    .app-frame {
      width: 100%; max-width: 440px; height: 100%;
      position: relative; z-index: 10;
      display: flex; flex-direction: column; justify-content: space-between;
      background: rgba(8, 8, 12, 0.85); backdrop-filter: blur(30px);
      padding: 40px 20px;
    }
    .logo-text { font-size: 50px; font-weight: 700; text-align: center; }
    .txt-ai { background: var(--ai-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .action-section { display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%; }
    #googleBtnContainer { width: 100%; max-width: 320px; min-height: 44px; display: flex; justify-content: center; }
    .toast {
      position: fixed; top: 20px; left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: #1a1a2e; border: 1px solid #6366f1;
      padding: 12px 24px; border-radius: 30px;
      transition: 0.4s; z-index: 9999;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>

  <div class="app-frame">
    <div class="header-section" style="text-align: center;">
      <div class="logo-text">italky<span class="txt-ai">AI</span></div>
      <h2 style="font-size: 22px; margin-top: 20px;">Hoş Geldiniz</h2>
      <p style="color: var(--text-grey); font-size: 14px;">Devam etmek için giriş yapın.</p>
    </div>

    <div class="action-section">
      <div id="googleBtnContainer"></div>
    </div>

    <div style="text-align: center; font-size: 10px; color: rgba(255,255,255,0.2);">
      italkyAI © 2026
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script type="module">
    const HOME_PATH = "/pages/home.html"; // ✅ doğru yol

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = String(msg || "");
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 2400);
    }
    window.showToast = showToast;

    async function init() {
      // Google script yüklenene kadar bekle
      const waitGoogle = () => new Promise((resolve) => {
        const t0 = Date.now();
        const tick = () => {
          if (window.google?.accounts?.id) return resolve(true);
          if (Date.now() - t0 > 6000) return resolve(false);
          setTimeout(tick, 120);
        };
        tick();
      });

      // auth.js yükle
      let authModule = null;
      try {
        authModule = await import("/js/auth.js?v=" + Date.now());
      } catch (e) {
        console.error("auth.js yüklenemedi:", e);
        showToast("Giriş sistemi yüklenemedi.");
        return;
      }

      // Zaten login ise auth.js HOME'a gönderir (çift yönlendirme yapma)
      try {
        const already = authModule.redirectIfLoggedIn?.();
        if (already) return;
      } catch {}

      const okGoogle = await waitGoogle();
      if (!okGoogle) {
        showToast("Google bileşeni yüklenemedi.");
        return;
      }

      // Google butonunu başlat
      try {
        authModule.initAuth?.();
      } catch (e) {
        console.error("initAuth hata:", e);
        showToast("Giriş başlatılamadı.");
      }
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
