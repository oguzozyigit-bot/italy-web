<!-- FILE: /pages/teacher_course.html -->
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>italkyAI ‚Ä¢ Ders</title>

  <meta name="theme-color" content="#02000f">
  <style>html,body{background:#02000f !important;}</style>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --aiGrad: linear-gradient(135deg,#a5b4fc 0%,#6366f1 55%,#ec4899 100%);
      --border: rgba(255,255,255,0.12);
      --card: rgba(255,255,255,0.06);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.55);
      --ok: rgba(34,197,94,0.95);
      --bad: rgba(255,90,140,0.95);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; }
    #pageContent{ height:100%; }

    /* ui_shell i√ßeride scroll'u shellMain y√∂netiyor. Biz i√ßeride kendi layout‚Äôumuzu kuruyoruz */
    .wrap{
      min-height: 100%;
      padding: 12px 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      font-weight: 1000;
      font-size: 12px;
      color: rgba(255,255,255,0.92);
      white-space: nowrap;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .chip .dot{
      width:7px; height:7px; border-radius:99px;
      background:#a5b4fc;
      box-shadow:0 0 10px rgba(165,180,252,0.55);
    }

    .panel{
      flex:1;
      min-height: 0;
      border-radius: 28px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.22);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(circle at 20% 20%, rgba(99,102,241,.25) 0%, transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(236,72,153,.18) 0%, transparent 42%),
        radial-gradient(circle at 50% 80%, rgba(168,85,247,.16) 0%, transparent 45%);
      filter: blur(34px);
      opacity:.85;
      animation: drift 10s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes drift{
      from{ transform: translate3d(-10px,-8px,0) scale(1); }
      to{ transform: translate3d(10px,8px,0) scale(1.06); }
    }
    .panel > *{ position:relative; z-index:2; }

    .head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .title{
      font-family:"Space Grotesk",system-ui,sans-serif;
      font-weight:1000;
      font-size:16px;
      margin:0;
      letter-spacing:-.2px;
    }
    .subtitle{
      margin-top:4px;
      font-size:12px;
      font-weight:900;
      color: var(--muted);
      line-height:1.45;
    }
    .badge{
      padding:8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      font-weight:1000;
      font-size:12px;
      color: rgba(165,180,252,0.95);
      white-space:nowrap;
    }

    /* Daktilo brifing */
    .brief{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      padding: 12px;
      overflow:hidden;
    }
    .briefTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .tag{
      font-size: 11px;
      font-weight: 1000;
      color: rgba(255,255,255,0.90);
      display:flex;
      gap:8px;
      align-items:center;
    }
    .tag .ai{
      background: var(--aiGrad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      font-weight:1000;
    }
    .typeLine{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      font-weight: 700;
      color: rgba(255,255,255,0.86);
      line-height: 1.55;
      white-space: pre-wrap;
      min-height: 64px;
    }
    .cursor{
      display:inline-block;
      width: 7px;
      height: 14px;
      background: rgba(165,180,252,0.95);
      margin-left: 2px;
      vertical-align: middle;
      animation: blink 1s infinite;
      border-radius: 2px;
    }
    @keyframes blink{ 0%,100%{opacity:1} 50%{opacity:0} }

    /* Ders i√ßerik kartƒ± */
    .lesson{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.16);
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .lesson::-webkit-scrollbar{ display:none; }

    .secTitle{
      font-size: 12px;
      font-weight: 1000;
      letter-spacing:.6px;
      color: rgba(165,180,252,0.95);
      text-transform: uppercase;
    }
    .txt{
      font-size: 13px;
      font-weight: 900;
      color: rgba(255,255,255,0.86);
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .ex{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      padding: 10px;
    }
    .ex .a{
      font-weight:1000;
      font-size: 13px;
    }
    .ex .tr{
      margin-top:6px;
      font-weight:900;
      font-size: 12px;
      color: rgba(255,255,255,0.70);
    }

    /* G√∂rev */
    .task{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      padding: 12px;
    }
    .q{ font-weight:1000; font-size:13px; line-height:1.25; }
    .qSub{ margin-top:6px; font-size:12px; font-weight:900; color: var(--muted); line-height:1.35; }
    .inp{
      margin-top:10px;
      width:100%;
      height:48px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:#fff;
      font-weight:900;
      font-size:14px;
      padding: 0 12px;
    }
    .inp::placeholder{ color: rgba(255,255,255,0.45); }

    .rowBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      flex:1;
      min-width: 140px;
      height:54px;
      border-radius:22px;
      border:none;
      cursor:pointer;
      font-weight:1000;
      font-size:14px;
      color:#070714;
      background: var(--aiGrad);
      box-shadow: 0 16px 44px rgba(79,70,229,.22);
    }
    .btn:active{ transform: scale(.99); }
    .ghost{
      flex:1;
      min-width: 140px;
      height:54px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:#fff;
      font-weight:1000;
      font-size:13px;
      cursor:pointer;
    }
    .ghost:active{ transform: scale(.99); }

    .hintRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 2px;
    }
    .linkPill{
      flex:1;
      min-width: 140px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.14);
      color:#fff;
      font-weight:1000;
      font-size: 12px;
      cursor:pointer;
      text-align:center;
      user-select:none;
    }
    .linkPill:active{ transform: scale(.99); }

    .toast{
      position: fixed;
      left:50%;
      top:18px;
      transform:translateX(-50%) translateY(-120px);
      background:rgba(10,10,18,.92);
      border:1px solid rgba(165,180,252,.35);
      padding:10px 14px;
      border-radius:999px;
      color:#fff;
      z-index:99999;
      font-weight:900;
      font-size:12px;
      transition:.28s;
      backdrop-filter: blur(12px);
      pointer-events:none;
      max-width:min(92vw,520px);
      text-align:center;
    }
    .toast.show{ transform:translateX(-50%) translateY(0); }

    /* Continue modal */
    .overlay{ position:fixed; inset:0; background: rgba(0,0,0,0.55); backdrop-filter: blur(10px); display:none; align-items:center; justify-content:center; padding:16px; z-index:999999; }
    .overlay.show{ display:flex; }
    .modal{ width:min(520px,100%); border-radius:28px; border:1px solid rgba(255,255,255,0.12); background: rgba(10,10,18,0.92); padding:14px; }
    .mTitle{ font-family:"Space Grotesk",system-ui,sans-serif; font-size:16px; font-weight:1000; margin:6px 6px 10px; }
    .mText{ font-size:13px; font-weight:900; color: rgba(255,255,255,0.78); line-height:1.5; margin: 0 6px; white-space:pre-wrap; }
    .mBtns{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
  </style>
</head>

<body>
<main id="pageContent">
  <div class="wrap">

    <div class="topRow">
      <div class="chip" id="whoChip"><span class="dot"></span> Ders ‚Ä¢ ‚Äî</div>
      <div class="chip" id="timerChip">15:00</div>
    </div>

    <section class="panel">
      <div class="head">
        <div>
          <h2 class="title" id="title">Ders Ba≈ülƒ±yor</h2>
          <div class="subtitle" id="subtitle">‚Äî</div>
        </div>
        <div class="badge" id="badge">Seviye: ‚Äî</div>
      </div>

      <div class="brief">
        <div class="briefTop">
          <div class="tag"><span class="ai">AI</span> KO√á BRƒ∞Fƒ∞NG</div>
          <div class="tag" id="miniTag">15 dk</div>
        </div>
        <div class="typeLine" id="typeBox">Hazƒ±rlanƒ±yor<span class="cursor"></span></div>
      </div>

      <div class="lesson" id="lessonBox">
        <div class="secTitle" id="secTopic">KONU</div>
        <div class="txt" id="topicText">‚Äî</div>

        <div class="secTitle">√ñRNEKLER</div>
        <div id="examples"></div>

        <div class="secTitle">HIZLI ƒ∞PUCU</div>
        <div class="txt" id="tipText">‚Äî</div>
      </div>

      <div class="task">
        <div class="q" id="qText">‚Ä¶</div>
        <div class="qSub" id="qTr">‚Ä¶</div>
        <input class="inp" id="answer" placeholder="Cevabƒ±nƒ± yaz..." />
      </div>

      <div class="rowBtns">
        <button class="btn" id="btnSend" type="button">G√∂nder</button>
        <button class="ghost" id="btnFinish" type="button">Dersi Bitir</button>
        <button class="ghost" id="btnExit" type="button">√áƒ±k</button>
      </div>

      <div class="hintRow">
        <div class="linkPill" id="goPractice">AI ile Pratik Yap</div>
        <div class="linkPill" id="goGames">Eƒülenerek √ñƒüren</div>
      </div>
    </section>

  </div>
</main>

<div class="toast" id="toast"></div>

<div class="overlay" id="continueOverlay">
  <div class="modal">
    <div class="mTitle">Devam Edelim mi?</div>
    <div class="mText" id="continueText">‚Äî</div>
    <div class="mBtns">
      <button class="btn" id="btnContinueYes" type="button">Evet, Devam</button>
      <button class="ghost" id="btnContinueNo" type="button">Bug√ºnl√ºk Bu Kadar</button>
    </div>
  </div>
</div>

<script type="module">
  import { mountShell, setHeaderTokens } from "/js/ui_shell.js";
  import { bootPage } from "/js/ui_guard.js";
  import { supabase } from "/js/supabase_client.js";

  // ‚úÖ ui_shell ile oturt
  mountShell({ scroll:"auto" });
  bootPage({ protectedPage:true, header:{ nameId:"userName", picId:"userPic" } });

  const $ = (id)=>document.getElementById(id);

  function toast(msg){
    const t = $("toast");
    t.textContent = String(msg||"");
    t.classList.add("show");
    clearTimeout(window.__to);
    window.__to = setTimeout(()=>t.classList.remove("show"), 1600);
  }

  function qs(k){ return new URLSearchParams(location.search).get(k); }

  function firstNameNoLast(full){
    const s = String(full||"").trim().replace(/\s+/g," ");
    if(!s) return "";
    const parts = s.split(" ").filter(Boolean);
    if(parts.length === 1) return parts[0];
    // 2+ kelime varsa son kelimeyi soyad say
    return parts.slice(0, -1).join(" ");
  }

  // Dil adlarƒ±
  const LANG_TR = { en:"ƒ∞ngilizce", de:"Almanca", fr:"Fransƒ±zca", it:"ƒ∞talyanca", ru:"Rus√ßa", es:"ƒ∞spanyolca" };

  // Basit ders planƒ± (AI yoksa da ger√ßek ders)
  const PLAN = {
    en: {
      A1: { topic:"Present Simple (I/You/We/They)", tip:"I/You/We/They + verb (go, work, live). He/She/It i√ßin -s gelir.",
        examples:[ ["I work every day.","Her g√ºn √ßalƒ±≈üƒ±rƒ±m."], ["We live in D√ºzce.","D√ºzce'de ya≈üarƒ±z."] ],
        task:"Write 1 Present Simple sentence about your day.",
        task_tr:"G√ºn√ºn hakkƒ±nda Present Simple ile 1 c√ºmle yaz."
      },
      A2: { topic:"Past Simple (regular/irregular)", tip:"Ge√ßmi≈üte bitmi≈ü olay: yesterday/last week. Regular: -ed, irregular: go‚Üíwent.",
        examples:[ ["I visited my friend yesterday.","D√ºn arkada≈üƒ±mƒ± ziyaret ettim."], ["I went to the market.","Markete gittim."] ],
        task:"Write 2 past sentences: 1 regular, 1 irregular.",
        task_tr:"2 ge√ßmi≈ü zaman c√ºmlesi yaz: 1 d√ºzenli (-ed), 1 d√ºzensiz."
      },
      B1: { topic:"Present Perfect vs Past Simple", tip:"Present Perfect: deneyim/sonu√ß (have/has + V3). Past Simple: zaman belli (last year).",
        examples:[ ["I have been to Ankara.","Ankara'ya gittim (deneyim)."], ["I went to Ankara last year.","Ge√ßen yƒ±l Ankara'ya gittim."] ],
        task:"Write 2 sentences: 1 Present Perfect, 1 Past Simple.",
        task_tr:"2 c√ºmle yaz: 1 Present Perfect, 1 Past Simple."
      },
      B2: { topic:"Conditionals (If)", tip:"If + past ‚Üí would (2nd conditional). If + present ‚Üí will (1st conditional).",
        examples:[ ["If I had time, I would travel more.","Zamanƒ±m olsa daha √ßok gezerdim."], ["If it rains, I will stay home.","Yaƒümur yaƒüarsa evde kalacaƒüƒ±m."] ],
        task:"Write 1 conditional sentence about your life.",
        task_tr:"Hayatƒ±nla ilgili 1 ≈üart c√ºmlesi (if) yaz."
      },
      C1: { topic:"Cohesive writing (linkers)", tip:"Although/However/Therefore gibi baƒüla√ßlarla akƒ±cƒ± c√ºmle kur.",
        examples:[ ["Although it seems easy, it requires planning.","Kolay g√∂r√ºnse de planlama ister."], ["However, we can improve quickly.","Yine de hƒ±zlƒ± geli≈üebiliriz."] ],
        task:"Write 1 sentence using 'Although' or 'However'.",
        task_tr:"'Although' veya 'However' ile 1 c√ºmle yaz."
      }
    },
    de: { A1:{topic:"Pr√§sens (ich/du/wir)", tip:"ich/wir + Verb. du + -st.", examples:[["Ich arbeite jeden Tag.","Her g√ºn √ßalƒ±≈üƒ±rƒ±m."],["Wir wohnen in D√ºzce.","D√ºzce'de ya≈üarƒ±z."]], task:"Schreibe 1 Satz im Pr√§sens √ºber deinen Tag.", task_tr:"G√ºn√ºn hakkƒ±nda Almanca geni≈ü zamanda 1 c√ºmle yaz."} },
    fr: { A1:{topic:"Pr√©sent (je/tu/nous)", tip:"je/nous + verbe. tu + -s (souvent).", examples:[["Je travaille tous les jours.","Her g√ºn √ßalƒ±≈üƒ±rƒ±m."],["Nous habitons √† D√ºzce.","D√ºzce'de ya≈üarƒ±z."]], task:"√âcris 1 phrase au pr√©sent sur ta journ√©e.", task_tr:"G√ºn√ºn hakkƒ±nda Fransƒ±zca ≈üimdiki zamanda 1 c√ºmle yaz."} },
    it: { A1:{topic:"Presente (io/tu/noi)", tip:"io/noi + verbo. tu genelde -i.", examples:[["Io lavoro ogni giorno.","Her g√ºn √ßalƒ±≈üƒ±rƒ±m."],["Noi viviamo a D√ºzce.","D√ºzce'de ya≈üarƒ±z."]], task:"Scrivi 1 frase al presente sulla tua giornata.", task_tr:"G√ºn√ºn hakkƒ±nda ƒ∞talyanca ≈üimdiki zamanda 1 c√ºmle yaz."} },
    ru: { A1:{topic:"–ù–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è", tip:"–ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.", examples:[["–Ø —É—á—É —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫.","Rus√ßa √∂ƒüreniyorum."],["–Ø –∂–∏–≤—É –≤ –î—é–∑–¥–∂–µ.","D√ºzce'de ya≈üƒ±yorum."]], task:"–ù–∞–ø–∏—à–∏ 1 –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ —Å–µ–±–µ.", task_tr:"Kendin hakkƒ±nda Rus√ßa 1 basit c√ºmle yaz."} },
    es: { A1:{topic:"Presente", tip:"Frases cortas: Yo + verbo.", examples:[["Yo estudio espa√±ol.","ƒ∞spanyolca √ßalƒ±≈üƒ±yorum."],["Yo vivo en D√ºzce.","D√ºzce'de ya≈üƒ±yorum."]], task:"Escribe 1 frase en presente sobre tu d√≠a.", task_tr:"G√ºn√ºn hakkƒ±nda ƒ∞spanyolca geni≈ü zamanda 1 c√ºmle yaz."} }
  };

  function pickPlan(lang, lvl){
    const byLang = PLAN[lang] || PLAN.en;
    return byLang[lvl] || byLang.A1 || PLAN.en.A1;
  }

  // Daktilo
  async function typeWrite(text){
    const box = $("typeBox");
    box.textContent = "";
    for(let i=0;i<text.length;i++){
      const ch = text[i];
      box.textContent += ch;
      const delay = (".!?".includes(ch) ? 160 : 18);
      await new Promise(r=>setTimeout(r, delay));
    }
    box.innerHTML = box.textContent + `<span class="cursor"></span>`;
  }

  // --------- SESSION ----------
  const { data:{ session } } = await supabase.auth.getSession();
  if(!session?.user){ location.replace("/pages/login.html"); throw new Error("no session"); }
  const userId = session.user.id;

  const { data: prof } = await supabase
    .from("profiles")
    .select("tokens, full_name, levels")
    .eq("id", userId)
    .maybeSingle();

  const tokens = Number(prof?.tokens ?? 0);
  try{ setHeaderTokens(tokens); }catch{}

  const student = firstNameNoLast(prof?.full_name) || "Oƒüuz";

  const teacherId = (localStorage.getItem("italky_teacher_pref") || "").trim();
  // teacherId yoksa en azƒ±ndan dili URL‚Äôden al
  const lang = String(qs("lang") || (teacherId==="ayda"?"de":teacherId==="jale"?"fr":teacherId==="sencer"?"it":teacherId==="sungur"?"ru":teacherId==="ozan"?"es":"en")).toLowerCase();
  const lvl = String(qs("level") || (prof?.levels?.[lang] || "A1")).toUpperCase();
  const langNameTR = LANG_TR[lang] || lang.toUpperCase();

  $("whoChip").textContent = `${langNameTR} ‚Ä¢ 15 dk`;
  $("badge").textContent = `Seviye: ${lvl}`;
  $("title").textContent = `${langNameTR} Dersi`;
  $("subtitle").textContent = `Odak: ger√ßek ders akƒ±≈üƒ± ‚Ä¢ kƒ±sa g√∂revlerle ilerleme`;

  // y√∂nlendirme
  $("goPractice").onclick = ()=>location.href=`/pages/practice_ai_session.html?lang=${encodeURIComponent(lang)}&level=${encodeURIComponent(lvl)}`;
  $("goGames").onclick = ()=>location.href=`/pages/game_lang_select.html?lang=${encodeURIComponent(lang)}`;

  // i√ßerik doldur
  const plan = pickPlan(lang, lvl);
  $("secTopic").textContent = "KONU";
  $("topicText").textContent = `${plan.topic}`;
  $("tipText").textContent = plan.tip;

  const exWrap = $("examples");
  exWrap.innerHTML = "";
  (plan.examples || []).forEach(([a,tr])=>{
    const d = document.createElement("div");
    d.className = "ex";
    d.innerHTML = `<div class="a"></div><div class="tr"></div>`;
    d.querySelector(".a").textContent = a;
    d.querySelector(".tr").textContent = tr;
    exWrap.appendChild(d);
  });

  function setTask(t, tr){
    $("qText").textContent = t || "Bir c√ºmle yaz.";
    $("qTr").textContent = tr || "Bir c√ºmle yaz.";
    $("answer").value = "";
  }
  setTask(plan.task, plan.task_tr);

  // Brifing metni (anlatƒ±cƒ± + y√∂nlendirmeli) ‚Äî SES YOK (sadece daktilo)
  const briefing =
`Selam ${student}.
Seninle 15 dakika boyunca ${langNameTR} dersinde birlikte √ßalƒ±≈üacaƒüƒ±z.

Bu 15 dakikanƒ±n sonunda:
‚Ä¢ Devam edebilir veya ara verebilirsin.
‚Ä¢ Tavsiyem: G√ºnde en az 60 dakika √ßalƒ±≈üma.

Ders dƒ±≈üƒ± destek:
‚Ä¢ "AI ile Pratik Yap" ile konu≈üma hƒ±zƒ±n artar.
‚Ä¢ "Eƒülenerek √ñƒüren" oyunlarƒ±yla peki≈ütirirsin.

Hazƒ±rsan a≈üaƒüƒ±daki g√∂revi √ß√∂zerek ba≈ülayalƒ±m.`;

  await typeWrite(briefing);

  // Timer
  let remaining = 15*60;
  const tick = setInterval(()=>{
    remaining = Math.max(0, remaining-1);
    $("timerChip").textContent = `${String(Math.floor(remaining/60)).padStart(2,"0")}:${String(remaining%60).padStart(2,"0")}`;
    if(remaining===0){
      clearInterval(tick);
      $("continueText").textContent = `15 dakika tamamlandƒ±.\n\nDevam etmek ister misin?`;
      $("continueOverlay").classList.add("show");
    }
  }, 1000);

  // G√∂nder -> basit feedback (AI yoksa da ders akƒ±yor)
  function basicFeedback(txt){
    const t = (txt||"").trim();
    if(!t) return { ok:false, teacher:"C√ºmle g√∂remedim üôÇ Bir tane yazƒ±p g√∂nder.", tr:"Bo≈ü mesaj." };

    const ok = t.length >= 10;
    if(ok){
      return {
        ok:true,
        teacher:"G√ºzel! ≈ûimdi aynƒ± anlamƒ± farklƒ± kelimelerle yeniden yaz.",
        tr:"ƒ∞yi gidiyor. Aynƒ± anlamƒ± farklƒ± kelimelerle tekrar yaz."
      };
    }
    return {
      ok:false,
      teacher:"Biraz kƒ±sa kaldƒ±. 10+ karakter olacak ≈üekilde tekrar yaz.",
      tr:"C√ºmleni biraz uzatƒ±p tekrar dene."
    };
  }

  $("btnSend").onclick = ()=>{
    const txt = ($("answer").value || "").trim();
    if(!txt){ toast("Cevabƒ±nƒ± yaz üôÇ"); return; }
    $("answer").value = "";

    // kullanƒ±cƒ± c√ºmlesini √ºstte mini ‚Äúders i√ßeriƒüi‚Äù gibi tutmak yerine toast + g√∂revle ilerliyoruz
    const fb = basicFeedback(txt);
    toast(fb.ok ? "‚úÖ G√ºzel!" : "‚Üª Tekrar dene");
    setTask(
      fb.ok ? "Rewrite your sentence using different words." : plan.task,
      fb.ok ? "C√ºmleni farklƒ± kelimelerle yeniden yaz." : plan.task_tr
    );
  };

  $("btnFinish").onclick = ()=>{
    $("continueText").textContent = `Dersi bitirdin.\n\nDevam etmek ister misin?`;
    $("continueOverlay").classList.add("show");
  };

  $("btnExit").onclick = ()=>location.href="/pages/home.html";

  $("btnContinueYes").onclick = ()=>{
    $("continueOverlay").classList.remove("show");
    remaining = 15*60;
    toast("Devam ediyoruz‚Ä¶");
    setTask(plan.task, plan.task_tr);
  };
  $("btnContinueNo").onclick = ()=>{
    $("continueOverlay").classList.remove("show");
    location.href="/pages/plan_select.html";
  };
</script>
</body>
</html>
