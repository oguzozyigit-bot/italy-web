<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ITALKY ‚Ä¢ Duo Battle</title>
  <link rel="icon" href="data:,"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    /* --- TEMEL AYARLAR --- */
    :root {
      --bg-deep: #020205; 
      --text-main: #ffffff;
      --c-cyan: #00f3ff;
      --c-pink: #ff00aa;
      --c-green: #beF264;
      --c-red: #ff5252;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; user-select:none; }
    html, body { margin:0; height:100dvh; overflow:hidden; font-family:'Outfit', sans-serif; background:var(--bg-deep); color:var(--text-main); }

    /* --- ATMOSFER --- */
    .cosmos-bg { position:absolute; inset:0; background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%); z-index:0; }
    .star-dust { position: absolute; inset: 0; opacity: 0.4; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 50px 50px; animation: dustMove 100s linear infinite; }
    @keyframes dustMove { from { transform: translateY(0); } to { transform: translateY(-500px); } }

    .wrap { width:100%; max-width:480px; height:100%; margin:0 auto; position:relative; z-index:10; display:flex; flex-direction:column; }

    /* --- NAVIGATION --- */
    .nav-layer { position:absolute; top:0; left:0; width:100%; height:70px; z-index:50; display:flex; justify-content:space-between; padding:12px; pointer-events:none; }
    .nav-btn { pointer-events:auto; height:44px; padding:0 16px; border-radius:14px; background:rgba(0,0,0,0.4); border:1px solid var(--border); color:#fff; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(10px); cursor:pointer; font-weight:700; font-size:14px; gap:6px; box-shadow:0 10px 30px rgba(0,0,0,0.3); transition:0.2s; }
    .nav-btn:active { transform:scale(0.95); }
    .back-btn { width:44px; padding:0; font-size:20px; }

    /* --- GRID LAYOUT --- */
    .grid { flex:1; display:grid; grid-template-rows: 1fr 80px 1fr; gap:12px; padding:70px 12px 20px; }

    /* --- OYUNCU KARTLARI --- */
    .pane {
      position:relative; border-radius:24px; border:1px solid var(--border);
      background: linear-gradient(160deg, rgba(255,255,255,0.03), rgba(0,0,0,0.4));
      backdrop-filter:blur(10px);
      display:flex; flex-direction:column; overflow:hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    /* Aktif Oyuncu Vurgusu */
    .pane.active { border-color:var(--c-cyan); box-shadow: 0 0 30px rgba(0,243,255,0.15); }
    
    /* √úst Oyuncu (Ters D√∂nm√º≈ü - Y√ºz Y√ºze Oyun ƒ∞√ßin) */
    .pane.top { transform: rotate(180deg); }

    /* Header Bar */
    .bar {
      padding:12px 16px; background:rgba(0,0,0,0.3); border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center; font-family:'Space Grotesk', sans-serif;
    }
    .p-name { font-weight:700; font-size:15px; letter-spacing:0.5px; opacity:0.9; }
    .p-score { font-weight:700; color:var(--c-green); }

    /* Progress */
    .prog-wrap { padding:12px 16px 0; }
    .prog-track { height:6px; background:rgba(255,255,255,0.1); border-radius:10px; overflow:hidden; }
    .prog-fill { height:100%; width:0%; background:var(--c-green); transition: width 0.3s ease; box-shadow:0 0 10px var(--c-green); }
    .prog-meta { display:flex; justify-content:space-between; margin-top:6px; font-size:11px; opacity:0.6; font-weight:600; text-transform:uppercase; }

    /* Kelime Alanƒ± */
    .body { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:6px; padding:10px; }
    .word { font-size:32px; font-weight:800; color:#fff; font-family:'Space Grotesk', sans-serif; text-align:center; }
    .meaning { font-size:16px; color:rgba(255,255,255,0.6); font-weight:500; }
    .hint { font-size:12px; color:var(--c-cyan); font-weight:700; margin-top:8px; opacity:0; transition:0.3s; text-transform:uppercase; letter-spacing:1px; }
    .pane.active .hint { opacity:1; }

    /* Buton Alanƒ± */
    .actions { padding:16px; display:flex; justify-content:center; }
    .mic-btn {
      width:100%; padding:14px; border-radius:16px; border:1px solid var(--border);
      background:rgba(255,255,255,0.05); color:#fff; font-weight:700; font-size:16px;
      cursor:pointer; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:8px;
    }
    .pane.active .mic-btn {
      background: linear-gradient(135deg, var(--c-cyan), #0066ff); border:none;
      box-shadow: 0 10px 30px rgba(0,243,255,0.3);
    }
    .mic-btn:disabled { opacity:0.3; cursor:not-allowed; transform:none !important; background:rgba(255,255,255,0.05) !important; box-shadow:none !important; }
    .mic-btn:active { transform:scale(0.96); }

    /* --- ORTA WAVE ALANI --- */
    .wave-box {
      border-radius:20px; background:rgba(0,0,0,0.6); border:1px solid var(--border);
      backdrop-filter:blur(10px); display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:8px; position:relative; overflow:hidden;
    }
    .wave-status { font-size:12px; font-weight:700; opacity:0.8; letter-spacing:1px; text-transform:uppercase; color:var(--c-cyan); }
    
    .bars { display:flex; gap:4px; height:24px; align-items:center; }
    .b { width:4px; height:8px; background:rgba(255,255,255,0.3); border-radius:4px; transition:0.2s; }
    
    /* Animasyonlar */
    .wave-box.speaking .b { background:var(--c-green); animation: bounce 0.6s infinite ease-in-out; }
    .wave-box.listening .b { background:var(--c-cyan); animation: bounce 0.5s infinite ease-in-out; }
    .wave-box.speaking .wave-status { color:var(--c-green); }
    .wave-box.listening .wave-status { color:var(--c-cyan); }

    @keyframes bounce { 0%,100%{height:8px} 50%{height:24px} }
    .b:nth-child(1){animation-delay:0s} .b:nth-child(2){animation-delay:0.1s} .b:nth-child(3){animation-delay:0.2s}
    .b:nth-child(4){animation-delay:0.3s} .b:nth-child(5){animation-delay:0.4s}

    /* --- SONU√á OVERLAY --- */
    .result-overlay {
      position:absolute; inset:0; z-index:20; background:rgba(0,0,0,0.8);
      display:none; flex-direction:column; align-items:center; justify-content:center;
      backdrop-filter:blur(5px); animation:fadeIn 0.3s;
    }
    .result-overlay.show { display:flex; }
    .res-icon { font-size:64px; margin-bottom:10px; animation:popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .res-text { font-size:18px; font-weight:800; font-family:'Space Grotesk', sans-serif; text-transform:uppercase; letter-spacing:2px; }
    .ok .res-text { color:var(--c-green); }
    .bad .res-text { color:var(--c-red); }

    @keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    /* --- BA≈ûLANGI√á & MODALLER --- */
    .modal-wrap {
      position:absolute; inset:0; background:rgba(0,0,0,0.85); z-index:999;
      display:flex; align-items:center; justify-content:center; backdrop-filter:blur(15px);
    }
    .modal-card {
      width:85%; background:#101014; border:1px solid var(--border); border-radius:24px; padding:24px;
      text-align:center; box-shadow:0 20px 60px rgba(0,0,0,0.8); animation: popIn 0.5s;
    }
    .modal-title { font-size:20px; font-weight:800; margin-bottom:16px; font-family:'Space Grotesk', sans-serif; }
    .modal-p { font-size:14px; opacity:0.7; margin-bottom:24px; line-height:1.5; }
    
    .btn-primary {
      width:100%; padding:16px; border-radius:16px; border:none;
      background:linear-gradient(135deg, var(--c-cyan), #0066ff); color:#fff;
      font-weight:800; font-size:16px; cursor:pointer; box-shadow:0 10px 30px rgba(0,100,255,0.3);
    }
    .btn-sec { background:rgba(255,255,255,0.1); margin-top:10px; color:#fff; }

    /* Dil Se√ßimi Grid */
    .lang-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .lang-opt { padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:14px; font-weight:700; cursor:pointer; transition:0.2s; }
    .lang-opt:hover { background:rgba(255,255,255,0.1); border-color:var(--c-cyan); }

  </style>
</head>
<body>

  <div class="cosmos-bg"><div class="star-dust"></div></div>

  <div class="wrap">
    <div class="nav-layer">
      <button class="nav-btn back-btn" id="backBtn">‚Üê</button>
      <button class="nav-btn" id="langBtn">üåç Dil Se√ß</button>
    </div>

    <div class="grid">
      
      <section class="pane top" id="paneB">
        <div class="bar">
          <div class="p-name">OYUNCU B</div>
          <div class="p-score" id="scoreB">Set: 0</div>
        </div>
        <div class="prog-wrap">
          <div class="prog-track"><div class="prog-fill" id="fillB"></div></div>
          <div class="prog-meta"><span id="corrB">0/20 Doƒüru</span><span id="turnB">Bekliyor</span></div>
        </div>
        <div class="body">
          <div class="word" id="wordB">---</div>
          <div class="meaning" id="meanB">---</div>
          <div class="hint">SENƒ∞N SIRAN</div>
        </div>
        <div class="actions">
          <button class="mic-btn" id="micB" disabled>üéôÔ∏è Konu≈ü</button>
        </div>
        <div class="result-overlay" id="ovB">
          <div class="res-icon" id="iconB">‚úÖ</div>
          <div class="res-text" id="textB">M√úKEMMEL</div>
        </div>
      </section>

      <div class="wave-box" id="waveBox">
        <div class="wave-status" id="waveStatus">HAZIR</div>
        <div class="bars">
          <div class="b"></div><div class="b"></div><div class="b"></div><div class="b"></div><div class="b"></div>
        </div>
      </div>

      <section class="pane" id="paneA">
        <div class="bar">
          <div class="p-name">OYUNCU A</div>
          <div class="p-score" id="scoreA">Set: 0</div>
        </div>
        <div class="prog-wrap">
          <div class="prog-track"><div class="prog-fill" id="fillA"></div></div>
          <div class="prog-meta"><span id="corrA">0/20 Doƒüru</span><span id="turnA">Bekliyor</span></div>
        </div>
        <div class="body">
          <div class="word" id="wordA">---</div>
          <div class="meaning" id="meanA">---</div>
          <div class="hint">SENƒ∞N SIRAN</div>
        </div>
        <div class="actions">
          <button class="mic-btn" id="micA" disabled>üéôÔ∏è Konu≈ü</button>
        </div>
        <div class="result-overlay" id="ovA">
          <div class="res-icon" id="iconA">‚úÖ</div>
          <div class="res-text" id="textA">M√úKEMMEL</div>
        </div>
      </section>

    </div>
  </div>

  <div class="modal-wrap" id="startModal">
    <div class="modal-card">
      <div class="modal-title">DUO BATTLE ü•ä</div>
      <div class="modal-p">
        Telefonu iki ki≈üinin arasƒ±na koyun.<br>
        Sƒ±rayla kelimeleri okuyun.<br>
        En iyi telaffuz eden kazanƒ±r!
      </div>
      <button class="btn-primary" id="startBtn">BA≈ûLA</button>
    </div>
  </div>

  <div class="modal-wrap" id="langModal" style="display:none">
    <div class="modal-card">
      <div class="modal-title">Dil Se√ßimi</div>
      <div class="lang-grid">
        <div class="lang-opt" data-lang="en">üá¨üáß ƒ∞ngilizce</div>
        <div class="lang-opt" data-lang="de">üá©üá™ Almanca</div>
        <div class="lang-opt" data-lang="fr">üá´üá∑ Fransƒ±zca</div>
        <div class="lang-opt" data-lang="it">üáÆüáπ ƒ∞talyanca</div>
      </div>
      <button class="btn-primary btn-sec" id="closeLang">Kapat</button>
    </div>
  </div>

  <div class="modal-wrap" id="endModal" style="display:none">
    <div class="modal-card">
      <div class="modal-title">OYUN Bƒ∞TTƒ∞! üéâ</div>
      <div class="modal-p" id="endResult">Sonu√ßlar y√ºkleniyor...</div>
      <button class="btn-primary" id="restartBtn">YENƒ∞ MA√á</button>
      <button class="btn-primary btn-sec" onclick="location.href='/pages/home.html'">√áIKI≈û</button>
    </div>
  </div>

<script>
/* =========================================
   KELƒ∞ME HAVUZU (TURKISH MEANINGS)
   ========================================= */
const WORDS = {
  en: [
    ["apple","elma"],["water","su"],["bread","ekmek"],["friend","arkada≈ü"],["price","fiyat"],
    ["hello","merhaba"],["goodbye","g√ºle g√ºle"],["thank you","te≈üekk√ºrler"],["please","l√ºtfen"],
    ["school","okul"],["house","ev"],["car","araba"],["money","para"],["time","zaman"],
    ["book","kitap"],["pen","kalem"],["phone","telefon"],["computer","bilgisayar"],["table","masa"],
    ["coffee","kahve"],["tea","√ßay"],["milk","s√ºt"],["music","m√ºzik"],["love","a≈ük"]
  ],
  de: [
    ["Apfel","elma"],["Wasser","su"],["Brot","ekmek"],["Freund","arkada≈ü"],["Preis","fiyat"],
    ["Hallo","merhaba"],["Tsch√ºss","g√ºle g√ºle"],["Danke","te≈üekk√ºrler"],["Bitte","l√ºtfen"],
    ["Schule","okul"],["Haus","ev"],["Auto","araba"],["Geld","para"],["Zeit","zaman"],
    ["Buch","kitap"],["Stift","kalem"],["Handy","telefon"],["Tisch","masa"],["Kaffee","kahve"]
  ],
  fr: [
    ["pomme","elma"],["eau","su"],["pain","ekmek"],["ami","arkada≈ü"],["prix","fiyat"],
    ["bonjour","merhaba"],["au revoir","g√ºle g√ºle"],["merci","te≈üekk√ºrler"],["s'il vous pla√Æt","l√ºtfen"],
    ["√©cole","okul"],["maison","ev"],["voiture","araba"],["argent","para"],["temps","zaman"]
  ],
  it: [
    ["mela","elma"],["acqua","su"],["pane","ekmek"],["amico","arkada≈ü"],["prezzo","fiyat"],
    ["ciao","merhaba"],["arrivederci","g√ºle g√ºle"],["grazie","te≈üekk√ºrler"],["per favore","l√ºtfen"],
    ["scuola","okul"],["casa","ev"],["macchina","araba"],["soldi","para"],["tempo","zaman"]
  ]
};

const LANG_CONFIG = {
  en: { code: "en-US", name: "ƒ∞ngilizce" },
  de: { code: "de-DE", name: "Almanca" },
  fr: { code: "fr-FR", name: "Fransƒ±zca" },
  it: { code: "it-IT", name: "ƒ∞talyanca" }
};

/* =========================================
   OYUN MOTORU
   ========================================= */
let currentLang = "en";
let wordList = [];
let currentIndex = 0;
let turn = "A"; // A veya B
let isBusy = false;

// Skorlar
let stats = {
  A: { correct: 0, sets: 0 },
  B: { correct: 0, sets: 0 }
};

// DOM
const $ = (id) => document.getElementById(id);

// --- INIT ---
function initGame() {
  const urlParams = new URLSearchParams(window.location.search);
  currentLang = urlParams.get('lang') || 'en';
  if(!WORDS[currentLang]) currentLang = 'en';

  $("langBtn").textContent = "üåç " + LANG_CONFIG[currentLang].name;
  
  // Kelime Listesini Karƒ±≈ütƒ±r ve Hazƒ±rla
  let pool = [...WORDS[currentLang]];
  pool.sort(() => Math.random() - 0.5);
  wordList = pool.slice(0, 20); // 20 kelimelik set
  
  currentIndex = 0;
  stats.A.correct = 0;
  stats.B.correct = 0;
  
  updateUI();
  
  // √ñƒûRETMEN OKUMASIYLA BA≈ûLA
  setTimeout(() => teacherPhase(), 1000);
}

// --- UI G√úNCELLEME ---
function updateUI() {
  const w = wordList[currentIndex];
  
  // Text
  $("wordA").textContent = w[0]; $("meanA").textContent = w[1];
  $("wordB").textContent = w[0]; $("meanB").textContent = w[1];
  
  // Progress
  $("fillA").style.width = (stats.A.correct / 20 * 100) + "%";
  $("corrA").textContent = stats.A.correct + "/20 Doƒüru";
  $("scoreA").textContent = "Set: " + stats.A.sets;
  
  $("fillB").style.width = (stats.B.correct / 20 * 100) + "%";
  $("corrB").textContent = stats.B.correct + "/20 Doƒüru";
  $("scoreB").textContent = "Set: " + stats.B.sets;

  // Aktif Oyuncu G√∂rseli
  $("paneA").classList.remove("active");
  $("paneB").classList.remove("active");
  $("micA").disabled = true;
  $("micB").disabled = true;

  if (turn === "A") {
    $("paneA").classList.add("active");
    $("micA").disabled = false;
    $("turnA").textContent = "Sƒ±ra Sende";
    $("turnB").textContent = "Rakibi Bekle";
  } else {
    $("paneB").classList.add("active");
    $("micB").disabled = false;
    $("turnB").textContent = "Sƒ±ra Sende";
    $("turnA").textContent = "Rakibi Bekle";
  }
}

// --- √ñƒûRETMEN MODU (OKUMA) ---
async function teacherPhase() {
  isBusy = true;
  $("micA").disabled = true;
  $("micB").disabled = true;
  
  const w = wordList[currentIndex][0];
  
  setWave("speaking", "√ñƒüretmen Okuyor...");
  await speak(w);
  setWave("idle", "Sƒ±ra: Oyuncu " + turn);
  
  isBusy = false;
  // Butonlarƒ± aktif et
  if (turn === "A") $("micA").disabled = false;
  else $("micB").disabled = false;
}

// --- KONU≈ûMA SENTEZƒ∞ (TTS) ---
function speak(text) {
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = LANG_CONFIG[currentLang].code;
    u.rate = 0.9;
    u.onend = resolve;
    u.onerror = resolve;
    window.speechSynthesis.speak(u);
  });
}

// --- Dƒ∞NLEME (STT) ---
function listen(player) {
  if (isBusy || player !== turn) return;
  
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) { alert("Tarayƒ±cƒ± desteklemiyor."); return; }
  
  isBusy = true;
  $("micA").disabled = true;
  $("micB").disabled = true;
  setWave("listening", "Dinleniyor...");
  
  const recognition = new SR();
  recognition.lang = LANG_CONFIG[currentLang].code;
  recognition.interimResults = false;
  
  let heard = "";
  
  recognition.onresult = (e) => {
    heard = e.results[0][0].transcript;
  };
  
  recognition.onend = async () => {
    setWave("idle", "Kontrol Ediliyor...");
    await checkResult(player, heard);
  };
  
  recognition.onerror = () => {
    recognition.stop(); // Hata olsa da bitir
  };
  
  recognition.start();
}

// --- SONU√á KONTROL ---
async function checkResult(player, text) {
  const target = wordList[currentIndex][0].toLowerCase().replace(/[.,!?]/g,"");
  const input = text.toLowerCase().replace(/[.,!?]/g,"");
  
  // Basit benzerlik kontrol√º (Jaro-Winkler yerine basit includes/levenshtein basitle≈ütirilmi≈ü)
  const isCorrect = input === target || input.includes(target) || target.includes(input);
  
  showResultOverlay(player, isCorrect);
  
  if (isCorrect) {
    stats[player].correct++;
    // Doƒüru bilen devam eder (Winner stays)
    // Kelimeyi deƒüi≈ütir
    if (currentIndex < 19) {
      currentIndex++;
      updateUI();
      setTimeout(teacherPhase, 1500); // Biraz bekle sonra yeni kelime
    } else {
      endSet();
    }
  } else {
    // Yanlƒ±≈ü! Sƒ±ra diƒüerine ge√ßer.
    await new Promise(r => setTimeout(r, 2000)); // Hata mesajƒ±nƒ± g√∂rs√ºn
    turn = (turn === "A" ? "B" : "A");
    updateUI();
    // √ñƒüretmen kelimeyi tekrar hatƒ±rlatƒ±r
    setTimeout(teacherPhase, 500);
  }
}

function showResultOverlay(player, isOk) {
  const ov = $(player === "A" ? "ovA" : "ovB");
  const icon = $(player === "A" ? "iconA" : "iconB");
  const txt = $(player === "A" ? "textA" : "textB");
  
  ov.className = "result-overlay show " + (isOk ? "ok" : "bad");
  icon.textContent = isOk ? "‚úÖ" : "‚ùå";
  txt.textContent = isOk ? "HARƒ∞KA!" : "TEKRAR DENE";
  
  setTimeout(() => {
    ov.classList.remove("show");
  }, 1500);
}

function setWave(state, text) {
  const wb = $("waveBox");
  const st = $("waveStatus");
  wb.className = "wave-box " + state;
  st.textContent = text;
}

function endSet() {
  const winner = stats.A.correct > stats.B.correct ? "A" : (stats.B.correct > stats.A.correct ? "B" : "Berabere");
  if (winner === "A") stats.A.sets++;
  if (winner === "B") stats.B.sets++;
  
  $("endModal").style.display = "flex";
  $("endResult").innerHTML = `
    OYUNCU A: ${stats.A.correct} Doƒüru<br>
    OYUNCU B: ${stats.B.correct} Doƒüru<br><br>
    ${winner === "Berabere" ? "DOSTLUK KAZANDI!" : "KAZANAN: OYUNCU " + winner}
  `;
}

/* =========================================
   EVENT LISTENERS
   ========================================= */
$("startBtn").addEventListener("click", () => {
  $("startModal").style.display = "none";
  initGame(); // Ses motorunu ba≈ülatmak i√ßin kullanƒ±cƒ± etkile≈üimi ≈üart
});

$("backBtn").addEventListener("click", () => location.href="/pages/home.html");

$("micA").addEventListener("click", () => listen("A"));
$("micB").addEventListener("click", () => listen("B"));

$("restartBtn").addEventListener("click", () => {
  $("endModal").style.display = "none";
  initGame();
});

// Dil Se√ßimi
$("langBtn").addEventListener("click", () => $("langModal").style.display = "flex");
$("closeLang").addEventListener("click", () => $("langModal").style.display = "none");

document.querySelectorAll(".lang-opt").forEach(el => {
  el.addEventListener("click", () => {
    const l = el.getAttribute("data-lang");
    const u = new URL(location.href);
    u.searchParams.set("lang", l);
    location.href = u.toString();
  });
});

</script>
</body>
</html>
