<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>ITALKY â€¢ Arena V3</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050508;
      --border: rgba(255,255,255,0.1);
      --pA: #00f3ff; /* Cyan - A */
      --pB: #ff0055; /* Magenta - B */
      --green: #00e676;
      --red: #ff1744;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background: var(--bg); font-family: 'Outfit', sans-serif;
      color: #fff; overflow: hidden; position: fixed;
    }

    .bg-fx {
      position: absolute; inset: 0; z-index: 0;
      background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000 100%);
      opacity: 0.8;
    }

    /* ANA KONTEYNER */
    .arena-wrap {
      position: relative; z-index: 10;
      width: 100%; height: 100dvh; /* Mobilde tam otursun diye dvh */
      display: flex; flex-direction: column;
    }

    /* OYUNCU ALANLARI */
    .player-zone {
      flex: 1;
      position: relative;
      display: flex; 
      justify-content: center; 
      align-items: center; /* Ä°Ã§eriÄŸi ortala */
      transition: 0.3s ease;
      overflow: hidden;
    }

    /* OYUNCU B (ÃœST) */
    #zoneB { 
      border-bottom: 1px solid var(--border); 
      align-items: flex-end; /* B iÃ§in iÃ§eriÄŸi yukarÄ± (ters duracaÄŸÄ± iÃ§in aÅŸaÄŸÄ±) it */
      padding-bottom: 20px;
    }
    
    /* OYUNCU A (ALT) */
    #zoneA { 
      border-top: 1px solid var(--border); 
      align-items: flex-end; /* A iÃ§in iÃ§eriÄŸi aÅŸaÄŸÄ± it */
      padding-bottom: 40px; /* Safe area */
    }

    /* Ä°Ã‡ERÄ°K KARTI (DÃ¶ndÃ¼rme MantÄ±ÄŸÄ± Burada) */
    .card-content {
      width: 85%; max-width: 320px;
      display: flex; flex-direction: column;
      align-items: center; text-align: center;
      transition: 0.3s;
      position: relative; /* Overlay bunun iÃ§inde olacak */
    }

    /* B OYUNCUSUNU TERS Ã‡EVÄ°R */
    #zoneB .card-content {
      transform: rotate(180deg);
    }

    /* AKTÄ°FLÄ°K DURUMU (GÃ¶rsel ve MantÄ±k) */
    .player-zone { opacity: 0.3; pointer-events: none; filter: grayscale(0.8); }
    .player-zone.active { opacity: 1; pointer-events: auto; filter: grayscale(0); }
    
    /* Parlama Efekti */
    .player-zone.active::after {
      content:''; position:absolute; inset:0; pointer-events:none;
      box-shadow: inset 0 0 50px rgba(255,255,255,0.05);
    }

    /* METÄ°NLER */
    .player-label {
      font-size: 11px; font-weight: 900; letter-spacing: 2px;
      text-transform: uppercase; margin-bottom: 10px;
    }
    #zoneA .player-label { color: var(--pA); }
    #zoneB .player-label { color: var(--pB); }

    .main-word { font-family: 'Space Grotesk', sans-serif; font-size: 36px; font-weight: 700; line-height: 1.1; margin: 5px 0; }
    .sub-word { font-size: 16px; color: rgba(255,255,255,0.6); margin-bottom: 20px; min-height: 20px; }

    /* BUTONLAR */
    .controls { 
      display: flex; gap: 10px; width: 100%; margin-top: auto; 
    }
    
    .btn {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.1);
      color: #fff; padding: 15px 0;
      border-radius: 14px; font-weight: 800; font-size: 14px;
      cursor: pointer; flex: 1;
      transition: 0.2s;
    }
    .btn:active { transform: scale(0.95); }
    
    /* Mikrofon Butonu */
    .btn-mic { flex: 2; background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
    
    /* Dinleme Modu Renkleri */
    #zoneA .btn-mic.listening { background: var(--pA); color: #000; box-shadow: 0 0 25px var(--pA); border-color:var(--pA); animation: pulseA 1s infinite; }
    #zoneB .btn-mic.listening { background: var(--pB); color: #fff; box-shadow: 0 0 25px var(--pB); border-color:var(--pB); animation: pulseB 1s infinite; }

    @keyframes pulseA { 0% { box-shadow: 0 0 10px var(--pA); } 50% { box-shadow: 0 0 30px var(--pA); } 100% { box-shadow: 0 0 10px var(--pA); } }
    @keyframes pulseB { 0% { box-shadow: 0 0 10px var(--pB); } 50% { box-shadow: 0 0 30px var(--pB); } 100% { box-shadow: 0 0 10px var(--pB); } }

    /* ORTA SKOR */
    .arena-center {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 120px; height: 50px;
      background: #000; border: 1px solid var(--border);
      border-radius: 25px;
      display: flex; align-items: center; justify-content: center;
      z-index: 20; box-shadow: 0 0 30px #000;
    }
    .score-board { font-family: 'Space Grotesk'; font-size: 20px; font-weight: 700; display: flex; gap: 15px; align-items: center; }
    .score-item { display:flex; gap:5px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 8px;}

    /* SONUÃ‡ OVERLAY (KartÄ±n iÃ§inde, bÃ¶ylece o da dÃ¶nÃ¼yor) */
    .result-overlay {
      position: absolute; inset: -20px; /* Karttan biraz bÃ¼yÃ¼k */
      background: rgba(0,0,0,0.92); backdrop-filter: blur(8px);
      z-index: 50; 
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      border-radius: 20px;
      opacity: 0; pointer-events: none; transition: 0.2s;
      transform: scale(0.9);
    }
    .result-overlay.show { opacity: 1; transform: scale(1); pointer-events: auto; }
    
    .res-title { font-size: 32px; font-weight: 900; text-transform: uppercase; margin-bottom: 5px; }
    .res-sub { font-size: 14px; color: #ccc; }
    .correct .res-title { color: var(--green); }
    .wrong .res-title { color: var(--red); }

    /* MODAL */
    .modal {
      position: fixed; inset: 0; z-index: 100;
      background: rgba(0,0,0,0.95);
      display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(10px); transition: 0.3s;
    }
    .modal.hidden { opacity: 0; pointer-events: none; visibility: hidden; }
    .modal-box { width: 85%; max-width: 340px; background: #111; border: 1px solid var(--border); border-radius: 24px; padding: 25px; text-align: center; }
    .lang-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 25px; }
    .lang-opt { font-size: 24px; padding: 10px; border-radius: 10px; border: 1px solid var(--border); cursor: pointer; }
    .lang-opt.selected { background: #fff; color: #000; border-color: #fff; }
    .btn-block { width: 100%; padding: 16px; margin-bottom: 10px; border-radius: 14px; border:none; font-weight:800; cursor:pointer; font-size: 14px; text-transform:uppercase; }

  </style>
</head>
<body>

  <div class="bg-fx"></div>

  <div class="arena-wrap">
    
    <div class="player-zone" id="zoneB">
      <div class="card-content">
        <div class="result-overlay" id="ovB">
          <div class="res-title"></div>
          <div class="res-sub"></div>
        </div>

        <div class="controls">
          <button class="btn" onclick="game.pass()">PAS</button>
          <button class="btn btn-mic" id="micB" onclick="game.listen('B')">ğŸ™ï¸ CEVAPLA</button>
        </div>
        
        <div style="margin-top:auto; margin-bottom:auto">
          <div class="main-word" id="wB">...</div>
          <div class="sub-word" id="mB">...</div>
        </div>

        <div class="player-label" style="margin-top:20px">OYUNCU B</div>
      </div>
    </div>

    <div class="arena-center">
      <div class="score-board">
        <div class="score-item" style="color:var(--pB)">
          <span id="sB">0</span>
        </div>
        <span style="opacity:0.2">|</span>
        <div class="score-item" style="color:var(--pA)">
          <span id="sA">0</span>
        </div>
      </div>
    </div>

    <div class="player-zone" id="zoneA">
      <div class="card-content">
        <div class="result-overlay" id="ovA">
          <div class="res-title"></div>
          <div class="res-sub"></div>
        </div>

        <div class="player-label" style="margin-bottom:20px">OYUNCU A</div>

        <div style="margin-bottom:auto; margin-top:auto">
          <div class="main-word" id="wA">...</div>
          <div class="sub-word" id="mA">...</div>
        </div>

        <div class="controls">
          <button class="btn" onclick="game.pass()">PAS</button>
          <button class="btn btn-mic" id="micA" onclick="game.listen('A')">ğŸ™ï¸ CEVAPLA</button>
        </div>
      </div>
    </div>

  </div>

  <div class="modal" id="setupModal">
    <div class="modal-box">
      <h2 style="margin:0 0 20px 0; font-family:'Space Grotesk'">ARENA SETUP</h2>
      <div class="lang-grid">
        <div class="lang-opt selected" onclick="selectLang('en', this)">ğŸ‡¬ğŸ‡§</div>
        <div class="lang-opt" onclick="selectLang('de', this)">ğŸ‡©ğŸ‡ª</div>
        <div class="lang-opt" onclick="selectLang('fr', this)">ğŸ‡«ğŸ‡·</div>
        <div class="lang-opt" onclick="selectLang('es', this)">ğŸ‡ªğŸ‡¸</div>
        <div class="lang-opt" onclick="selectLang('it', this)">ğŸ‡®ğŸ‡¹</div>
      </div>
      <button class="btn-block" style="background:var(--pA); color:#000" onclick="game.init('pronunciation')">TELAFFUZ MODU</button>
      <button class="btn-block" style="background:var(--pB); color:#fff" onclick="game.init('vocabulary')">KELÄ°ME MODU</button>
    </div>
  </div>

<script>
// --- VERÄ°TABANI ---
const DB = {
  en: [
    { w: "Excellent", tr: "MÃ¼kemmel" }, { w: "Decision", tr: "Karar" },
    { w: "Challenge", tr: "Meydan okuma" }, { w: "Journey", tr: "Yolculuk" },
    { w: "Environment", tr: "Ã‡evre" }, { w: "Necessary", tr: "Gerekli" }
  ],
  de: [ { w: "Entscheidung", tr: "Karar" }, { w: "NatÃ¼rlich", tr: "DoÄŸal" }, { w: "Wichtig", tr: "Ã–nemli" }, { w: "Zusammen", tr: "Birlikte" } ],
  fr: [ { w: "Bonjour", tr: "Merhaba" }, { w: "Amour", tr: "AÅŸk" }, { w: "Voiture", tr: "Araba" }, { w: "Toujours", tr: "Her zaman" } ],
  es: [ { w: "Corazon", tr: "Kalp" }, { w: "Amigo", tr: "ArkadaÅŸ" }, { w: "Tiempo", tr: "Zaman" }, { w: "Felicidad", tr: "Mutluluk" } ],
  it: [ { w: "Ciao", tr: "Merhaba" }, { w: "Grazie", tr: "TeÅŸekkÃ¼rler" }, { w: "Famiglia", tr: "Aile" }, { w: "Piccolo", tr: "KÃ¼Ã§Ã¼k" } ]
};

let selLang = 'en';
function selectLang(c, el) { 
  selLang = c; 
  document.querySelectorAll('.lang-opt').forEach(x=>x.classList.remove('selected')); 
  el.classList.add('selected'); 
}

const game = {
  mode: null,
  list: [],
  idx: 0,
  turn: 'A',
  score: { A:0, B:0 },
  busy: false,
  rec: null,

  init: function(m) {
    this.mode = m;
    // Basit bir Ã§oÄŸaltma ve karÄ±ÅŸtÄ±rma
    let raw = DB[selLang] || DB.en;
    this.list = [...raw, ...raw, ...raw].sort(()=>Math.random()-0.5);
    
    this.idx = 0;
    this.score = {A:0, B:0};
    this.turn = Math.random()>0.5 ? 'A' : 'B';
    
    document.getElementById('setupModal').classList.add('hidden');
    this.render();
  },

  render: function() {
    // 1. GÃ¶rsel SÄ±ra YÃ¶netimi (Flu/Net)
    document.getElementById('zoneA').className = `player-zone ${this.turn==='A'?'active':''}`;
    document.getElementById('zoneB').className = `player-zone ${this.turn==='B'?'active':''}`;

    // 2. Kelime HazÄ±rlÄ±ÄŸÄ±
    const item = this.list[this.idx];
    if(!item) { location.reload(); return; } // Liste biterse reload (basit Ã§Ã¶zÃ¼m)

    let main, sub;
    if(this.mode === 'pronunciation') {
      main = item.w; sub = item.tr;
    } else {
      main = item.tr; sub = "Ä°ngilizcesini sÃ¶yle";
    }

    // 3. Ä°ki tarafa da yaz (B zaten CSS ile dÃ¶nÃ¼yor)
    document.getElementById('wA').innerText = main; document.getElementById('mA').innerText = sub;
    document.getElementById('wB').innerText = main; document.getElementById('mB').innerText = sub;

    // 4. Skor
    document.getElementById('sA').innerText = this.score.A;
    document.getElementById('sB').innerText = this.score.B;
  },

  pass: function() {
    if(this.busy) return;
    this.speak(this.list[this.idx].w); // DoÄŸrusunu duyur
    this.next();
  },

  next: function() {
    this.idx++;
    this.turn = this.turn === 'A' ? 'B' : 'A';
    this.render();
  },

  // SES TANIMA
  listen: function(p) {
    if(this.busy || p !== this.turn) return;
    
    // TarayÄ±cÄ± desteÄŸi
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR) { alert("Ses tanÄ±ma yok"); return; }

    this.busy = true;
    window.speechSynthesis.cancel(); // Ã–nceki sesi kes

    const btn = document.getElementById(`mic${p}`);
    const originalTxt = btn.innerText;
    btn.innerText = "DÄ°NLÄ°YOR...";
    btn.classList.add('listening');

    this.rec = new SR();
    // Vocab modundaysak hedef dili, Pron modundaysak yine hedef dili dinle
    const langMap = { en:'en-US', de:'de-DE', fr:'fr-FR', es:'es-ES', it:'it-IT' };
    this.rec.lang = langMap[selLang];
    this.rec.interimResults = false;

    this.rec.onresult = (e) => {
      const txt = e.results[0][0].transcript;
      this.check(txt, p);
      this.stopMic(p, originalTxt);
    };
    
    this.rec.onerror = () => this.stopMic(p, originalTxt);
    this.rec.onend = () => this.stopMic(p, originalTxt);
    
    this.rec.start();
  },

  stopMic: function(p, txt) {
    const btn = document.getElementById(`mic${p}`);
    btn.innerText = txt;
    btn.classList.remove('listening');
    // Busy hemen false yapma, feedback bitince yap
  },

  // KONTROL
  check: function(spoken, p) {
    const target = this.list[this.idx].w.toLowerCase().replace(/[^a-z]/g, '');
    const cleanSpoken = spoken.toLowerCase().replace(/[^a-z]/g, '');

    // Basit "iÃ§eriyor mu" kontrolÃ¼ (daha affedici)
    const match = cleanSpoken.includes(target) || target.includes(cleanSpoken);

    const el = document.getElementById(`ov${p}`);
    const title = el.querySelector('.res-title');
    const sub = el.querySelector('.res-sub');

    el.classList.remove('correct', 'wrong'); // Reset
    el.classList.add('show');

    if(match) {
      el.classList.add('correct');
      title.innerText = "DOÄRU!";
      sub.innerText = "+1 PUAN";
      this.score[p]++;
      this.speak("Correct"); 
      setTimeout(() => {
        el.classList.remove('show');
        this.busy = false;
        this.next();
      }, 1200);
    } else {
      el.classList.add('wrong');
      title.innerText = "YANLIÅ";
      sub.innerText = `DoÄŸrusu: ${this.list[this.idx].w}`;
      this.speak(this.list[this.idx].w);
      setTimeout(() => {
        el.classList.remove('show');
        this.busy = false;
        this.next();
      }, 2000);
    }
  },

  speak: function(txt) {
    const u = new SpeechSynthesisUtterance(txt);
    const langMap = { en:'en-US', de:'de-DE', fr:'fr-FR', es:'es-ES', it:'it-IT' };
    u.lang = langMap[selLang];
    window.speechSynthesis.speak(u);
  }
};
</script>
</body>
</html>
