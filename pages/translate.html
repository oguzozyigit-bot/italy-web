<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ITALKY - KarÅŸÄ±lÄ±klÄ±</title>
  <link rel="icon" href="data:," />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-void: #030014;
      --neon-cyan: #00f3ff;
      --neon-purple: #bc13fe;
      --glass-border: rgba(255, 255, 255, 0.15);
      --text-main: #ffffff;
      --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; position: fixed;
      font-family: 'Outfit', sans-serif;
      background-color: var(--bg-void);
      color: var(--text-main);
    }

    /* --- BACKGROUND --- */
    .cosmos-bg { position: absolute; inset: -50%; width: 200%; height: 200%; background: #030014; z-index: 0; pointer-events: none; }
    .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.4; animation: float 20s infinite alternate; }
    .orb-1 { top: 20%; left: 20%; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--neon-purple), transparent 70%); }
    .orb-2 { bottom: 20%; right: 20%; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--neon-cyan), transparent 70%); animation-delay: -5s; }
    @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(5%, 5%); } }
    .noise { position: absolute; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; mix-blend-mode: overlay; z-index: 1; }

    /* --- SPLIT SCREEN LAYOUT --- */
    .split-container {
      position: relative; width: 100%; height: 100%; z-index: 10;
      display: flex; flex-direction: column;
    }

    /* Common Side Styles */
    .side {
      flex: 1; display: flex; flex-direction: column;
      justify-content: space-between; padding: 20px;
      position: relative; overflow: hidden;
      transition: background 0.3s;
    }

    /* --- TOP SIDE (PERSON A - Rotated) --- */
    .side.top {
      background: rgba(20, 5, 30, 0.4);
      border-bottom: 1px solid var(--glass-border);
      transform: rotate(180deg); /* KRÄ°TÄ°K: Ters Ã‡evirme */
    }
    .side.top .accent-text { color: var(--neon-purple); }
    .side.top .mic-btn { border-color: var(--neon-purple); color: var(--neon-purple); }
    .side.top .mic-btn.active { background: var(--neon-purple); color: #fff; box-shadow: 0 0 40px var(--neon-purple); }

    /* --- BOTTOM SIDE (PERSON B - Normal) --- */
    .side.bottom {
      background: rgba(5, 20, 30, 0.4);
      border-top: 1px solid var(--glass-border);
    }
    .side.bottom .accent-text { color: var(--neon-cyan); }
    .side.bottom .mic-btn { border-color: var(--neon-cyan); color: var(--neon-cyan); }
    .side.bottom .mic-btn.active { background: var(--neon-cyan); color: #000; box-shadow: 0 0 40px var(--neon-cyan); }

    /* --- UI ELEMENTS --- */
    
    /* Language Selector */
    .lang-pill {
      align-self: center;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      padding: 8px 16px; border-radius: 99px;
      font-size: 14px; font-weight: 700; color: #fff;
      display: flex; align-items: center; gap: 8px;
      backdrop-filter: blur(5px);
    }

    /* Result Area */
    .result-area {
      flex: 1; display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      text-align: center; gap: 10px;
      opacity: 0.9;
    }
    .text-original {
      font-size: 16px; color: rgba(255,255,255,0.6); font-weight: 500;
    }
    .text-translated {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 28px; font-weight: 700; color: #fff;
      line-height: 1.2;
      text-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    
    /* Action Area (Mic) */
    .action-area {
      display: flex; justify-content: center; padding-top: 10px;
    }
    .mic-btn {
      width: 72px; height: 72px; border-radius: 50%;
      border: 2px solid; background: rgba(0,0,0,0.3);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.2s var(--ease-elastic);
      position: relative;
    }
    .mic-btn:active { transform: scale(0.9); }
    .mic-btn svg { width: 30px; height: 30px; stroke-width: 2; }

    /* Speaking Waves */
    .mic-wave {
      position: absolute; inset: -4px; border-radius: 50%;
      border: 2px solid currentColor; opacity: 0;
    }
    .active .mic-wave { animation: ripple 1.5s infinite; }
    @keyframes ripple { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.6); opacity: 0; } }

    /* --- CENTER CONTROLS (Absolute Center) --- */
    .center-controls {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 50;
      display: flex; align-items: center; gap: 10px;
    }
    .center-btn {
      width: 44px; height: 44px; border-radius: 50%;
      background: #1a1a1a; border: 1px solid rgba(255,255,255,0.2);
      color: #fff; display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.8); cursor: pointer;
    }
    .center-btn:active { transform: scale(0.9); }

    /* Placeholders */
    .placeholder-text { font-size: 14px; opacity: 0.3; font-style: italic; }

  </style>
</head>

<body>
  <div class="cosmos-bg"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
  <div class="noise"></div>

  <div class="split-container">
    
    <div class="side top" id="sideTop">
      <div class="lang-pill" id="langTopDisplay">ðŸ‡¬ðŸ‡§ English</div>
      
      <div class="result-area">
        <div class="text-original" id="textTopOriginal">...</div>
        <div class="text-translated accent-text" id="textTopTranslated">Tap mic to speak</div>
      </div>

      <div class="action-area">
        <button class="mic-btn" id="micTopBtn">
          <div class="mic-wave"></div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
        </button>
      </div>
    </div>

    <div class="center-controls">
      <div class="center-btn" onclick="window.location.href='/pages/home.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
      </div>
      <div class="center-btn" id="swapBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16V4M7 4L3 8M7 4L11 8M17 8V20M17 20L21 16M17 20L13 16"/></svg>
      </div>
    </div>

    <div class="side bottom" id="sideBottom">
      <div class="lang-pill" id="langBottomDisplay">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</div>
      
      <div class="result-area">
        <div class="text-original" id="textBottomOriginal">...</div>
        <div class="text-translated accent-text" id="textBottomTranslated">Mikrofona dokun</div>
      </div>

      <div class="action-area">
        <button class="mic-btn" id="micBottomBtn">
          <div class="mic-wave"></div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
        </button>
      </div>
    </div>

  </div>

  <script>
    // --- CONFIG ---
    const API_BASE = "https://caynana-api-py310-final.onrender.com/api";

    // --- STATE ---
    let langTop = { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' };
    let langBottom = { code: 'tr', name: 'TÃ¼rkÃ§e', flag: 'ðŸ‡¹ðŸ‡·' };
    let recognition = null;
    let isRecording = false;
    let activeSide = null; // 'top' or 'bottom'

    // --- ELEMENTS ---
    const ui = {
      top: {
        pill: document.getElementById('langTopDisplay'),
        orig: document.getElementById('textTopOriginal'),
        trans: document.getElementById('textTopTranslated'),
        mic: document.getElementById('micTopBtn'),
      },
      bottom: {
        pill: document.getElementById('langBottomDisplay'),
        orig: document.getElementById('textBottomOriginal'),
        trans: document.getElementById('textBottomTranslated'),
        mic: document.getElementById('micBottomBtn'),
      }
    };

    // --- INIT ---
    function init() {
      updateUI();

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("TarayÄ±cÄ±nÄ±z ses tanÄ±mayÄ± desteklemiyor (Chrome Ã¶nerilir).");
        return;
      }
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = () => { isRecording = true; updateMicVisuals(); };
      recognition.onend = () => { isRecording = false; activeSide = null; updateMicVisuals(); };
      
      recognition.onresult = async (event) => {
        const transcript = event.results[0][0].transcript;
        if(transcript) await processSpeech(transcript);
      };
      
      recognition.onerror = () => { isRecording = false; updateMicVisuals(); };
    }

    function updateUI() {
      ui.top.pill.innerText = `${langTop.flag} ${langTop.name}`;
      ui.bottom.pill.innerText = `${langBottom.flag} ${langBottom.name}`;
    }

    function updateMicVisuals() {
      ui.top.mic.classList.remove('active');
      ui.bottom.mic.classList.remove('active');
      if(isRecording && activeSide) {
        ui[activeSide].mic.classList.add('active');
      }
    }

    // --- ACTIONS ---
    function startListening(side) {
      if(isRecording) recognition.stop();
      activeSide = side;
      // Kimin tarafÄ±na basÄ±ldÄ±ysa o dilde dinle
      recognition.lang = (side === 'top') ? langTop.code : langBottom.code;
      try { recognition.start(); } catch(e){}
    }

    // --- LOGIC ---
    async function processSpeech(text) {
      // 1. KonuÅŸan tarafÄ±n Orijinal metnini gÃ¶ster
      ui[activeSide].orig.innerText = text;
      
      // DiÄŸer taraf (Hedef)
      const targetSide = (activeSide === 'top') ? 'bottom' : 'top';
      const srcCode = (activeSide === 'top') ? langTop.code : langBottom.code;
      const dstCode = (activeSide === 'top') ? langBottom.code : langTop.code;

      // Hedef tarafa "Ã‡evriliyor..." yaz
      ui[targetSide].trans.innerText = "...";
      ui[targetSide].trans.style.opacity = "0.5";

      try {
        // 2. Ã‡eviri Ä°steÄŸi
        const res = await fetch(`${API_BASE}/translate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: text, from_lang: srcCode, to_lang: dstCode })
        });
        const data = await res.json();

        if(data.ok) {
          // 3. Sonucu Yaz
          ui[targetSide].trans.innerText = data.translated;
          ui[targetSide].trans.style.opacity = "1";
          
          // 4. Seslendir (Hedef dilde)
          playTTS(data.translated, dstCode);
        }
      } catch(e) {
        ui[targetSide].trans.innerText = "Hata";
      }
    }

    async function playTTS(text, lang) {
      try {
        const res = await fetch(`${API_BASE}/tts`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: text, lang: lang })
        });
        const data = await res.json();
        if(data.ok && data.audio_base64) {
          const audio = new Audio("data:audio/mp3;base64," + data.audio_base64);
          audio.play();
        }
      } catch(e) { console.log("TTS Error"); }
    }

    // --- EVENTS ---
    ui.top.mic.addEventListener('touchstart', (e) => { e.preventDefault(); startListening('top'); });
    ui.top.mic.addEventListener('mousedown', () => startListening('top'));

    ui.bottom.mic.addEventListener('touchstart', (e) => { e.preventDefault(); startListening('bottom'); });
    ui.bottom.mic.addEventListener('mousedown', () => startListening('bottom'));

    document.getElementById('swapBtn').addEventListener('click', () => {
      const t = langTop; langTop = langBottom; langBottom = t;
      updateUI();
    });

    init();
  </script>
</body>
</html>
