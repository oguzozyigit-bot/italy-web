<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ITALKY ‚Ä¢ Gap Master</title>
  <link rel="icon" href="data:,"/><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    :root { --bg-deep:#020205; --text-main:#fff; --c-accent:#ffb800; --c-success:#beF264; --c-error:#ff5252; --border:rgba(255,255,255,0.1); }
    * { box-sizing:border-box; outline:none; } html,body { margin:0; height:100dvh; overflow:hidden; font-family:'Outfit', sans-serif; background:var(--bg-deep); color:var(--text-main); }
    .cosmos-bg { position:absolute; inset:0; background:radial-gradient(circle at center, #1a1a2e 0%, #000 100%); z-index:0; }
    .star-dust { position: absolute; inset: 0; opacity: 0.3; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 50px 50px; animation: dustMove 100s linear infinite; } @keyframes dustMove { from { transform: translateY(0); } to { transform: translateY(-500px); } }
    .wrap { width:100%; max-width:480px; height:100%; margin:0 auto; position:relative; z-index:10; display:flex; flex-direction:column; }
    .nav-layer { position:absolute; top:0; left:0; width:100%; height:70px; z-index:50; display:flex; justify-content:space-between; padding:12px; pointer-events:none; }
    .nav-btn { pointer-events:auto; height:44px; padding:0 16px; border-radius:14px; background:rgba(0,0,0,0.4); border:1px solid var(--border); color:#fff; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(10px); cursor:pointer; font-weight:700; transition:0.2s; }
    .brand-mini { pointer-events:auto; display:flex; flex-direction:column; align-items:center; cursor:pointer; } .brand-mini span { font-family:'Space Grotesk', sans-serif; font-weight:700; font-size:20px; line-height:1; } .brand-mini small { font-size:9px; letter-spacing:3px; opacity:0.6; color:var(--c-accent); }
    .game-stage { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; padding-top:60px; position:relative; }
    .puzzle-card { width:100%; background:rgba(255,255,255,0.03); border:1px solid var(--border); border-radius:24px; padding:30px 20px; text-align:center; backdrop-filter:blur(10px); box-shadow:0 20px 60px rgba(0,0,0,0.5); transition:0.3s; }
    .sentence-container { font-size:26px; font-weight:600; line-height:1.6; color:rgba(255,255,255,0.9); min-height:100px; display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:8px; }
    .gap-slot { display:inline-block; min-width:80px; height:40px; border-bottom:3px solid var(--c-accent); color:var(--c-accent); font-weight:800; text-align:center; transition:0.3s; }
    .gap-slot.filled { border-bottom-color:var(--c-success); color:var(--c-success); transform:scale(1.1); }
    .gap-slot.error { border-bottom-color:var(--c-error); animation:shake 0.4s; }
    .translation { margin-top:24px; font-size:16px; opacity:0; transform:translateY(10px); transition:all 0.5s ease; font-weight:500; color:var(--c-success); } .translation.show { opacity:1; transform:translateY(0); }
    .controls { padding:40px; width:100%; display:flex; flex-direction:column; align-items:center; gap:20px; }
    .mic-btn { width:80px; height:80px; border-radius:50%; background:rgba(255,255,255,0.08); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:0.2s; box-shadow:0 10px 40px rgba(0,0,0,0.3); }
    .mic-btn svg { width:32px; height:32px; stroke:#fff; fill:none; stroke-width:2; transition:0.3s; }
    .mic-btn.listening { background:#fff; box-shadow:0 0 30px rgba(255,184,0,0.4); animation:pulseMic 1.5s infinite; } .mic-btn.listening svg { stroke:#000; }
    .status-text { font-family:'Space Grotesk', sans-serif; font-weight:700; font-size:14px; opacity:0.7; letter-spacing:1px; text-transform:uppercase; height:20px; }
    .modal-wrap { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:999; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(20px); } .modal-card { width:85%; background:#101014; border:1px solid var(--border); border-radius:32px; padding:32px; text-align:center; box-shadow:0 30px 80px rgba(0,0,0,1); animation:popIn 0.5s; }
    .btn-primary { width:100%; padding:16px; border-radius:16px; border:none; background:linear-gradient(135deg, var(--c-accent), #ff8800); color:#000; font-weight:800; font-size:16px; cursor:pointer; box-shadow:0 10px 30px rgba(255,184,0,0.3); transition:0.2s; }
    .loader { border:4px solid rgba(255,255,255,0.1); border-top:4px solid var(--c-accent); border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:0 auto 20px; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } } @keyframes pulseMic { 0% { box-shadow:0 0 0 0 rgba(255,255,255,0.4); } 70% { box-shadow:0 0 0 20px rgba(255,255,255,0); } 100% { box-shadow:0 0 0 0 rgba(255,255,255,0); } } @keyframes shake { 0% { transform:translateX(0); } 25% { transform:translateX(-5px); } 50% { transform:translateX(5px); } 75% { transform:translateX(-5px); } 100% { transform:translateX(0); } } @keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }
  </style>
</head>
<body>
  <div class="cosmos-bg"><div class="star-dust"></div></div>
  <div class="wrap">
    <div class="nav-layer"><button class="nav-btn" onclick="window.location.href='/pages/game.html'">‚Üê</button><div class="brand-mini" onclick="window.location.href='/pages/home.html'"><span>italky<span style="color:var(--c-accent)">AI</span></span><small>GAP MASTER</small></div><div class="nav-btn" id="scoreBadge">üèÜ 0</div></div>
    <div class="game-stage"><div class="puzzle-card"><div class="sentence-container" id="sentenceBox">Y√ºkleniyor...</div><div class="translation" id="translationBox"></div></div></div>
    <div class="controls"><div class="status-text" id="statusText">HAZIR</div><button class="mic-btn" id="micBtn"><svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></button></div>
  </div>
  <div class="modal-wrap" id="startModal"><div class="modal-card"><div class="modal-title" style="color:var(--c-accent);font-weight:800;font-size:24px;margin-bottom:12px">C√úMLE TAMAMLAMA üß©</div><div class="modal-p" style="opacity:0.7;margin-bottom:32px">1. C√ºmleyi Dinle (Bo≈ülukta susacak)<br>2. Kelimeyi Bul ve S√∂yle<br>3. Doƒüruysa AI c√ºmlenin tamamƒ±nƒ± okur!</div><div id="loading" style="display:none;margin-bottom:20px"><div class="loader"></div><div>Bilmeceler Hazƒ±rlanƒ±yor...</div></div><button class="btn-primary" id="startBtn">BA≈ûLA</button></div></div>
<script type="module">
import { BASE_DOMAIN } from "/js/config.js";
const $ = (id) => document.getElementById(id);
const apiBase = () => String(BASE_DOMAIN || "").replace(/\/+$/, "");
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const SFX = {correct:()=>{if(audioCtx.state==='suspended')audioCtx.resume();const t=audioCtx.currentTime;[523,659,783].forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.frequency.value=f;o.connect(g);g.connect(audioCtx.destination);g.gain.setValueAtTime(.05,t+i*.1);g.gain.exponentialRampToValueAtTime(.001,t+i*.1+.3);o.start(t+i*.1);o.stop(t+i*.1+.3)})},wrong:()=>{if(audioCtx.state==='suspended')audioCtx.resume();const t=audioCtx.currentTime,o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='sawtooth';o.frequency.value=150;o.connect(g);g.connect(audioCtx.destination);g.gain.setValueAtTime(.1,t);g.gain.linearRampToValueAtTime(.001,t+.3);o.start(t);o.stop(t+.3)}};
let puzzleList=[], currentIndex=0, score=0, isBusy=false;
async function fetchPuzzles(){$("loading").style.display="block";$("startBtn").style.display="none";try{const r=await fetch(`${apiBase()}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:"Bana ƒ∞ngilizce B1 seviyesinde 10 c√ºmle ver. Bir kelimeyi (fiil/isim) gizle. JSON: [{'sentence_parts':['I drink','every day.'],'hidden_word':'coffee','translation':'Her g√ºn kahve i√ßerim.'},...]",max_tokens:1500})});const d=await r.json();puzzleList=JSON.parse(d.text.replace(/```json/g,"").replace(/```/g,"").trim());if(!Array.isArray(puzzleList))throw 1;$("startModal").style.display="none";loadPuzzle()}catch(e){puzzleList=[{sentence_parts:["The sky is","today."],hidden_word:"blue",translation:"Bug√ºn g√∂ky√ºz√º mavi."}];$("startModal").style.display="none";loadPuzzle()}}
function loadPuzzle(){if(currentIndex>=puzzleList.length){alert(`Bitti! Puan: ${score}`);location.reload();return}const p=puzzleList[currentIndex];$("translationBox").className="translation";$("translationBox").textContent=p.translation;$("sentenceBox").innerHTML=`<span>${p.sentence_parts[0]}</span><span class="gap-slot" id="gapSlot">_____</span><span>${p.sentence_parts[1]}</span>`;$("statusText").textContent="Dƒ∞NLE VE CEVAPLA";setTimeout(()=>speakPuzzle(p),1000)}
function speakPuzzle(p){if(isBusy)return;isBusy=true;$("micBtn").disabled=true;const u=new SpeechSynthesisUtterance(`${p.sentence_parts[0]} ... ${p.sentence_parts[1]}`);u.lang="en-US";u.rate=0.85;u.onend=()=>{isBusy=false;$("micBtn").disabled=false;$("statusText").textContent="Mƒ∞KROFONA BASIP S√ñYLE"};window.speechSynthesis.speak(u)}
function speakFullSentence(p){return new Promise(r=>{isBusy=true;$("statusText").textContent="Dƒ∞NLE VE √ñƒûREN...";const u=new SpeechSynthesisUtterance(`${p.sentence_parts[0]} ${p.hidden_word} ${p.sentence_parts[1]}`);u.lang="en-US";u.rate=0.9;u.onend=()=>{isBusy=false;r()};window.speechSynthesis.speak(u)})}
function listen(){if(isBusy)return;const S=window.SpeechRecognition||window.webkitSpeechRecognition;if(!S)return alert("Desteklenmiyor");isBusy=true;$("micBtn").classList.add("listening");$("statusText").textContent="Dƒ∞NLƒ∞YOR...";const r=new S();r.lang="en-US";r.interimResults=false;r.onresult=e=>checkAnswer(e.results[0][0].transcript.toLowerCase().trim());r.onend=()=>{ $("micBtn").classList.remove("listening");if(isBusy){isBusy=false;$("statusText").textContent="TEKRAR DENE"}};r.start()}
async function checkAnswer(i){isBusy=false;const p=puzzleList[currentIndex],t=p.hidden_word.toLowerCase().trim(),s=$("gapSlot");if(i.includes(t)||t.includes(i)){SFX.correct();s.textContent=t.toUpperCase();s.classList.add("filled");score+=10;$("scoreBadge").textContent=`üèÜ ${score}`;$("statusText").textContent="DOƒûRU!";$("translationBox").classList.add("show");await new Promise(r=>setTimeout(r,500));await speakFullSentence(p);setTimeout(()=>{currentIndex++;loadPuzzle()},1500)}else{SFX.wrong();s.classList.add("error");$("statusText").textContent=`YANLI≈û: "${i}"`;setTimeout(()=>s.classList.remove("error"),1000)}}
$("startBtn").onclick=fetchPuzzles;$("micBtn").onclick=listen;
</script></body></html>
