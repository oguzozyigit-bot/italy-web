<!-- FILE: /pages/level_test_hub.html -->
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<title>italkyAI â€¢ Seviye Tespit</title>

<meta name="theme-color" content="#02000f">
<style>html,body{background:#02000f !important;}</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#02000f;
  --card:rgba(255,255,255,.04);
  --border:rgba(255,255,255,.10);
  --muted:rgba(255,255,255,.65);
  --ai:linear-gradient(135deg,#a5b4fc 0%,#6366f1 50%,#ec4899 100%);
  --safeB:env(safe-area-inset-bottom,0px);
}

*{box-sizing:border-box}
html,body{
  margin:0;
  height:100dvh;
  overflow:hidden;
  font-family:Outfit,sans-serif;
  color:#fff;
}

/* âœ… PAGE LAYOUT */
#pageContent{
  height:100%;
  display:flex;
  flex-direction:column;
  padding:14px 14px calc(8px + var(--safeB));
  gap:12px;
}

/* HERO */
.hero{
  flex:0 0 auto;
  border-radius:22px;
  border:1px solid var(--border);
  background:var(--card);
  backdrop-filter:blur(18px);
  padding:14px;
}

.heroTop{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}

.heroTitle{
  font-family:"Space Grotesk";
  font-size:16px;
  font-weight:900;
  margin:0;
}

.chip{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:11px;
  font-weight:900;
  white-space:nowrap;
}
.chip b{
  background:var(--ai);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.heroSub{
  margin-top:8px;
  font-size:12px;
  font-weight:800;
  color:var(--muted);
  line-height:1.5;
}

/* âœ… GRID */
.gridWrap{
  flex:1;
  min-height:0;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

.grid{
  flex:1;
  min-height:0;
  overflow:auto;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  padding-bottom:6px;
}

.grid::-webkit-scrollbar{display:none;}

@media(max-width:420px){
  .grid{grid-template-columns:repeat(2,1fr);}
}

/* CARD */
.langCard{
  border-radius:18px;
  border:1px solid var(--border);
  background:var(--card);
  padding:12px 8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
  min-height:110px;
  cursor:pointer;
  text-align:center;
}
.langCard:active{transform:scale(.98)}

.flagBox{
  width:50px;height:50px;
  border-radius:16px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
}

.langName{
  font-size:12px;
  font-weight:900;
}

.status{
  font-size:10px;
  font-weight:800;
  color:var(--muted);
}

.status .lvl{
  background:var(--ai);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
</style>
</head>

<body>
<div id="pageContent">

  <div class="hero">
    <div class="heroTop">
      <h1 class="heroTitle">Seviye Tespit SÄ±navÄ±</h1>
      <div class="chip">SÃ¼re: <b>40 dk</b></div>
    </div>
    <div class="heroSub">
      LÃ¼tfen sessiz ve dikkatinizin daÄŸÄ±lmayacaÄŸÄ± bir ortamda sÄ±nava baÅŸlayÄ±n.<br>
      SÄ±nav sorularÄ± dÃ¼nya standartlarÄ± seviye tespit sÄ±navlarÄ±na gÃ¶re hazÄ±rlanmÄ±ÅŸtÄ±r.
    </div>
  </div>

  <div class="gridWrap">
    <div class="grid" id="grid"></div>
  </div>

</div>

<script type="module">
import { mountShell } from "/js/ui_shell.js";
import { supabase } from "/js/supabase_client.js";

mountShell({scroll:"none"});

const { data:{ session } } = await supabase.auth.getSession();
if(!session?.user){
  location.replace("/pages/login.html");
}

let LEVELS = {};
try{
  const { data } = await supabase
    .from("profiles")
    .select("levels")
    .eq("id", session.user.id)
    .single();
  LEVELS = data?.levels || {};
}catch{}

const LANGS = [
  {code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},
  {code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"},
  {code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},
  {code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},
  {code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},
  {code:"it",name:"Italiano",flag:"ðŸ‡®ðŸ‡¹"},
  {code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},
  {code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},
  {code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},
];

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = LANGS.map(l=>{
    const lvl = LEVELS?.[l.code];
    const status = lvl
      ? `Seviyeniz: <span class="lvl">${lvl}</span>`
      : `HenÃ¼z sÄ±nava katÄ±lmadÄ±nÄ±z`;
    return `
      <div class="langCard" data-code="${l.code}">
        <div class="flagBox">${l.flag}</div>
        <div class="langName">${l.name}</div>
        <div class="status">${status}</div>
      </div>
    `;
  }).join("");

  grid.querySelectorAll(".langCard").forEach(c=>{
    c.onclick = ()=>{
      localStorage.setItem("italky_level_lang", c.dataset.code);
      location.href="/pages/level_test_intro.html";
    };
  });
}

render();
</script>
</body>
</html>
