<!-- FILE: /pages/level_test_hub.html -->
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<title>italkyAI â€¢ Seviye Tespit</title>

<meta name="theme-color" content="#02000f">
<style>html,body{background:#02000f !important;}</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#02000f;
  --card:rgba(255,255,255,.04);
  --border:rgba(255,255,255,.10);
  --muted:rgba(255,255,255,.65);
  --ai:linear-gradient(135deg,#a5b4fc 0%,#6366f1 50%,#ec4899 100%);
  --safeB:env(safe-area-inset-bottom,0px);
}

*{box-sizing:border-box}
html,body{
  margin:0;
  height:100dvh;
  overflow:hidden;
  font-family:Outfit,sans-serif;
  color:#fff;
}

/* âœ… Daha geniÅŸ: yan padding dÃ¼ÅŸÃ¼rÃ¼ldÃ¼ */
#pageContent{
  height:100%;
  display:flex;
  flex-direction:column;
  padding: 12px 10px calc(8px + var(--safeB));
  gap:10px;
}

/* HERO */
.hero{
  flex:0 0 auto;
  border-radius:22px;
  border:1px solid var(--border);
  background:var(--card);
  backdrop-filter:blur(18px);
  padding:12px;
}
.heroTop{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}
.heroTitle{
  font-family:"Space Grotesk";
  font-size:15px;
  font-weight:900;
  margin:0;
}
.chip{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:11px;
  font-weight:900;
  white-space:nowrap;
}
.chip b{
  background:var(--ai);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.heroSub{
  margin-top:8px;
  font-size:12px;
  font-weight:800;
  color:var(--muted);
  line-height:1.5;
}

/* GRID */
.gridWrap{
  flex:1;
  min-height:0;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.grid{
  flex:1;
  min-height:0;
  overflow:auto;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  padding-bottom:6px;
}
.grid::-webkit-scrollbar{display:none;}

/* âœ… Mobilde 2 kolon (kartlar daha geniÅŸ gÃ¶rÃ¼nÃ¼r) */
@media(max-width:460px){
  .grid{grid-template-columns:repeat(2,1fr);}
}

/* CARD */
.langCard{
  border-radius:18px;
  border:1px solid var(--border);
  background:var(--card);
  padding:12px 10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
  min-height:112px;
  cursor:pointer;
  text-align:center;
}
.langCard:active{transform:scale(.985)}
.flagBox{
  width:52px;height:52px;
  border-radius:16px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
}
.langName{
  font-size:12px;
  font-weight:900;
}
.status{
  font-size:10px;
  font-weight:800;
  color:var(--muted);
}
.status .lvl{
  background:var(--ai);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
</style>
</head>

<body>
<div id="pageContent">

  <div class="hero">
    <div class="heroTop">
      <h1 class="heroTitle">Seviye Tespit SÄ±navÄ±</h1>
      <div class="chip">SÃ¼re: <b>40 dk</b></div>
    </div>
    <div class="heroSub">
      LÃ¼tfen sessiz ve dikkatinizin daÄŸÄ±lmayacaÄŸÄ± bir ortamda sÄ±nava baÅŸlayÄ±n.<br>
      SÄ±nav sorularÄ± dÃ¼nya standartlarÄ± seviye tespit sÄ±navlarÄ±na gÃ¶re hazÄ±rlanmÄ±ÅŸtÄ±r.
    </div>
  </div>

  <div class="gridWrap">
    <div class="grid" id="grid"></div>
  </div>

</div>

<script type="module">
import { mountShell } from "/js/ui_shell.js";
import { supabase } from "/js/supabase_client.js";

mountShell({scroll:"none"});

const { data:{ session } } = await supabase.auth.getSession();
if(!session?.user){
  location.replace("/pages/login.html");
}

function getUILang(){
  // 1) varsa site dili
  try{
    const v = localStorage.getItem("italky_site_lang_v1");
    if(v) return String(v).toLowerCase().slice(0,2);
  }catch{}
  // 2) tarayÄ±cÄ± dili
  return String(navigator.language || "tr").toLowerCase().slice(0,2);
}
const UI = getUILang(); // "tr" veya "en" gibi

let LEVELS = {};
try{
  const { data } = await supabase
    .from("profiles")
    .select("levels")
    .eq("id", session.user.id)
    .single();
  LEVELS = data?.levels || {};
}catch{}

/*
  âœ… 80 dil listesi
  - code: ISO base
  - flag: emoji
  - tr/en: Latin yazÄ±m
*/
const LANGS = [
  {code:"tr", flag:"ğŸ‡¹ğŸ‡·", tr:"TÃ¼rkÃ§e", en:"Turkish"},
  {code:"en", flag:"ğŸ‡¬ğŸ‡§", tr:"Ä°ngilizce", en:"English"},
  {code:"de", flag:"ğŸ‡©ğŸ‡ª", tr:"Almanca", en:"German"},
  {code:"fr", flag:"ğŸ‡«ğŸ‡·", tr:"FransÄ±zca", en:"French"},
  {code:"es", flag:"ğŸ‡ªğŸ‡¸", tr:"Ä°spanyolca", en:"Spanish"},
  {code:"it", flag:"ğŸ‡®ğŸ‡¹", tr:"Ä°talyanca", en:"Italian"},
  {code:"ru", flag:"ğŸ‡·ğŸ‡º", tr:"RusÃ§a", en:"Russian"},
  {code:"ja", flag:"ğŸ‡¯ğŸ‡µ", tr:"Japonca", en:"Japanese"},
  {code:"zh", flag:"ğŸ‡¨ğŸ‡³", tr:"Ã‡ince", en:"Chinese"},
  {code:"ko", flag:"ğŸ‡°ğŸ‡·", tr:"Korece", en:"Korean"},
  {code:"ar", flag:"ğŸ‡¸ğŸ‡¦", tr:"ArapÃ§a", en:"Arabic"},
  {code:"fa", flag:"ğŸ‡®ğŸ‡·", tr:"FarsÃ§a", en:"Persian"},
  {code:"ur", flag:"ğŸ‡µğŸ‡°", tr:"Urduca", en:"Urdu"},
  {code:"hi", flag:"ğŸ‡®ğŸ‡³", tr:"HintÃ§e", en:"Hindi"},
  {code:"bn", flag:"ğŸ‡§ğŸ‡©", tr:"Bengalce", en:"Bengali"},
  {code:"pa", flag:"ğŸ‡®ğŸ‡³", tr:"PencapÃ§a", en:"Punjabi"},
  {code:"ta", flag:"ğŸ‡®ğŸ‡³", tr:"Tamilce", en:"Tamil"},
  {code:"te", flag:"ğŸ‡®ğŸ‡³", tr:"Teluguca", en:"Telugu"},
  {code:"mr", flag:"ğŸ‡®ğŸ‡³", tr:"Marathice", en:"Marathi"},
  {code:"gu", flag:"ğŸ‡®ğŸ‡³", tr:"GuceratÃ§a", en:"Gujarati"},
  {code:"id", flag:"ğŸ‡®ğŸ‡©", tr:"Endonezce", en:"Indonesian"},
  {code:"ms", flag:"ğŸ‡²ğŸ‡¾", tr:"Malayca", en:"Malay"},
  {code:"vi", flag:"ğŸ‡»ğŸ‡³", tr:"Vietnamca", en:"Vietnamese"},
  {code:"th", flag:"ğŸ‡¹ğŸ‡­", tr:"Tayca", en:"Thai"},
  {code:"tl", flag:"ğŸ‡µğŸ‡­", tr:"Filipince", en:"Filipino"},
  {code:"nl", flag:"ğŸ‡³ğŸ‡±", tr:"FelemenkÃ§e", en:"Dutch"},
  {code:"sv", flag:"ğŸ‡¸ğŸ‡ª", tr:"Ä°sveÃ§Ã§e", en:"Swedish"},
  {code:"no", flag:"ğŸ‡³ğŸ‡´", tr:"NorveÃ§Ã§e", en:"Norwegian"},
  {code:"da", flag:"ğŸ‡©ğŸ‡°", tr:"Danca", en:"Danish"},
  {code:"fi", flag:"ğŸ‡«ğŸ‡®", tr:"Fince", en:"Finnish"},
  {code:"pl", flag:"ğŸ‡µğŸ‡±", tr:"LehÃ§e", en:"Polish"},
  {code:"cs", flag:"ğŸ‡¨ğŸ‡¿", tr:"Ã‡ekÃ§e", en:"Czech"},
  {code:"sk", flag:"ğŸ‡¸ğŸ‡°", tr:"SlovakÃ§a", en:"Slovak"},
  {code:"hu", flag:"ğŸ‡­ğŸ‡º", tr:"Macarca", en:"Hungarian"},
  {code:"ro", flag:"ğŸ‡·ğŸ‡´", tr:"Romence", en:"Romanian"},
  {code:"bg", flag:"ğŸ‡§ğŸ‡¬", tr:"Bulgarca", en:"Bulgarian"},
  {code:"el", flag:"ğŸ‡¬ğŸ‡·", tr:"Yunanca", en:"Greek"},
  {code:"uk", flag:"ğŸ‡ºğŸ‡¦", tr:"Ukraynaca", en:"Ukrainian"},
  {code:"he", flag:"ğŸ‡®ğŸ‡±", tr:"Ä°branice", en:"Hebrew"},
  {code:"pt", flag:"ğŸ‡µğŸ‡¹", tr:"Portekizce", en:"Portuguese"},
  {code:"sr", flag:"ğŸ‡·ğŸ‡¸", tr:"SÄ±rpÃ§a", en:"Serbian"},
  {code:"hr", flag:"ğŸ‡­ğŸ‡·", tr:"HÄ±rvatÃ§a", en:"Croatian"},
  {code:"bs", flag:"ğŸ‡§ğŸ‡¦", tr:"BoÅŸnakÃ§a", en:"Bosnian"},
  {code:"sq", flag:"ğŸ‡¦ğŸ‡±", tr:"ArnavutÃ§a", en:"Albanian"},
  {code:"sl", flag:"ğŸ‡¸ğŸ‡®", tr:"Slovence", en:"Slovenian"},
  {code:"mk", flag:"ğŸ‡²ğŸ‡°", tr:"Makedonca", en:"Macedonian"},
  {code:"et", flag:"ğŸ‡ªğŸ‡ª", tr:"Estonca", en:"Estonian"},
  {code:"lv", flag:"ğŸ‡±ğŸ‡»", tr:"Letonca", en:"Latvian"},
  {code:"lt", flag:"ğŸ‡±ğŸ‡¹", tr:"Litvanca", en:"Lithuanian"},
  {code:"ga", flag:"ğŸ‡®ğŸ‡ª", tr:"Ä°rlandaca", en:"Irish"},
  {code:"cy", flag:"ğŸ´", tr:"Galce", en:"Welsh"},
  {code:"is", flag:"ğŸ‡®ğŸ‡¸", tr:"Ä°zlandaca", en:"Icelandic"},
  {code:"mt", flag:"ğŸ‡²ğŸ‡¹", tr:"Maltaca", en:"Maltese"},
  {code:"af", flag:"ğŸ‡¿ğŸ‡¦", tr:"Afrikaans", en:"Afrikaans"},
  {code:"sw", flag:"ğŸ‡°ğŸ‡ª", tr:"Svahili", en:"Swahili"},
  {code:"am", flag:"ğŸ‡ªğŸ‡¹", tr:"Amharca", en:"Amharic"},
  {code:"zu", flag:"ğŸ‡¿ğŸ‡¦", tr:"Zulu", en:"Zulu"},
  {code:"xh", flag:"ğŸ‡¿ğŸ‡¦", tr:"Xhosa", en:"Xhosa"},
  {code:"yo", flag:"ğŸ‡³ğŸ‡¬", tr:"Yoruba", en:"Yoruba"},
  {code:"ig", flag:"ğŸ‡³ğŸ‡¬", tr:"Ä°gbo", en:"Igbo"},
  {code:"ha", flag:"ğŸ‡³ğŸ‡¬", tr:"Hausa", en:"Hausa"},
  {code:"so", flag:"ğŸ‡¸ğŸ‡´", tr:"Somalice", en:"Somali"},
  {code:"ne", flag:"ğŸ‡³ğŸ‡µ", tr:"Nepalce", en:"Nepali"},
  {code:"si", flag:"ğŸ‡±ğŸ‡°", tr:"Seylanca", en:"Sinhala"},
  {code:"my", flag:"ğŸ‡²ğŸ‡²", tr:"Burmaca", en:"Burmese"},
  {code:"km", flag:"ğŸ‡°ğŸ‡­", tr:"Kmerce", en:"Khmer"},
  {code:"lo", flag:"ğŸ‡±ğŸ‡¦", tr:"Laoca", en:"Lao"},
  {code:"mn", flag:"ğŸ‡²ğŸ‡³", tr:"MoÄŸolca", en:"Mongolian"},
  {code:"kk", flag:"ğŸ‡°ğŸ‡¿", tr:"KazakÃ§a", en:"Kazakh"},
  {code:"uz", flag:"ğŸ‡ºğŸ‡¿", tr:"Ã–zbekÃ§e", en:"Uzbek"},
  {code:"az", flag:"ğŸ‡¦ğŸ‡¿", tr:"Azerice", en:"Azerbaijani"},
  {code:"ka", flag:"ğŸ‡¬ğŸ‡ª", tr:"GÃ¼rcÃ¼ce", en:"Georgian"},
  {code:"hy", flag:"ğŸ‡¦ğŸ‡²", tr:"Ermenice", en:"Armenian"},
  {code:"eu", flag:"ğŸ‡ªğŸ‡¸", tr:"BaskÃ§a", en:"Basque"},
  {code:"gl", flag:"ğŸ‡ªğŸ‡¸", tr:"GaliÃ§yaca", en:"Galician"},
  {code:"ca", flag:"ğŸ‡ªğŸ‡¸", tr:"Katalanca", en:"Catalan"},
  {code:"la", flag:"ğŸ›ï¸", tr:"Latince", en:"Latin"},
  {code:"eo", flag:"ğŸŒ", tr:"Esperanto", en:"Esperanto"},
];

// âœ… alfabetik (TR/EN adÄ±na gÃ¶re) ama ilk 5 sabit kalsÄ±n
const pinned = new Set(["tr","en","de","fr","es"]);
const rest = LANGS.filter(x=>!pinned.has(x.code));
rest.sort((a,b)=>{
  const A = (UI==="tr" ? a.tr : a.en).toLowerCase();
  const B = (UI==="tr" ? b.tr : b.en).toLowerCase();
  return A.localeCompare(B);
});
const ordered = LANGS.filter(x=>pinned.has(x.code)).concat(rest).slice(0,80);

function label(l){
  return (UI==="tr") ? l.tr : l.en;
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = ordered.map(l=>{
    const lvl = LEVELS?.[l.code];
    const status = lvl
      ? `Seviyeniz: <span class="lvl">${lvl}</span>`
      : `HenÃ¼z sÄ±nava katÄ±lmadÄ±nÄ±z`;
    return `
      <div class="langCard" data-code="${l.code}">
        <div class="flagBox">${l.flag}</div>
        <div class="langName">${label(l)}</div>
        <div class="status">${status}</div>
      </div>
    `;
  }).join("");

  grid.querySelectorAll(".langCard").forEach(c=>{
    c.onclick = ()=>{
      localStorage.setItem("italky_level_lang", c.dataset.code);
      location.href="/pages/level_test_intro.html";
    };
  });
}

render();
</script>
</body>
</html>
