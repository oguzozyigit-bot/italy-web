<!-- FILE: /pages/level_test_hub.html -->
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<title>italkyAI â€¢ Seviye Tespit</title>

<meta name="theme-color" content="#02000f">
<style>html,body{background:#02000f !important;}</style>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#02000f;
  --card: rgba(255,255,255,0.05);
  --border: rgba(255,255,255,0.12);
  --muted: rgba(255,255,255,0.62);
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

#pageContent{
  padding:14px 14px calc(var(--footerH,92px) + env(safe-area-inset-bottom) + 12px);
  min-height:100%;
}

.wrap{
  max-width:560px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.hero{
  border-radius:24px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(16px);
  padding:16px;
}
.heroTop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.hTitle{
  font-family:"Space Grotesk";
  font-weight:900;
  font-size:17px;
}
.pill{
  padding:6px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.15);
  background:rgba(0,0,0,0.25);
  font-weight:900;
  font-size:12px;
}

.heroText{
  font-size:12px;
  font-weight:800;
  line-height:1.5;
  color:rgba(255,255,255,0.7);
}

/* âœ… 2 kolon */
.grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
}

.card{
  border-radius:22px;
  border:1px solid var(--border);
  background:var(--card);
  padding:16px 10px;
  min-height:120px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  cursor:pointer;
  transition:.18s;
}
.card:active{ transform:scale(.98); }

.flag{ font-size:30px; }
.code{
  font-size:12px;
  font-weight:1000;
  color:#a5b4fc;
}
.name{
  font-size:14px;
  font-weight:1000;
}
.status{
  font-size:11px;
  font-weight:900;
  color:var(--muted);
}
.status.ok{ color:#a5b4fc; }

.toast{
  position:fixed;
  left:50%;
  top:18px;
  transform:translateX(-50%) translateY(-120px);
  background:#0b0b16;
  border:1px solid rgba(165,180,252,.35);
  padding:10px 14px;
  border-radius:999px;
  font-size:12px;
  transition:.25s;
  color:#fff;
  z-index:9999;
}
.toast.show{ transform:translateX(-50%) translateY(0); }
</style>
</head>

<body>
<main id="pageContent">
<div class="wrap">

<section class="hero">
  <div class="heroTop">
    <div class="hTitle">Seviye Tespit SÄ±navÄ±</div>
    <div class="pill">SÃ¼re: 40 dk</div>
  </div>
  <div class="heroText">
    LÃ¼tfen sessiz ve dikkatinizin daÄŸÄ±lmayacaÄŸÄ± bir ortamda sÄ±nava baÅŸlayÄ±n.<br/>
    SÄ±nav sorularÄ± dÃ¼nya standartlarÄ± seviye tespit sÄ±navlarÄ±na gÃ¶re hazÄ±rlanmÄ±ÅŸtÄ±r.
  </div>
</section>

<section class="grid" id="grid"></section>

</div>
</main>

<div class="toast" id="toast"></div>

<script type="module">
import { mountShell } from "/js/ui_shell.js";
import { supabase } from "/js/supabase_client.js";

mountShell({ scroll:"auto" });

const $ = id => document.getElementById(id);

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1500);
}

const { data:{ session } } = await supabase.auth.getSession();
if(!session?.user) location.href="/pages/login.html";

let levels = {};
try{
  const { data } = await supabase
    .from("profiles")
    .select("levels")
    .eq("id", session.user.id)
    .single();
  levels = data?.levels || {};
}catch{}

const LANGS = [
  { code:"tr", name:"TÃ¼rkÃ§e", flag:"ðŸ‡¹ðŸ‡·" },
  { code:"az", name:"Azerice", flag:"ðŸ‡¦ðŸ‡¿" },
  { code:"kk", name:"KazakÃ§a", flag:"ðŸ‡°ðŸ‡¿" },
  { code:"uz", name:"Ã–zbekÃ§e", flag:"ðŸ‡ºðŸ‡¿" },
  { code:"ky", name:"KÄ±rgÄ±zca", flag:"ðŸ‡°ðŸ‡¬" },
  { code:"tk", name:"TÃ¼rkmence", flag:"ðŸ‡¹ðŸ‡²" },

  { code:"en", name:"Ä°ngilizce", flag:"ðŸ‡¬ðŸ‡§" },
  { code:"de", name:"Almanca", flag:"ðŸ‡©ðŸ‡ª" },
  { code:"fr", name:"FransÄ±zca", flag:"ðŸ‡«ðŸ‡·" },
  { code:"es", name:"Ä°spanyolca", flag:"ðŸ‡ªðŸ‡¸" },
  { code:"it", name:"Ä°talyanca", flag:"ðŸ‡®ðŸ‡¹" },
  { code:"ru", name:"RusÃ§a", flag:"ðŸ‡·ðŸ‡º" },

  { code:"zh", name:"Ã‡ince", flag:"ðŸ‡¨ðŸ‡³" },
  { code:"ja", name:"Japonca", flag:"ðŸ‡¯ðŸ‡µ" },
  { code:"ko", name:"Korece", flag:"ðŸ‡°ðŸ‡·" },
  { code:"th", name:"Tayca", flag:"ðŸ‡¹ðŸ‡­" },

  { code:"nl", name:"Hollandaca", flag:"ðŸ‡³ðŸ‡±" },
  { code:"sv", name:"Ä°sveÃ§Ã§e", flag:"ðŸ‡¸ðŸ‡ª" },
  { code:"pl", name:"LehÃ§e", flag:"ðŸ‡µðŸ‡±" },
  { code:"el", name:"Yunanca", flag:"ðŸ‡¬ðŸ‡·" }
];

const grid = $("grid");

grid.innerHTML = LANGS.map(l=>{
  const lv = levels[l.code] || "";
  return `
    <div class="card" data-code="${l.code}">
      <div class="flag">${l.flag}</div>
      <div class="code">${l.code.toUpperCase()}</div>
      <div class="name">${l.name}</div>
      <div class="status ${lv?'ok':''}">
        ${lv ? "Seviyeniz: "+lv : "HenÃ¼z sÄ±nava katÄ±lmadÄ±nÄ±z"}
      </div>
    </div>
  `;
}).join("");

grid.addEventListener("click", async e=>{
  const card = e.target.closest(".card");
  if(!card) return;
  const code = card.dataset.code;

  toast("BaÅŸlatÄ±lÄ±yor...");

  const { data, error } = await supabase.rpc("start_level_test", {
    p_language_code: code
  });

  if(error){
    toast(error.message);
    return;
  }

  const row = Array.isArray(data)?data[0]:data;
  location.href = `/pages/level_test.html?test_id=${row.id}&lang=${code}`;
});
</script>
</body>
</html>
