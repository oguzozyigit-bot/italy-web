<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyAI â€¢ Sesli Sohbet</title>
  <link rel="icon" href="data:," />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #020205;
      --text-main: #fff;
      --indigo: #6366f1;
      --cyan: #06b6d4;
      --pink: #ec4899;
      --orange: #f97316;
      --card-bg: rgba(20, 20, 25, 0.95);
      --glass-border: rgba(255, 255, 255, 0.1);

      --ai1:#A5B4FC;
      --ai2:#4F46E5;
      --befree:#6B7280;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; background: var(--bg-deep);
      font-family: 'Outfit', sans-serif; color: var(--text-main);
      display: flex; align-items: center; justify-content: center;
    }

    /* --- BACKGROUND (Atmosphere) --- */
    .cosmos-bg { position: absolute; inset: -50%; width: 200%; height: 200%; background: #000; z-index: 0; }
    .glow-spot {
      position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.3;
      animation: floatSpot 20s infinite alternate ease-in-out;
    }
    .gs-1 { top: 20%; left: 20%; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--indigo), transparent 70%); }
    .gs-2 { bottom: 20%; right: 20%; width: 50vw; height: 50vw; background: radial-gradient(circle, var(--cyan), transparent 70%); animation-delay: -5s; }
    @keyframes floatSpot { from { transform: translate(0,0); } to { transform: translate(5%, 5%); } }

    .mobile-frame {
      width: 100%; max-width: 480px; height: 100%;
      position: relative; z-index: 10;
      display: flex; flex-direction: column;
      background: rgba(0,0,0,0.2);
    }

    /* --- TOP LOGO (ONLY) --- */
    .top-logo {
      height: 92px;
      padding: 18px 18px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      position: relative;
      z-index: 60;
      user-select:none;
    }
    .brand {
      cursor:pointer;
      display:flex;
      flex-direction:column;
      line-height: 1;
    }
    .brandLine{
      font-family:'Space Grotesk', sans-serif;
      font-size: 28px;
      letter-spacing: -0.4px;
      display:flex;
      align-items:flex-end;
      gap:2px;
    }
    .logo-main{ font-weight:700; color:#FFFFFF; }
    .logo-ai{
      font-weight:700;
      background: linear-gradient(135deg, var(--ai1) 0%, var(--ai2) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .slogan{
      margin-top: 10px;
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 4px;
      color: var(--befree);
      text-transform: uppercase;
      padding-left: 2px;
    }

    /* --- THE CORE (Liquid AI Animation) --- */
    .stage {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      position: relative;
      padding-top: 10px;
    }

    .ai-container {
      position: relative;
      width: 300px; height: 300px;
      display: flex; align-items: center; justify-content: center;
    }

    .ai-core {
      position: absolute;
      width: 180px; height: 180px;
      border-radius: 50%;
      filter: blur(40px);
      opacity: 0.8;
      transition: all 0.5s ease;
      background: conic-gradient(from 0deg, var(--indigo), var(--cyan), var(--indigo));
      animation: spinColor 10s linear infinite, blobBreath 6s ease-in-out infinite;
    }

    /* LISTENING */
    .stage.listening .ai-core {
      width: 140px; height: 140px;
      filter: blur(25px);
      background: radial-gradient(circle, #fff, var(--cyan));
      animation: pulseIn 1s infinite alternate;
      border-radius: 50%;
    }

    /* SPEAKING */
    .stage.speaking .ai-core {
      width: 220px; height: 220px;
      filter: blur(50px);
      background: conic-gradient(from 0deg, var(--pink), var(--orange), var(--indigo), var(--pink));
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
      animation: spinColor 3s linear infinite, blobMorph 4s ease-in-out infinite;
    }

    /* STATUS */
    .status-text {
      margin-top: 40px;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 16px; font-weight: 700;
      color: rgba(255,255,255,0.72);
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0;
      transform: translateY(10px);
      transition: 0.5s;
      text-align:center;
      padding: 0 18px;
    }
    .status-text.show { opacity: 1; transform: translateY(0); }

    @keyframes spinColor { 100% { transform: rotate(360deg); } }
    @keyframes blobBreath {
      0%, 100% { transform: scale(1); border-radius: 50%; }
      50% { transform: scale(1.1); border-radius: 45% 55% 50% 50%; }
    }
    @keyframes pulseIn {
      0% { transform: scale(1); box-shadow: inset 0 0 20px #fff; }
      100% { transform: scale(0.9); box-shadow: inset 0 0 50px #000; }
    }
    @keyframes blobMorph {
      0% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
      50% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
      100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
    }

    /* --- CONTROLS --- */
    .controls {
      padding: 26px 30px 30px;
      display: flex;
      justify-content: center;
      position: relative;
      z-index: 20;
    }
    .mic-btn {
      width: 84px; height: 84px; border-radius: 50%;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.20);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: 0.2s;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      user-select:none;
    }
    .mic-btn:active { transform: scale(0.92); background: rgba(255,255,255,0.16); }
    .mic-btn svg { width: 34px; height: 34px; stroke: #fff; fill: none; stroke-width: 2; }

    .mic-btn.active { background: rgba(239, 68, 68, 0.18); border-color: rgba(239, 68, 68, 0.45); }
    .mic-btn.active svg { stroke: #ef4444; }

    /* --- VOICE MODAL --- */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(15px);
      display: none; align-items: flex-end; justify-content: center;
      padding: 16px; opacity: 0; transition: opacity 0.3s;
    }
    .modal-overlay.show { display: flex; opacity: 1; }

    .voice-card {
      width: 100%; max-width: 480px;
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 32px; padding: 18px;
      box-shadow: 0 -20px 50px rgba(0,0,0,0.8);
      transform: translateY(50px); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .modal-overlay.show .voice-card { transform: translateY(0); }

    .vc-title { font-size: 16px; font-weight: 800; color: #fff; margin-bottom: 12px; }
    .vc-sub   { font-size: 12px; font-weight: 700; color: rgba(255,255,255,.60); margin-bottom: 14px; }

    .voice-list { display: flex; flex-direction: column; gap: 10px; max-height: 44vh; overflow-y: auto; }
    .voice-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px; border-radius: 18px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer; transition: 0.2s;
      gap: 10px;
    }
    .voice-item.selected {
      background: rgba(99, 102, 241, 0.18);
      border-color: rgba(99,102,241,0.55);
    }

    .v-left{ display:flex; align-items:center; gap:12px; min-width:0; }
    .v-badge{
      width: 40px; height: 40px; border-radius: 14px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      color: rgba(255,255,255,.92);
      flex: 0 0 40px;
    }
    .v-info { display: flex; flex-direction: column; min-width:0; }
    .v-name { font-weight: 900; font-size: 14px; color: #fff; white-space: nowrap; overflow:hidden; text-overflow:ellipsis; }
    .v-lang { font-size: 11px; color: rgba(255,255,255,0.55); }

    .play-preview {
      width: 40px; height: 40px; border-radius: 14px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.10);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: #fff;
      user-select:none;
    }
    .play-preview:active { transform: scale(0.96); }

    .save-btn {
      width: 100%; height: 54px; border-radius: 20px;
      background: linear-gradient(135deg, var(--indigo), var(--pink));
      border: none; color: #fff; font-weight: 900; font-size: 15px;
      margin-top: 14px; cursor: pointer;
      user-select:none;
    }
    .save-btn:active{ transform: translateY(1px); }

    /* scrollbar minimal */
    .voice-list::-webkit-scrollbar{ width: 8px; }
    .voice-list::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.10); border-radius: 99px; }
  </style>
</head>

<body>
  <div class="cosmos-bg">
    <div class="glow-spot gs-1"></div>
    <div class="glow-spot gs-2"></div>
  </div>

  <div class="mobile-frame">
    <div class="top-logo">
      <div class="brand" id="homeLogo" title="Ana sayfa">
        <div class="brandLine">
          <span class="logo-main">italky</span><span class="logo-ai">AI</span>
        </div>
        <div class="slogan">BE FREE</div>
      </div>
    </div>

    <div class="stage" id="aiStage">
      <div class="ai-container">
        <div class="ai-core"></div>
      </div>

      <div class="status-text" id="statusText">HazÄ±r</div>
    </div>

    <div class="controls">
      <button class="mic-btn" id="micToggle" aria-label="Dinle / Durdur">
        <svg viewBox="0 0 24 24">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          <line x1="12" y1="19" x2="12" y2="23"/>
          <line x1="8" y1="23" x2="16" y2="23"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="modal-overlay" id="voiceModal">
    <div class="voice-card">
      <div class="vc-title">Asistan Sesini SeÃ§</div>
      <div class="vc-sub">SeÃ§tiÄŸin ses kaydedilir. Ä°stersen sonra deÄŸiÅŸtirebilirsin.</div>

      <div class="voice-list" id="voiceListContainer"></div>

      <button class="save-btn" id="saveVoiceBtn">SeÃ§imi Kaydet</button>
    </div>
  </div>

  <script type="module">
    const stage = document.getElementById('aiStage');
    const statusText = document.getElementById('statusText');
    const micBtn = document.getElementById('micToggle');
    const voiceModal = document.getElementById('voiceModal');
    const voiceListEl = document.getElementById('voiceListContainer');

    document.getElementById("homeLogo").addEventListener("click", ()=> {
      window.location.href = "/pages/home.html";
    });

    // Ä°stenen isim listesi (profil)
    const VOICE_PROFILES = [
      // kÄ±z
      { id:"jale",   label:"Jale",   gender:"F", emoji:"ðŸ‘©" },
      { id:"huma",   label:"HÃ¼ma",   gender:"F", emoji:"ðŸ‘©" },
      { id:"selden", label:"Selden", gender:"F", emoji:"ðŸ‘©" },
      { id:"aysem",  label:"AyÅŸem",  gender:"F", emoji:"ðŸ‘©" },
      { id:"eles",   label:"Eles",   gender:"F", emoji:"ðŸ‘©" },
      // erkek
      { id:"ozan",  label:"Ozan",  gender:"M", emoji:"ðŸ‘¨" },
      { id:"oguz",  label:"OÄŸuz",  gender:"M", emoji:"ðŸ‘¨" },
      { id:"baris", label:"BarÄ±ÅŸ", gender:"M", emoji:"ðŸ‘¨" },
      { id:"emrah", label:"Emrah", gender:"M", emoji:"ðŸ‘¨" },
      { id:"yavuz", label:"Yavuz", gender:"M", emoji:"ðŸ‘¨" },
      { id:"yilmaz",label:"YÄ±lmaz",gender:"M", emoji:"ðŸ‘¨" },
    ];

    let voices = [];
    let selectedProfileId = localStorage.getItem('italky_voice_profile') || "";

    function normalize(s){ return String(s||"").toLowerCase(); }

    // Cihazdaki uygun voice'u seÃ§ (TR Ã¶ncelik)
    function pickVoiceForProfile(profile){
      if(!voices || !voices.length) return null;

      // 1) TR voices
      const tr = voices.filter(v => normalize(v.lang).startsWith("tr"));
      const any = voices;

      // 2) gender heuristics (bazÄ± sistemlerde name iÃ§inde "female/male" geÃ§er)
      const genderPool = (arr)=>{
        if(profile.gender === "F"){
          const f = arr.filter(v => /female|woman|kadin|bayan/i.test(v.name));
          return f.length ? f : arr;
        }
        const m = arr.filter(v => /male|man|erkek/i.test(v.name));
        return m.length ? m : arr;
      };

      const pickFrom = (arr)=>{
        const a = genderPool(arr);
        // Stabil seÃ§im: profile id hash benzeri
        const idx = Math.abs(hash(profile.id)) % a.length;
        return a[idx] || a[0] || null;
      };

      // TR varsa TRâ€™den seÃ§
      if(tr.length) return pickFrom(tr);

      // yoksa genel
      return pickFrom(any);
    }

    function hash(s){
      const str = String(s||"");
      let h = 0;
      for(let i=0;i<str.length;i++){
        h = ((h<<5)-h) + str.charCodeAt(i);
        h |= 0;
      }
      return h;
    }

    function openVoiceModal(){
      voiceModal.classList.add('show');
      renderVoiceList();
    }

    function closeVoiceModal(){
      voiceModal.classList.remove('show');
    }

    function renderVoiceList(){
      voiceListEl.innerHTML = "";
      VOICE_PROFILES.forEach(p=>{
        const row = document.createElement("div");
        row.className = "voice-item" + (p.id === selectedProfileId ? " selected" : "");
        row.innerHTML = `
          <div class="v-left">
            <div class="v-badge">${p.emoji}</div>
            <div class="v-info">
              <div class="v-name">${p.label}</div>
              <div class="v-lang">${p.gender === "F" ? "KadÄ±n sesi" : "Erkek sesi"}</div>
            </div>
          </div>
          <button class="play-preview" type="button" data-id="${p.id}" aria-label="Ã–nizle">â–¶</button>
        `;

        row.addEventListener("click", (e)=>{
          if(e.target && e.target.classList.contains("play-preview")) return;
          selectedProfileId = p.id;
          document.querySelectorAll(".voice-item").forEach(el=> el.classList.remove("selected"));
          row.classList.add("selected");
        });

        const playBtn = row.querySelector(".play-preview");
        playBtn.addEventListener("click", (e)=>{
          e.preventDefault();
          e.stopPropagation();
          previewVoice(p);
        });

        voiceListEl.appendChild(row);
      });
    }

    function setStage(state, label){
      stage.classList.remove("listening","speaking");
      if(state) stage.classList.add(state);
      if(label){
        statusText.textContent = label;
        statusText.classList.add("show");
      }else{
        statusText.classList.remove("show");
      }
    }

    function speak(text){
      if(!("speechSynthesis" in window)) return;

      const profile = VOICE_PROFILES.find(x=>x.id===selectedProfileId) || VOICE_PROFILES[0];
      const voice = pickVoiceForProfile(profile);

      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(String(text||""));
      u.lang = "tr-TR";
      if(voice) u.voice = voice;
      u.rate = 1.0;
      u.pitch = 1.0;

      u.onstart = ()=> setStage("speaking", "KonuÅŸuyorumâ€¦");
      u.onend = ()=> setStage("", "HazÄ±r");

      window.speechSynthesis.speak(u);
    }

    function previewVoice(profile){
      // kÄ±sa demo
      const txt = `Merhaba! Ben ${profile.label}. Sesim nasÄ±l?`;
      speak(txt);
    }

    // Kaydet
    document.getElementById('saveVoiceBtn').addEventListener("click", ()=>{
      if(!selectedProfileId){
        selectedProfileId = VOICE_PROFILES[0].id;
      }
      localStorage.setItem('italky_voice_profile', selectedProfileId);
      closeVoiceModal();
      setTimeout(()=> speak("TamamdÄ±r. Ses ayarlandÄ±. HazÄ±rÄ±m."), 450);
    });

    // Modal dÄ±ÅŸÄ±na tÄ±kla kapat
    voiceModal.addEventListener("click", (e)=>{
      if(e.target === voiceModal) closeVoiceModal();
    });

    // Mic toggle: Listening simÃ¼lasyonu
    let isListening = false;
    micBtn.addEventListener("click", ()=>{
      isListening = !isListening;

      if(isListening){
        micBtn.classList.add("active");
        setStage("listening", "Dinliyorumâ€¦");
        // burada gerÃ§ek STT baÅŸlayacak (sonraki adÄ±m)
        window.speechSynthesis.cancel();
      }else{
        micBtn.classList.remove("active");
        setStage("", "DÃ¼ÅŸÃ¼nÃ¼yorumâ€¦");
        setTimeout(()=>{
          // demo cevap
          speak("Sesli sohbet hazÄ±r. Devam edelim mi?");
        }, 700);
      }
    });

    // Voice load
    function loadVoices(){
      voices = window.speechSynthesis.getVoices() || [];
      // Sesler geÃ§ gelirse tekrar
      if(!voices.length){
        setTimeout(loadVoices, 150);
        return;
      }

      // ilk seÃ§im yoksa modal aÃ§
      const saved = localStorage.getItem('italky_voice_profile');
      if(!saved){
        selectedProfileId = "";
        openVoiceModal();
      }else{
        selectedProfileId = saved;
        setStage("", "HazÄ±r");
      }
    }

    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();
  </script>
</body>
</html>
