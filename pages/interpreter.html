<!-- FILE: /pages/interpreter.html -->
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>italkyAI â€¢ Interpreter Mode</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ai-gradient: linear-gradient(135deg, #a5b4fc 0%, #6366f1 50%, #ec4899 100%);
      --bg: #050508;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.14);
      --muted: rgba(255,255,255,0.58);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --r: 22px;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;outline:none}
    html,body{margin:0;width:100%;height:100%;background:var(--bg);color:#fff;font-family:Outfit,sans-serif;overflow:hidden}
    .wrap{max-width:560px;margin:0 auto;min-height:100dvh;display:flex;flex-direction:column;padding:calc(16px + var(--safe-top)) 16px calc(16px + var(--safe-bottom));gap:14px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:12px 14px;border:1px solid var(--border);border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      backdrop-filter: blur(12px);
    }
    .brand{font-family:"Space Grotesk",sans-serif;font-weight:700;letter-spacing:.4px}
    .brand .ai{background:var(--ai-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .btn{
      border:1px solid var(--border);
      background:rgba(255,255,255,0.06);
      color:#fff;
      padding:10px 14px;border-radius:999px;
      font-weight:900;font-size:12px;cursor:pointer;user-select:none;
      backdrop-filter: blur(12px);
    }
    .hero{
      padding:14px 14px 8px;
      border:1px solid var(--border);
      border-radius:var(--r);
      background:rgba(255,255,255,0.04);
    }
    .h1{font-size:18px;font-weight:900;margin:0 0 6px;letter-spacing:.2px}
    .p{margin:0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .card{
      border:1px solid var(--border);
      border-radius:var(--r);
      background:var(--card);
      padding:14px;
      display:flex;flex-direction:column;gap:10px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.45);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .title{font-size:15px;font-weight:900}
    .desc{color:var(--muted);font-size:12.5px;line-height:1.35}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.25);
      font-size:11px;font-weight:900;color:rgba(255,255,255,0.86);
    }
    .cta{
      margin-top:6px;
      display:flex;gap:10px;flex-wrap:wrap;
    }
    .cta .primary{
      flex:1;
      border:none;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      color:#0b0b12;
      background:var(--ai-gradient);
      box-shadow:0 16px 40px rgba(99,102,241,0.16);
    }
    .cta .ghost{
      border:1px solid var(--border);
      background:rgba(255,255,255,0.06);
      color:#fff;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
    }
    .footnote{
      margin-top:auto;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.03);
      border-radius:18px;
      padding:12px 14px;
      color:var(--muted);
      font-size:12px;line-height:1.35;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;
      background:rgba(0,0,0,0.72);
      display:none;align-items:center;justify-content:center;
      padding:16px;
      z-index:99999;
    }
    .modal-backdrop.show{display:flex}
    .modal{
      width:min(520px, 92vw);
      border:1px solid var(--border);
      border-radius:24px;
      background:#0a0a10;
      overflow:hidden;
      box-shadow: 0 26px 80px rgba(0,0,0,0.92);
    }
    .modal-head{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 14px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      font-weight:900;
    }
    .modal-body{padding:14px;display:flex;flex-direction:column;gap:12px}
    .opt{
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.06);
      border-radius:18px;
      padding:12px;
      display:flex;flex-direction:column;gap:6px;
      cursor:pointer;user-select:none;
    }
    .opt:hover{background:rgba(255,255,255,0.08)}
    .opt .t{font-weight:900}
    .opt .s{color:var(--muted);font-size:12.5px;line-height:1.35}
    .closex{
      cursor:pointer;
      padding:8px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.06);
      user-select:none;
    }

    /* QR sheet */
    .qrbox{
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.25);
      border-radius:18px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .code{
      font-family: "Space Grotesk", monospace;
      font-weight:700;
      letter-spacing:2px;
      font-size:16px;
      opacity:.92;
    }
    .link{
      word-break:break-all;
      color:rgba(255,255,255,0.86);
      font-size:12px;
      opacity:.9;
    }
    .qrimg{
      width:220px;height:220px;border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.04);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .row2{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .mini{
      font-size:11.5px;color:var(--muted);line-height:1.35
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">italky<span class="ai">AI</span> â€¢ Interpreter</div>
      <button class="btn" id="goHome">ANA SAYFA</button>
    </div>

    <div class="hero">
      <p class="h1">Interpreter Mode</p>
      <p class="p">KarÅŸÄ±lÄ±klÄ± konuÅŸun. italkyAI seÃ§tiÄŸiniz dillere gÃ¶re Ã§evirsin. KulaklÄ±kla en temiz deneyim.</p>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <div class="title">ğŸ“± Tek Telefon</div>
          <div class="pill">PaylaÅŸarak konuÅŸ</div>
        </div>
        <div class="desc">AynÄ± cihazÄ± elden ele vererek sÄ±rayla konuÅŸun. Basit ve hÄ±zlÄ±.</div>
        <div class="cta">
          <button class="primary" id="singleStart">BaÅŸlat</button>
          <button class="ghost" id="singleInfo">NasÄ±l Ã§alÄ±ÅŸÄ±r?</button>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="title">ğŸ“±â†”ï¸ğŸ“± Ä°ki Telefon (QR)</div>
          <div class="pill">KulaklÄ±k iÃ§in ideal</div>
        </div>
        <div class="desc">Herkes kendi telefonundan konuÅŸur. QR ile eÅŸleÅŸir. Jeton Hostâ€™tan dÃ¼ÅŸer.</div>
        <div class="cta">
          <button class="primary" id="pairStart">Devam</button>
          <button class="ghost" id="pairInfo">Host Ã¶der mi?</button>
        </div>
      </div>
    </div>

    <div class="footnote">
      ğŸ’¡ Ä°pucu: Ä°ki telefon modunda herkes kendi Bluetooth kulaklÄ±ÄŸÄ±nÄ± takarsa yankÄ± azalÄ±r, Ã§eviri daha net duyulur.
    </div>
  </div>

  <!-- Modal: Role Select / Host QR / Guest Scan -->
  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <div class="modal-head">
        <div id="modalTitle">RolÃ¼nÃ¼ SeÃ§</div>
        <div class="closex" id="modalClose">âœ•</div>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script type="module">
    const HOME_PATH = "/pages/home.html";
    const FACETOFACE_PATH = "/pages/facetoface.html";
    const JOIN_PATH = "/pages/join.html";

    // Senin backend base'in hazÄ±r:
    const API_BASE = "https://italky-api.onrender.com";

    const $ = (id)=>document.getElementById(id);

    const modal = $("modal");
    const modalTitle = $("modalTitle");
    const modalBody = $("modalBody");

    function openModal(title, html){
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      modal.classList.add("show");
    }
    function closeModal(){ modal.classList.remove("show"); }

    $("modalClose").addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

    $("goHome").addEventListener("click", ()=> location.href = HOME_PATH);

    $("singleInfo").addEventListener("click", ()=>{
      openModal("Tek Telefon", `
        <div class="mini">
          â€¢ AynÄ± cihazÄ± paylaÅŸarak sÄ±rayla konuÅŸursunuz.<br>
          â€¢ Sistem half-duplex Ã§alÄ±ÅŸÄ±r: biri konuÅŸur â†’ Ã§eviri â†’ diÄŸeri konuÅŸur.<br>
          â€¢ KulaklÄ±k takarsan daha net duyarsÄ±n.
        </div>
        <div class="cta" style="margin-top:12px">
          <button class="primary" id="goSingle">BaÅŸlat</button>
          <button class="ghost" id="close1">Kapat</button>
        </div>
      `);
      document.getElementById("goSingle").onclick = () => location.href = FACETOFACE_PATH + "?mode=single";
      document.getElementById("close1").onclick = closeModal;
    });

    $("singleStart").addEventListener("click", ()=>{
      location.href = FACETOFACE_PATH + "?mode=single";
    });

    $("pairInfo").addEventListener("click", ()=>{
      openModal("Ä°ki Telefon (Host Ã–der)", `
        <div class="mini">
          â€¢ Host oda aÃ§ar ve QR Ã¼retir.<br>
          â€¢ Guest QR okutup katÄ±lÄ±r.<br>
          â€¢ Jeton sadece Hostâ€™tan dÃ¼ÅŸer (tur baÅŸÄ±na).<br>
          â€¢ Herkes kendi kulaklÄ±ÄŸÄ±ndan konuÅŸur/dinler.
        </div>
        <div class="cta" style="margin-top:12px">
          <button class="primary" id="goPair">Devam</button>
          <button class="ghost" id="close2">Kapat</button>
        </div>
      `);
      document.getElementById("goPair").onclick = () => showRoleSelect();
      document.getElementById("close2").onclick = closeModal;
    });

    $("pairStart").addEventListener("click", ()=> showRoleSelect());

    function showRoleSelect(){
      openModal("RolÃ¼nÃ¼ SeÃ§", `
        <div class="opt" id="asHost">
          <div class="t">HOST (OdayÄ± AÃ§ / Ã–der)</div>
          <div class="s">QR Ã¼retir. Jeton Hostâ€™tan dÃ¼ÅŸer.</div>
        </div>
        <div class="opt" id="asGuest">
          <div class="t">GUEST (QR ile KatÄ±l / Ãœcretsiz)</div>
          <div class="s">QR okutur, otomatik baÄŸlanÄ±r.</div>
        </div>
        <div class="mini">Not: Uygulama yÃ¼klÃ¼ deÄŸilse link sizi Ã¶nce yÃ¼klemeye yÃ¶nlendirir.</div>
      `);

      document.getElementById("asHost").onclick = () => showHostCreate();
      document.getElementById("asGuest").onclick = () => showGuestScan();
    }

    // Basit QR Ã¼retimi iÃ§in: Ã¼cretsiz bir gÃ¶rÃ¼ntÃ¼ endpoint'i kullanÄ±yoruz (backend gerektirmez)
    function makeQrImgData(url){
      // NOT: Bu bir "QR servisi" kullanÄ±r. Ä°stersen yarÄ±n backend'e alÄ±rÄ±z.
      // Burada linki QR'a Ã§evirmek iÃ§in hÄ±zlÄ± yol:
      return "https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=" + encodeURIComponent(url);
    }

    function randomRoomId(){
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let out = "";
      for(let i=0;i<5;i++) out += chars[Math.floor(Math.random()*chars.length)];
      return out;
    }

    async function showHostCreate(){
      // Ä°deal: backend'den room_id al.
      // EÄŸer endpoint yoksa fallback: local room_id Ã¼ret.
      let room = "";
      try{
        const r = await fetch(API_BASE + "/api/f2f/room/create", { method:"POST" });
        if(r.ok){
          const j = await r.json().catch(()=>({}));
          room = String(j.room_id || "").trim();
        }
      }catch{}

      if(!room) room = randomRoomId();

      const joinUrl = location.origin + JOIN_PATH + "?room=" + encodeURIComponent(room);
      const qrImg = makeQrImgData(joinUrl);

      openModal("Host â€¢ QR GÃ¶ster", `
        <div class="qrbox">
          <div class="row2">
            <div class="qrimg"><img src="${qrImg}" width="220" height="220" alt="QR"/></div>
            <div style="flex:1;min-width:160px;display:flex;flex-direction:column;gap:10px">
              <div class="mini">Partner bu QRâ€™Ä± okutsun.</div>
              <div class="code">${room}</div>
              <div class="link">${joinUrl}</div>
              <div class="cta" style="margin:0">
                <button class="ghost" id="copyLink">Linki Kopyala</button>
                <button class="ghost" id="copyCode">Kodu Kopyala</button>
              </div>
            </div>
          </div>
          <div class="mini">Partner baÄŸlanÄ±nca otomatik Face-to-Face aÃ§Ä±lacak.</div>
          <div class="cta" style="margin-top:2px">
            <button class="primary" id="hostGo">Bekle & BaÅŸlat</button>
            <button class="ghost" id="hostBack">Geri</button>
          </div>
        </div>
      `);

      document.getElementById("copyLink").onclick = async ()=> {
        try{ await navigator.clipboard.writeText(joinUrl); }catch{}
      };
      document.getElementById("copyCode").onclick = async ()=> {
        try{ await navigator.clipboard.writeText(room); }catch{}
      };

      // Host, bu butonla direkt face-to-face'e girer (room ve role parametresiyle)
      document.getElementById("hostGo").onclick = () => {
        location.href = FACETOFACE_PATH + "?mode=pair&role=host&room=" + encodeURIComponent(room);
      };
      document.getElementById("hostBack").onclick = showRoleSelect;
    }

    function showGuestScan(){
      // Web Ã¼zerinde direkt kamera QR okuma iÃ§in ek lib lazÄ±m; burada pratik Ã§Ã¶zÃ¼m:
      // Guestâ€™e "join.html" linkini aÃ§tÄ±rÄ±yoruz. QR okutan zaten oraya dÃ¼ÅŸer.
      openModal("Guest â€¢ QR Okut", `
        <div class="mini">
          QR okutunca otomatik devam eder.<br><br>
          Test iÃ§in: elinde kod varsa buraya yazÄ±p katÄ±labilirsin.
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <input id="roomInput" placeholder="Oda kodu (Ã¶rn: R9K3X)" style="
            flex:1;min-width:180px;padding:12px 12px;border-radius:16px;
            border:1px solid rgba(255,255,255,0.14);
            background:rgba(0,0,0,0.25);
            color:#fff;font-weight:800;
          "/>
          <button class="primary" id="joinRoom">KatÄ±l</button>
        </div>
        <div class="cta" style="margin-top:12px">
          <button class="ghost" id="guestBack">Geri</button>
          <button class="ghost" id="guestClose">Kapat</button>
        </div>
      `);

      document.getElementById("joinRoom").onclick = () => {
        const room = (document.getElementById("roomInput").value || "").trim().toUpperCase();
        if(!room) return;
        location.href = FACETOFACE_PATH + "?mode=pair&role=guest&room=" + encodeURIComponent(room);
      };

      document.getElementById("guestBack").onclick = showRoleSelect;
      document.getElementById("guestClose").onclick = closeModal;
    }
  </script>
</body>
</html>
