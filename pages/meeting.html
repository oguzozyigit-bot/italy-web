<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>italkyAI • Global Meeting</title>
  <style>
    :root {
      --ai-gradient: linear-gradient(135deg, #a5b4fc 0%, #6366f1 50%, #ec4899 100%);
      --glass: rgba(255, 255, 255, 0.05);
      --neon: #6366f1;
    }

    /* Üst ve Alt Barı Öldür, Arka Planı Canlandır */
    body, html {
      margin: 0; padding: 0; width: 100%; height: 100vh;
      background: #02000f; font-family: 'Outfit', sans-serif;
      overflow: hidden; color: #fff;
    }

    .nebula {
      position: fixed; inset: 0; z-index: -1;
      background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #02000f 100%);
    }

    /* ✅ TAM EKRAN CONTAINER */
    #meetingHub {
      height: 100vh;
      display: flex; flex-direction: column;
      padding: env(safe-area-inset-top) 15px env(safe-area-inset-bottom);
      box-sizing: border-box;
      gap: 15px;
    }

    /* 1. YÜZER ÜST PANEL (Floating Header) */
    .floating-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px; background: rgba(255,255,255,0.03);
      border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(20px); margin-top: 10px;
    }
    .room-badge { display: flex; flex-direction: column; }
    .room-badge b { font-size: 16px; letter-spacing: 1px; }
    .room-badge span { font-size: 10px; color: #34d399; font-weight: 900; }

    .my-mini-profile { display: flex; align-items: center; gap: 10px; }
    .my-mini-profile img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--neon); }

    /* 2. NEURAL REHBER (PARTICIPANTS) */
    .participants-zone {
      display: flex; gap: 12px; overflow-x: auto; padding: 5px 0;
      scrollbar-width: none;
    }
    .participants-zone::-webkit-scrollbar { display: none; }

    .u-node {
      flex-shrink: 0; display: flex; flex-direction: column; align-items: center; gap: 6px;
    }
    .u-circle {
      width: 60px; height: 60px; border-radius: 20px;
      background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: center;
      position: relative; font-size: 24px;
    }
    .u-circle img { width: 100%; height: 100%; border-radius: 20px; object-fit: cover; }
    .u-circle.active { border: 2px solid #34d399; box-shadow: 0 0 15px rgba(52, 211, 153, 0.3); }
    .u-node span { font-size: 10px; font-weight: 800; opacity: 0.8; }

    /* 3. ANA CHAT AKIŞI (GENİŞ ALAN) */
    .neural-stream {
      flex: 1; background: rgba(255,255,255,0.02); border-radius: 35px;
      border: 1px solid rgba(255,255,255,0.05); padding: 20px;
      display: flex; flex-direction: column; gap: 15px;
      overflow-y: auto; scrollbar-width: none;
    }
    .neural-stream::-webkit-scrollbar { display: none; }

    .bubble { max-width: 85%; padding: 15px; border-radius: 25px; line-height: 1.5; }
    .bubble.in { background: rgba(255,255,255,0.06); align-self: flex-start; border-bottom-left-radius: 5px; }
    .bubble.out { background: var(--ai-gradient); align-self: flex-end; border-bottom-right-radius: 5px; }
    
    .sender { font-size: 11px; font-weight: 1000; color: #a5b4fc; margin-bottom: 5px; display: block; }
    .orig { font-size: 15px; font-weight: 700; }
    .trans { font-size: 13px; font-weight: 600; opacity: 0.7; margin-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 6px; font-style: italic; }

    /* 4. YÜZER KONTROL PANELİ (Floating Controls) */
    .floating-controls {
      display: flex; justify-content: space-around; align-items: center;
      padding: 15px; background: rgba(0,0,0,0.6);
      border-radius: 30px; border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(20px); margin-bottom: 10px;
    }

    .ctrl-icon {
      width: 50px; height: 50px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: 0.3s;
    }
    .ctrl-icon svg { width: 24px; height: 24px; stroke: #fff; fill: none; stroke-width: 2.2; }
    .ctrl-icon.warn { background: #580c1f; }
    .ctrl-icon.add { background: var(--ai-gradient); color: #000; }

  </style>
</head>

<body>
  <div class="nebula"></div>

  <div id="meetingHub">
    
    <div class="floating-header">
      <div class="room-badge">
        <b>HUB #OZY-2026</b>
        <span>● 12 KATILIMCI AKTİF</span>
      </div>
      <div class="my-mini-profile">
        <div style="text-align: right">
          <div id="dispName" style="font-weight: 900; font-size: 14px;">...</div>
          <div id="dispID" style="font-size: 10px; opacity: 0.5;">ID: —</div>
        </div>
        <img src="" id="dispPic">
      </div>
    </div>

    <div class="participants-zone" id="pList">
      <div class="u-node">
        <div class="u-circle active"><img src="https://i.pravatar.cc/100?u=1"></div>
        <span>Oğuz</span>
      </div>
      <div class="u-node">
        <div class="u-circle"><img src="https://i.pravatar.cc/100?u=2"></div>
        <span>Selden</span>
      </div>
      <div class="u-node">
        <div class="u-circle"><img src="https://i.pravatar.cc/100?u=3"></div>
        <span>Hans</span>
      </div>
      </div>

    <div class="neural-stream" id="chatStream">
      <div class="bubble in">
        <span class="sender">HANS MÜLLER</span>
        <div class="orig">Is the universal translation active?</div>
        <div class="trans">Evrensel çeviri aktif mi?</div>
      </div>
      <div class="bubble out">
        <div class="orig">Evet Hans, 2050 teknolojisi devrede.</div>
        <div class="trans">Yes Hans, 2050 technology is in play.</div>
      </div>
    </div>

    <div class="floating-controls">
      <div class="ctrl-icon" id="mic"><svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg></div>
      <div class="ctrl-icon add" id="inviteBtn"><b style="font-size: 20px;">+</b></div>
      <div class="ctrl-icon" id="sound"><svg viewBox="0 0 24 24"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></div>
      <div class="ctrl-icon warn" onclick="location.href='/pages/home.html'"><svg viewBox="0 0 24 24"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg></div>
    </div>

  </div>

  <script type="module">
    import { supabase } from "/js/supabase_client.js";

    // ✅ PROFiL VERİLERİNİ ÇEK
    async function loadIdentity() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) return;

      const { data: p } = await supabase
        .from("profiles")
        .select("full_name, member_no")
        .eq("id", session.user.id)
        .single();

      if (p) {
        document.getElementById('dispName').textContent = p.full_name.split(' ')[0];
        document.getElementById('dispID').textContent = "ID: " + p.member_no;
        // LocalStorage'dan resmi çek (Shell'in önbelleği)
        const cached = JSON.parse(localStorage.getItem('italky_user_v1') || '{}');
        if(cached.picture) document.getElementById('dispPic').src = cached.picture;
      }
    }

    document.getElementById('inviteBtn').onclick = () => {
      const id = prompt("Üye Numarasını Girin:");
      if(id) alert(id + " davet edildi.");
    };

    document.getElementById('mic').onclick = function() { this.classList.toggle('warn'); };
    
    loadIdentity();
  </script>
</body>
</html>
