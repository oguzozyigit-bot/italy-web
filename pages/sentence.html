<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ITALKY â€¢ Sentence Builder</title>
  <link rel="icon" href="data:," />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- TEMA: DEEP SPACE NEON --- */
    :root {
      --bg-deep: #050005;
      --panel-bg: rgba(15, 15, 25, 0.95);
      --primary: #9900ff; /* Mor */
      --accent: #00f3ff;  /* Cyan */
      --success: #00e676;
      --error: #ff1744;
      --text: #ffffff;
      --border: rgba(255, 255, 255, 0.15);
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    html, body { margin: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; font-family: 'Outfit', sans-serif; background: var(--bg-deep); color: var(--text); display: flex; align-items: center; justify-content: center; }

    .cosmos-bg { position: absolute; inset: 0; background: radial-gradient(circle at center, #1a001a 0%, #000 100%); z-index: 0; }
    .star-dust { position: absolute; inset: 0; opacity: 0.3; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 40px 40px; }

    .mobile-frame {
      width: 100%; max-width: 480px; height: 100%; position: relative; z-index: 10;
      display: flex; flex-direction: column; background: var(--panel-bg);
      backdrop-filter: blur(20px); border: 1px solid var(--border); overflow: hidden;
    }
    @media(min-width: 520px) { .mobile-frame { height: 92vh; border-radius: 32px; box-shadow: 0 40px 100px -20px #000; } }

    .header { flex: 0 0 70px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
    .nav-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
    .nav-btn:active { transform: scale(0.95); }
    .page-title { font-family: 'Space Grotesk', sans-serif; font-size: 18px; font-weight: 700; letter-spacing: 1px; color: var(--accent); text-transform: uppercase; }
    .lang-badge { font-size: 10px; padding: 4px 8px; background: var(--primary); border-radius: 6px; color: #fff; margin-left: 8px; vertical-align: middle; }

    .game-area { flex: 1; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }

    .stats-row { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.03); padding: 10px 15px; border-radius: 16px; border: 1px solid var(--border); }
    .stat-item { display: flex; flex-direction: column; align-items: center; }
    .stat-label { font-size: 10px; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px; }
    .stat-val { font-family: 'Space Grotesk', sans-serif; font-weight: 700; font-size: 16px; }
    .lives { color: var(--error); letter-spacing: 2px; }

    .hint-card {
      background: linear-gradient(135deg, rgba(153,0,255,0.1), rgba(0,243,255,0.05));
      border: 1px solid rgba(153,0,255,0.3);
      border-radius: 16px; padding: 15px; text-align: center;
      min-height: 60px; display: flex; align-items: center; justify-content: center;
    }
    .hint-text { font-size: 16px; font-weight: 600; color: #fff; font-style: italic; }

    .target-zone {
      min-height: 100px;
      background: rgba(0,0,0,0.3);
      border: 2px dashed var(--border);
      border-radius: 20px;
      padding: 10px;
      display: flex; flex-wrap: wrap; gap: 8px; align-content: flex-start;
      transition: 0.3s;
    }
    .target-zone.wrong { border-color: var(--error); animation: shake 0.4s; }
    .target-zone.correct { border-color: var(--success); background: rgba(0, 230, 118, 0.1); }

    .pool-zone {
      flex: 1;
      display: flex; flex-wrap: wrap; align-content: flex-start; justify-content: center; gap: 8px;
      padding-top: 10px;
    }

    .token {
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      color: #fff; padding: 10px 14px; border-radius: 12px;
      font-size: 16px; font-weight: 600; cursor: pointer;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3);
      transition: all 0.1s; animation: popIn 0.3s backwards;
    }
    .token:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
    
    .token.placed {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border: none; box-shadow: 0 4px 0 rgba(0,0,0,0.4); text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .action-row { display: flex; gap: 10px; margin-top: auto; }
    .game-btn { flex: 1; padding: 14px; border-radius: 16px; border: none; font-weight: 800; font-size: 14px; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
    .btn-check { background: var(--success); color: #000; box-shadow: 0 5px 15px rgba(0,230,118,0.3); }
    .btn-check:active { transform: scale(0.98); }
    .btn-sec { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid var(--border); }

    .modal-wrap { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 99; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .modal-card { width: 85%; max-width: 320px; background: #151520; border: 1px solid var(--border); border-radius: 24px; padding: 24px; text-align: center; animation: popIn 0.4s; }
    .modal-title { font-family: 'Space Grotesk', sans-serif; font-size: 22px; font-weight: 800; margin-bottom: 10px; color: var(--accent); }
    
    .lang-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
    .lang-opt { background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 12px; border-radius: 12px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px; transition:0.2s; }
    .lang-opt.active { background: var(--primary); border-color: var(--primary); }

    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
    @keyframes popIn { from{transform:scale(0.8); opacity:0} to{transform:scale(1); opacity:1} }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <div class="cosmos-bg"><div class="star-dust"></div></div>

  <div class="mobile-frame">
    <div class="header">
      <div class="nav-btn" onclick="location.href='/pages/game.html'">â†</div>
      <div class="page-title">SENTENCE BUILDER <span id="currentLangBadge" class="lang-badge">EN</span></div>
      <div class="nav-btn" onclick="toggleSound()" id="soundIcon">ğŸ”Š</div>
    </div>

    <div class="game-area hidden" id="gameScreen">
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">PUAN</div>
          <div class="stat-val" style="color:var(--success)" id="scoreVal">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">KALAN CAN</div>
          <div class="stat-val lives" id="livesVal">â¤ï¸â¤ï¸â¤ï¸</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">SEVÄ°YE</div>
          <div class="stat-val" id="levelVal">1</div>
        </div>
      </div>

      <div class="hint-card">
        <div class="hint-text" id="hintText">...</div>
      </div>

      <div class="target-zone" id="targetZone">
        <div style="width:100%; text-align:center; opacity:0.3; margin-top:20px; pointer-events:none;">Kelimeleri buraya diz...</div>
      </div>

      <div class="pool-zone" id="poolZone"></div>

      <div class="action-row">
        <button class="game-btn btn-sec" onclick="resetLevel()">SIFIRLA</button>
        <button class="game-btn btn-check" onclick="checkSentence()">KONTROL ET</button>
      </div>
    </div>
  </div>

  <div class="modal-wrap" id="langModal" style="display:flex;">
    <div class="modal-card">
      <div class="modal-title">DÄ°L SEÃ‡Ä°MÄ°</div>
      <div style="font-size:13px; opacity:0.7;">Pratik yapmak istediÄŸin dili seÃ§:</div>
      
      <div class="lang-grid">
        <div class="lang-opt" onclick="selectLang('en')">ğŸ‡¬ğŸ‡§ EN</div>
        <div class="lang-opt" onclick="selectLang('de')">ğŸ‡©ğŸ‡ª DE</div>
        <div class="lang-opt" onclick="selectLang('fr')">ğŸ‡«ğŸ‡· FR</div>
        <div class="lang-opt" onclick="selectLang('es')">ğŸ‡ªğŸ‡¸ ES</div>
        <div class="lang-opt" onclick="selectLang('it')">ğŸ‡®ğŸ‡¹ IT</div>
      </div>

      <div style="font-size:11px; opacity:0.5; margin-top:10px;">
        150+ CÃ¼mle â€¢ Offline Mod
      </div>
    </div>
  </div>

  <div class="modal-wrap" id="resultModal">
    <div class="modal-card">
      <div class="modal-title" id="resTitle">OYUN BÄ°TTÄ°</div>
      <div id="resDesc" style="margin-bottom:20px; font-size:14px; opacity:0.9;"></div>
      <button class="game-btn btn-check" onclick="restartGame()">TEKRAR OYNA</button>
      <div style="height:10px"></div>
      <button class="game-btn btn-sec" onclick="location.href='/pages/game.html'">Ã‡IKIÅ</button>
    </div>
  </div>

<script>
// --- OFFLINE DATABASE (Offline Ä°Ã§erik) ---
const SENTENCE_DB = {
  en: [
    { t: "Her gÃ¼n okula giderim", s: "I go to school every day." },
    { t: "O benim en iyi arkadaÅŸÄ±m", s: "She is my best friend." },
    { t: "Kedi masanÄ±n altÄ±nda", s: "The cat is under the table." },
    { t: "Kahve iÃ§meyi severim", s: "I like to drink coffee." },
    { t: "LÃ¼tfen kapÄ±yÄ± aÃ§", s: "Please open the door." },
    { t: "BugÃ¼n hava Ã§ok soÄŸuk", s: "It is very cold today." },
    { t: "AdÄ±n ne?", s: "What is your name?" },
    { t: "Seni bekliyordum", s: "I have been waiting for you." },
    { t: "Yeni bir araba aldÄ±m", s: "I bought a new car." },
    { t: "YarÄ±n gÃ¶rÃ¼ÅŸÃ¼rÃ¼z", s: "See you tomorrow." },
    { t: "Nerede yaÅŸÄ±yorsun?", s: "Where do you live?" },
    { t: "Sana yardÄ±m edebilir miyim?", s: "Can I help you?" },
    { t: "O Ã§ok gÃ¼zel ÅŸarkÄ± sÃ¶yler", s: "She sings very beautifully." },
    { t: "DÃ¼n gece uyuyamadÄ±m", s: "I could not sleep last night." },
    { t: "BaÅŸarÄ± Ã§alÄ±ÅŸmaya baÄŸlÄ±dÄ±r", s: "Success depends on hard work." },
    { t: "Zaman paradÄ±r", s: "Time is money." }
  ],
  de: [
    { t: "Benim adÄ±m Ali", s: "Mein Name ist Ali." },
    { t: "NasÄ±lsÄ±n?", s: "Wie geht es dir?" },
    { t: "Seni seviyorum", s: "Ich liebe dich." },
    { t: "Bu Ã§ok pahalÄ±", s: "Das ist zu teuer." },
    { t: "Almanca Ã¶ÄŸreniyorum", s: "Ich lerne Deutsch." },
    { t: "Hafta sonu ne yapÄ±yorsun?", s: "Was machst du am Wochenende?" },
    { t: "Bir kahve istiyorum", s: "Ich mÃ¶chte einen Kaffee." },
    { t: "Hava bugÃ¼n gÃ¼zel", s: "Das Wetter ist heute schÃ¶n." },
    { t: "Yorgunum", s: "Ich bin mÃ¼de." }
  ],
  fr: [
    { t: "Benim adÄ±m Ali", s: "Je m'appelle Ali." },
    { t: "NasÄ±lsÄ±n?", s: "Comment Ã§a va ?" },
    { t: "Seni seviyorum", s: "Je t'aime." },
    { t: "Bu Ã§ok gÃ¼zel", s: "C'est trÃ¨s beau." },
    { t: "FransÄ±zca Ã¶ÄŸreniyorum", s: "J'apprends le franÃ§ais." },
    { t: "Saat kaÃ§?", s: "Quelle heure est-il ?" },
    { t: "Bir kahve lÃ¼tfen", s: "Un cafÃ© s'il vous plaÃ®t." }
  ],
  es: [
    { t: "Benim adÄ±m Ali", s: "Me llamo Ali." },
    { t: "NasÄ±lsÄ±n?", s: "CÃ³mo estÃ¡s?" },
    { t: "Seni seviyorum", s: "Te quiero." },
    { t: "Ä°spanyolca Ã¶ÄŸreniyorum", s: "Estoy aprendiendo espaÃ±ol." },
    { t: "Neredesin?", s: "DÃ³nde estÃ¡s?" },
    { t: "Bir kahve istiyorum", s: "Quiero un cafÃ©." }
  ],
  it: [
    { t: "Benim adÄ±m Ali", s: "Mi chiamo Ali." },
    { t: "NasÄ±lsÄ±n?", s: "Come stai?" },
    { t: "Seni seviyorum", s: "Ti amo." },
    { t: "Ä°talyanca Ã¶ÄŸreniyorum", s: "Sto imparando l'italiano." },
    { t: "Nereden geliyorsun?", s: "Di dove sei?" },
    { t: "Bir kahve lÃ¼tfen", s: "Un caffÃ¨ per favore." }
  ]
};

// --- OYUN STATE ---
let currentLang = 'en';
let currentLevel = 0;
let score = 0;
let lives = 3;
let currentSentence = {};
let targetTokens = [];
let poolTokens = [];
let correctTokens = [];
let isMuted = false;

// --- DÄ°L SEÃ‡Ä°MÄ° ---
window.selectLang = (lang) => {
  currentLang = lang;
  document.getElementById('currentLangBadge').innerText = lang.toUpperCase();
  document.getElementById('langModal').style.display = 'none';
  document.getElementById('gameScreen').classList.remove('hidden');
  restartGame();
};

// --- OYUN BAÅLATMA (DÃœZELTÄ°LDÄ°: Tekrar Oyna iÃ§in) ---
function restartGame() {
  document.getElementById('resultModal').style.display = 'none'; // ModalÄ± kapat
  score = 0;
  lives = 3;
  currentLevel = 0;
  updateStats();
  
  // Veriyi karÄ±ÅŸtÄ±r (Her oyun farklÄ± sÄ±ra)
  if(SENTENCE_DB[currentLang]) {
    SENTENCE_DB[currentLang].sort(() => Math.random() - 0.5);
  }
  
  loadLevel();
}

// --- TOKEN PARSE ---
function parseSentence(sentence) {
  // Kelimeleri ve noktalamalarÄ± ayÄ±rÄ±r
  return sentence.match(/[\wÃ€-Å¾]+|[.,!?;]/g) || [];
}

// --- SEVÄ°YE YÃœKLEME ---
function loadLevel() {
  if (lives <= 0 || currentLevel >= SENTENCE_DB[currentLang].length) {
    endGame();
    return;
  }

  currentSentence = SENTENCE_DB[currentLang][currentLevel];
  
  // TÃ¼rkÃ§e Ä°pucu
  document.getElementById('hintText').innerText = currentSentence.t;
  
  // Token'lara ayÄ±r
  correctTokens = parseSentence(currentSentence.s);
  
  // Havuzu karÄ±ÅŸtÄ±r
  poolTokens = [...correctTokens].sort(() => Math.random() - 0.5);
  
  // Benzersiz ID
  poolTokens = poolTokens.map((txt, idx) => ({ id: idx, text: txt }));
  
  targetTokens = [];
  renderUI();
}

// --- ARAYÃœZ Ã‡Ä°ZÄ°MÄ° ---
function renderUI() {
  const targetZone = document.getElementById('targetZone');
  const poolZone = document.getElementById('poolZone');
  
  targetZone.innerHTML = '';
  poolZone.innerHTML = '';
  
  if (targetTokens.length === 0) {
    targetZone.innerHTML = `<div style="width:100%; text-align:center; opacity:0.3; pointer-events:none;">Kelimelere dokun...</div>`;
  } else {
    targetTokens.forEach((tok, index) => {
      let btn = document.createElement('div');
      btn.className = 'token placed';
      btn.innerText = tok.text;
      btn.onclick = () => unplaceToken(index);
      targetZone.appendChild(btn);
    });
  }
  
  poolTokens.forEach((tok, index) => {
    let btn = document.createElement('div');
    btn.className = 'token';
    btn.innerText = tok.text;
    btn.onclick = () => placeToken(index);
    poolZone.appendChild(btn);
  });
}

// --- ETKÄ°LEÅÄ°M (SES EKLENDÄ°) ---
function placeToken(poolIndex) {
  const token = poolTokens[poolIndex];
  poolTokens.splice(poolIndex, 1);
  targetTokens.push(token);
  
  speak(token.text); // âœ… KELÄ°MEYÄ° OKU
  playSFX('click');
  renderUI();
}

function unplaceToken(targetIndex) {
  const token = targetTokens[targetIndex];
  targetTokens.splice(targetIndex, 1);
  poolTokens.push(token);
  playSFX('click');
  renderUI();
}

function resetLevel() {
  poolTokens = [...poolTokens, ...targetTokens];
  targetTokens = [];
  renderUI();
}

// --- KONTROL MEKANÄ°ZMASI ---
function checkSentence() {
  if (targetTokens.length === 0) return;

  const userSentence = targetTokens.map(t => t.text).join("");
  const idealSentence = correctTokens.join("");
  
  const targetZone = document.getElementById('targetZone');

  if (userSentence === idealSentence) {
    // DOÄRU
    targetZone.classList.add('correct');
    playSFX('win');
    score += 10;
    speak(currentSentence.s); // âœ… DOÄRU CÃœMLEYÄ° OKU
    
    setTimeout(() => {
      targetZone.classList.remove('correct');
      currentLevel++;
      updateStats();
      loadLevel();
    }, 1500);
    
  } else {
    // YANLIÅ
    targetZone.classList.add('wrong');
    playSFX('fail');
    lives--;
    updateStats();
    
    setTimeout(() => {
      targetZone.classList.remove('wrong');
      if (lives <= 0) endGame();
    }, 500);
  }
}

function updateStats() {
  document.getElementById('scoreVal').innerText = score;
  document.getElementById('levelVal').innerText = currentLevel + 1;
  let hearts = "â¤ï¸".repeat(lives) + "ğŸ’€".repeat(3 - lives);
  document.getElementById('livesVal').innerText = hearts;
}

// --- OYUN SONU (DÃœZELTÄ°LDÄ°: DoÄŸruyu GÃ¶ster) ---
function endGame() {
  document.getElementById('resultModal').style.display = 'flex';
  const title = lives > 0 ? "ÅAMPÄ°YON! ğŸ†" : "OYUN BÄ°TTÄ° ğŸ’€";
  
  let desc = `Toplam Puan: <strong style="color:#fff">${score}</strong>`;
  
  // EÄŸer kaybettiyse doÄŸrusunu gÃ¶ster
  if (lives <= 0) {
    desc += `<br><br><span style="color:#ff1744; font-weight:bold; font-size:12px;">DOÄRUSU:</span><br>
             <span style="color:#fff; font-size:16px; font-style:italic;">"${currentSentence.s}"</span>`;
             
    speak(currentSentence.s); // âœ… DOÄRUSUNU OKU
  }
  
  document.getElementById('resTitle').innerText = title;
  document.getElementById('resDesc').innerHTML = desc;
}

// --- SES SÄ°STEMÄ° (GÃœVENLÄ° TIMEOUT) ---
const synth = window.speechSynthesis;
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function toggleSound() {
  isMuted = !isMuted;
  document.getElementById('soundIcon').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
}

function playSFX(type) {
  if (isMuted) return;
  if (audioCtx.state === 'suspended') audioCtx.resume();
  
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  
  const t = audioCtx.currentTime;
  
  if (type === 'click') {
    osc.frequency.setValueAtTime(600, t);
    osc.frequency.exponentialRampToValueAtTime(300, t + 0.1);
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.1);
    osc.start(t); osc.stop(t + 0.1);
  } else if (type === 'win') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(440, t);
    osc.frequency.setValueAtTime(554, t + 0.1); 
    osc.frequency.setValueAtTime(659, t + 0.2); 
    gain.gain.setValueAtTime(0.2, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.4);
    osc.start(t); osc.stop(t + 0.4);
  } else if (type === 'fail') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(150, t);
    osc.frequency.linearRampToValueAtTime(50, t + 0.3);
    gain.gain.setValueAtTime(0.2, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.3);
    osc.start(t); osc.stop(t + 0.3);
  }
}

function speak(text) {
  if (isMuted) return;
  // TakÄ±lmayÄ± Ã¶nleyen sigorta
  const tm = setTimeout(() => {}, 2000);
  
  try {
    synth.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const langMap = { 'en': 'en-US', 'de': 'de-DE', 'fr': 'fr-FR', 'es': 'es-ES', 'it': 'it-IT' };
    u.lang = langMap[currentLang] || 'en-US';
    u.rate = 0.9;
    
    u.onend = () => clearTimeout(tm);
    synth.speak(u);
  } catch(e) { clearTimeout(tm); }
}

</script>
</body>
</html>
