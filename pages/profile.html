<!-- FILE: /pages/profile.html -->
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>italkyAI • Profil</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">

<style>
#pageContent{height:100%}

.wrap{
  min-height:100%;
  padding:16px 16px 200px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.card{
  border-radius:24px;
  padding:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.05);
}

.title{
  font-size:14px;
  font-weight:1000;
  margin-bottom:6px;
}

.desc{
  font-size:12px;
  opacity:.7;
  font-weight:700;
}

.value{
  font-size:18px;
  font-weight:1000;
  margin-top:6px;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.btn{
  height:48px;
  border-radius:16px;
  font-weight:1000;
  border:none;
  cursor:pointer;
}

.btnPrimary{
  background:linear-gradient(135deg,#A5B4FC,#4F46E5);
  color:#fff;
}

.btnSafe{
  background:rgba(0,200,120,.2);
  border:1px solid rgba(0,200,120,.4);
  color:#fff;
}

.btnDanger{
  background:rgba(255,60,60,.2);
  border:1px solid rgba(255,60,60,.4);
  color:#fff;
}

.select{
  height:40px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-weight:900;
  padding:0 10px;
}

.tag{
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  font-size:12px;
  font-weight:900;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.modalBox{
  width:90%;
  max-width:400px;
  border-radius:24px;
  background:#111;
  padding:20px;
}

.modalBtns{
  margin-top:16px;
  display:flex;
  gap:10px;
}

</style>
</head>

<body>
<main id="pageContent">
<div class="wrap">

  <div class="card">
    <div class="title">Kullanıcı</div>
    <div class="value" id="userNameVal">—</div>
    <div class="desc" id="userEmailVal">—</div>
  </div>

  <div class="card">
    <div class="title">Kullanıcı KEY</div>
    <div class="value" id="userKeyVal">—</div>
  </div>

  <div class="card">
    <div class="title">Token Cüzdan</div>
    <div class="value" id="tokenVal">0</div>
    <div style="margin-top:10px;">
      <button class="btn btnPrimary" id="buyBtn">Token Satın Al</button>
    </div>
  </div>

  <div class="card">
    <div class="title">Sistem Dili</div>
    <select class="select" id="langSelect"></select>
  </div>

  <div class="card">
    <div class="title">Offline Paketler</div>
    <div id="offlineList" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
  </div>

  <div class="card">
    <button class="btn btnSafe" id="logoutBtn">Güvenli Çıkış</button>
  </div>

  <div class="card">
    <button class="btn btnDanger" id="deleteBtn">Hesabı Kalıcı Sil</button>
  </div>

</div>
</main>

<!-- Silme Modal -->
<div class="modal" id="modal">
  <div class="modalBox">
    <div class="title">Emin misiniz?</div>
    <div class="desc">Bu işlem geri alınamaz.</div>
    <div class="modalBtns">
      <button class="btn btnPrimary" id="confirmNo">Vazgeç</button>
      <button class="btn btnDanger" id="confirmYes">Evet, Sil</button>
    </div>
  </div>
</div>

<script type="module">
import { mountShell } from "/js/ui_shell.js";
import { STORAGE_KEY } from "/js/config.js";

mountShell();

const $ = id => document.getElementById(id);

/* KEY ÜRET */
function generateKey(){
  const A="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let letters="", digits="";
  for(let i=0;i<3;i++) letters+=A[Math.floor(Math.random()*A.length)];
  for(let i=0;i<6;i++) digits+=Math.floor(Math.random()*10);
  return letters+digits;
}

function getKey(){
  let k = localStorage.getItem("italky_user_key");
  if(!k){
    k = generateKey();
    localStorage.setItem("italky_user_key",k);
  }
  return k;
}

/* WALLET */
function getWallet(){
  const w = JSON.parse(localStorage.getItem("italky_wallet")||"{}");
  if(typeof w.balance !== "number"){
    w.balance = 10; // ilk giriş hediyesi
    localStorage.setItem("italky_wallet",JSON.stringify(w));
  }
  return w;
}

/* INIT */
function init(){
  // kullanıcı
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    const u = JSON.parse(raw);
    $("userNameVal").textContent = u.name || "Kullanıcı";
    $("userEmailVal").textContent = u.email || "—";
  }else{
    $("userNameVal").textContent = "Kullanıcı";
    $("userEmailVal").textContent = "—";
  }

  $("userKeyVal").textContent = getKey();

  const w = getWallet();
  $("tokenVal").textContent = w.balance;

  // dil select
  const langs=["tr","en","de","fr","es"];
  $("langSelect").innerHTML = langs.map(l=>`<option value="${l}">${l}</option>`).join("");
  $("langSelect").value = localStorage.getItem("italky_site_lang") || "tr";
  $("langSelect").onchange = ()=>localStorage.setItem("italky_site_lang",$("langSelect").value);

  // offline
  const off = JSON.parse(localStorage.getItem("italky_offline_langs")||"[]");
  if(off.length===0){
    $("offlineList").innerHTML = "<div class='tag'>Yok</div>";
  }else{
    off.forEach(x=>{
      const el=document.createElement("div");
      el.className="tag";
      el.textContent=x;
      $("offlineList").appendChild(el);
    });
  }
}

init();

/* BUTONLAR */

$("buyBtn").onclick = ()=>location.href="/pages/course_signup.html";

$("logoutBtn").onclick = ()=>{
  localStorage.removeItem(STORAGE_KEY);
  location.href="/pages/home.html";
};

$("deleteBtn").onclick = ()=> $("modal").style.display="flex";
$("confirmNo").onclick = ()=> $("modal").style.display="none";
$("confirmYes").onclick = ()=>{
  localStorage.clear();
  location.href="/pages/home.html";
};

</script>
</body>
</html>
