<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyai • giriş</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #020205;
      --text-white: #fff;
      --text-grey: #9ca3af;
      --ai-gradient: linear-gradient(135deg, #a5b4fc 0%, #6366f1 50%, #4338ca 100%);
      --accent-color: #6366f1;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100dvh;
      overflow: hidden;
      font-family: 'Outfit', sans-serif;
      background-color: var(--bg-deep);
      color: var(--text-white);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cosmos {
      position: absolute;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }

    .nebula {
      position: absolute;
      width: 90vw;
      height: 90vw;
      border-radius: 50%;
      filter: blur(120px);
      opacity: .25;
      background: radial-gradient(circle, var(--accent-color), transparent 70%);
    }

    .n-1 {
      top: -20%;
      left: -10%;
      animation: breathe 12s infinite alternate ease-in-out;
    }

    .n-2 {
      bottom: -10%;
      right: -10%;
      animation: breathe 15s infinite alternate-reverse ease-in-out;
    }

    .n-3 { /* Yeni nebula */
        top: 30%;
        right: -15%;
        width: 70vw;
        height: 70vw;
        background: radial-gradient(circle, #4338ca, transparent 70%);
        animation: rotate 20s infinite linear;
        opacity: .15;
    }

    @keyframes breathe {
      0% {
        transform: scale(1);
        opacity: .2;
      }
      100% {
        transform: scale(1.1);
        opacity: .35;
      }
    }
    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .app-frame {
      width: 100%;
      max-width: 440px;
      height: 100%;
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: rgba(8, 8, 12, .7);
      backdrop-filter: blur(20px);
      padding: 60px 30px 30px 30px;
      overflow-y: auto; /* Kaydırma eklendi */
    }

    .header-section {
      text-align: center;
    }

    .logo {
      font-size: 58px;
      font-weight: 800;
      letter-spacing: -2px;
      line-height: 1;
    }

    .txt-ai {
      background: var(--ai-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .be-free {
      letter-spacing: 8px;
      color: #4b5563;
      font-size: 13px;
      font-weight: 800;
      margin-top: 12px;
    }

    .hero-text {
      margin-top: 50px;
    }

    .hero-text h1 {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .hero-text p {
      font-size: 15px;
      color: var(--text-grey);
      line-height: 1.5;
    }

    .features-list {
      margin-top: 40px;
      padding: 0;
      list-style: none;
      text-align: left;
      display: flex; /* Dikeyden yataya geçiş */
      flex-wrap: wrap; /* Sığmazsa alta geç */
      justify-content: center;
      gap: 20px; /* Elemanlar arası boşluk */
    }

    .feature-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 140px; /* Her bir öğe için sabit genişlik */
      padding: 15px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .feature-item:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.08);
    }

    .feature-item .icon {
      width: 60px;
      height: 60px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(var(--accent-color-rgb, 99, 102, 241), 0.2);
      stroke: var(--accent-color);
      animation: icon-pulse 2s infinite alternate ease-in-out;
    }
    
    /* Her ikon için özel renk tonlaması */
    .feature-item:nth-child(1) .icon { background: rgba(165, 180, 252, 0.2); stroke: #a5b4fc; } /* Çeviri */
    .feature-item:nth-child(2) .icon { background: rgba(99, 102, 241, 0.2); stroke: #6366f1; } /* AI Sohbet */
    .feature-item:nth-child(3) .icon { background: rgba(67, 56, 202, 0.2); stroke: #4338ca; } /* Öğretmenler */
    .feature-item:nth-child(4) .icon { background: rgba(126, 34, 206, 0.2); stroke: #7e22ce; } /* Oyunlar/Toplantı */


    .feature-item h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-white);
      text-align: center;
      margin: 0;
    }

    @keyframes icon-pulse {
        0% { transform: scale(1); opacity: 0.8; }
        100% { transform: scale(1.05); opacity: 1; }
    }


    .action-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 14px;
      align-items: center;
      margin-top: 40px;
    }

    .google-btn {
      width: 100%;
      max-width: 320px;
      height: 46px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(0, 0, 0, 0.35);
      color: #fff;
      font-size: 15px;
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
      transition: all .2s ease;
    }

    .google-btn:hover {
        background: rgba(0, 0, 0, 0.5);
        border-color: rgba(255,255,255,0.25);
    }
    .google-btn:active {
      transform: scale(.98);
      background: rgba(0,0,0,0.6);
    }

    .g-icon {
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: rgba(255, 255, 255, .4);
      text-decoration: none;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
      transition: color .2s ease;
    }

    .footer-links a:hover {
        color: rgba(255, 255, 255, .7);
    }

    .copyright {
      text-align: center;
      margin-top: 15px;
      font-size: 10px;
      color: rgba(255, 255, 255, .15);
      font-weight: 700;
      letter-spacing: 1px;
    }

    #toast {
      position: fixed;
      top: 18px;
      left: 50%;
      transform: translatex(-50%) translatey(-120px);
      background: rgba(10, 10, 18, .92);
      border: 1px solid rgba(165, 180, 252, .35);
      padding: 10px 14px;
      border-radius: 999px;
      color: #fff;
      z-index: 9999;
      font-weight: 900;
      font-size: 12px;
      transition: .25s;
      backdrop-filter: blur(12px);
      pointer-events: none;
      max-width: min(92vw, 520px);
      text-align: center;
    }

    #toast.show {
      transform: translatex(-50%) translatey(0);
    }
  </style>
</head>

<body>
  <div class="cosmos">
    <div class="nebula n-1"></div>
    <div class="nebula n-2"></div>
    <div class="nebula n-3"></div> </div>

  <div class="app-frame">
    <div class="header-section">
      <div class="logo">italky<span class="txt-ai">ai</span></div>
      <div class="be-free">be free</div>

      <div class="hero-text">
        <h1>yapay zeka İle dil engellini kaldır.</h1>
        <p>anlaşmak ve anlaşılır olmak hiç bu kadar kolay olmamıştı.</p>
      </div>

      <div class="features-list">
        <div class="feature-item">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 8h14"></path>
              <path d="M5 12h14"></path>
              <path d="M5 16h14"></path>
              <line x1="12" y1="4" x2="12" y2="20"></line>
            </svg>
          </div>
          <h3>Yüz Yüze Çeviri</h3>
        </div>
        <div class="feature-item">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h3>AI İle Sohbet</h3>
        </div>
        <div class="feature-item">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
          <h3>Dil Öğretmenleri</h3>
        </div>
        <div class="feature-item">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="12" y1="17" x2="12" y2="7"></line>
              <line x1="7" y1="12" x2="17" y2="12"></line>
            </svg>
          </div>
          <h3>Eğitici Oyunlar</h3>
        </div>
      </div>
    </div>

    <div class="bottom-area">
      <div class="action-area">
        <button class="google-btn" id="googleBtn" type="button">
          <span class="g-icon" aria-hidden="true">
            <svg viewbox="0 0 24 24" width="18" height="18">
              <path fill="#ea4335" d="m12 10.2v3.9h5.5c-.2 1.2-1.5 3.6-5.5 3.6-3.3 0-6-2.7-6-6s2.7-6 6-6c1.9 0 3.2.8 3.9 1.5l2.7-2.6c17.9 2.5 15.3 1.2 12 1.2 5.9 1.2 1 6.1 1 12s4.9 10.8 11 10.8c6.3 0 10.4-4.4 10.4-10.6 0-.7-.1-1.2-.2-1.7h12z"/>
              <path fill="#34a853" d="m3.6 7.7l3.2 2.3c7.7 8 9.7 6.5 12 6.5c1.9 0 3.2.8 3.9 1.5l2.7-2.6c17.9 2.5 15.3 1.2 12 1.2c-4.2 0-7.8 2.4-9.6 6.5z"/>
              <path fill="#fbbc05" d="m12 22.8c3.2 0 5.9-1.1 7.9-2.9l-3.6-2.8c-1 .7-2.3 1.2-4.3 1.2-3.2 0-5.8-2.1-6.7-5l-3.4 2.6c1.8 3.5 5.4 5.9 10.1 5.9z"/>
              <path fill="#4285f4" d="m22.2 12.2c0-.7-.1-1.2-.2-1.7h12v3.9h5.5c-.3 1.3-1.5 3.6-5.5 3.6-3.3 0-6-2.7-6-6 0-.6.1-1.1.2-1.6l2.8 10c-.6 1.2-.9 2.6-.9 4 0 5.9 4.9 10.8 11 10.8 6.3 0 10.4-4.4 10.4-10.6z"/>
            </svg>
          </span>
          <span>google ile devam et</span>
        </button>
      </div>

      <div class="footer-links">
        <a href="/pages/about.html">hakkımızda</a>
        <a href="/pages/faq.html">sss</a>
        <a href="/pages/privacy.html">gizlilik</a>
        <a href="/pages/contact.html">İletişim</a>
      </div>
      <div class="copyright">italkyai by ozyigit's 2026</div>
    </div>
  </div>

  <div id="toast"></div>

  <script type="module">
    import { supabase } from "/js/supabase_client.js";
    import { ensureAuthAndCacheUser, loginWithGoogle } from "/js/auth.js";

    const toastEl = document.getElementById("toast");
    const HOME = "/pages/home.html";
    const STORAGE_KEY = "italky_user_v1";

    function toast(msg){
      if(!toastEl) return;
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(window.__to);
      window.__to = setTimeout(()=>toastEl.classList.remove("show"), 2200);
    }

    // --- NATIVE BRIDGE ---
    window.onNativeLoginSuccess = async function(jsonResponse) {
      try {
        const data = typeof jsonResponse === "string" ? JSON.parse(jsonResponse) : jsonResponse;
        
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data.user));
        localStorage.setItem("italky_token", data.token); 

        toast("Hoş geldin " + data.user.full_name + "!");
        
        setTimeout(() => location.replace(HOME), 800);
      } catch (e) {
        toast("Giriş işlenirken hata oluştu.");
        console.error("Native login error:", e);
      }
    };

    function isInApk(){
      // Android tarafında addJavascriptInterface(..., "Native") demiştik
      return !!(window.Native && typeof window.Native.startGoogleLogin === "function");
    }

    async function checkSession(){
      // APK içinde native session kontrolü (öncelik, çünkü direkt token'ı alıyoruz)
      if(hasLocalUser()){
        location.replace(HOME);
        return;
      }

      // Web için standart Supabase kontrolü
      try{
        const { data: { session } } = await supabase.auth.getSession();
        if(session){
          await ensureAuthAndCacheUser(); // Supabase session'ı varsa kullanıcının kendi verisini cache'ler
          location.replace(HOME);
        }
      }catch(e){ console.warn("Supabase session check error:", e); }
    }

    async function handleGoogleClick(){
      if(isInApk()){
        toast("Güvenli giriş başlatılıyor...");
        // Android tarafındaki Native Google Sign-In metodunu çağırıyoruz
        window.Native.startGoogleLogin(); 
      } else {
        toast("Google yönlendiriliyor...");
        // Tarayıcı için Supabase'in kendi OAuth akışını kullanıyoruz
        await loginWithGoogle(); 
      }
    }

    function hasLocalUser(){
      const raw = localStorage.getItem(STORAGE_KEY);
      return !!raw;
    }

    document.getElementById("googleBtn")?.addEventListener("click", handleGoogleClick);
    checkSession();
  </script>
</body>
</html>
